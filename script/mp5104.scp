#include "inc/mons.h"
#include "inc/def.h"
#include "inc/flag.h"
#include "inc/se.h"
#include "inc/scr_inc.h"
#include "inc/3dicon.h"
#include "inc/skilldef.h"
#include "inc/vo.h"
#include "inc/music.h"
#include "inc/efx.h"

//----------------------------------------------------------------------------//
//                                                                            //
// mp5104		    			                                              //
//                                                                            //
//----------------------------------------------------------------------------//
///////////////////////////////////////////////////////////////////////////////
// �������X�N���v�g
///////////////////////////////////////////////////////////////////////////////
//-------------------------------------------
function "init"
{
	CallFunc("rng:expMult")
	//���i�s�K�v�m�[�h�폜���}�b�v��Ǝҗp
	MapHide( "BG2_mp4110" , 0 )
	MapHide( "@BG2_mp5104" , 0 )
	MapHide( "@BG2_mp510x" , 0 )
	MapHide( "pSphere_out1" , 0 )
	MapHide( "pSphere_out2" , 0 )
	MapHide( "BG2_etania_houses_4" , 0 )

	if (FLAG[SF_BOSS_BATTLE])
	{
		//���g���C��f�o�b�O�{�X�W�����v����̃{�X��
		if( FLAG[GF_SPEEDRUN_SKILL_HUMMEL] &&	// ��荞�݃X�L���K���F�D���q���������u�r�}�X�^�[�R���O����������
			!FLAG[GF_SPEEDRUN_SKILL_ADOL] && FLAG[SF_ADOL_JOINOK])		// ��荞�݃X�L���K���F�E���A�h���u�r�}�X�^�[�R���O����������
		{
			SetWork(WK_BGM, BGM_Nothing)
			EventCue("mp5104:Retry_Speedrun_Monkey6_Battle")
		}
	}
	else if( FLAG[SF_EVENT_ON] ){

	//��ʔz�u�t�@���N�V�����Ăяo��
		CallFunc("mp5104:NpcPosition")

	//�m�o�b�}�[�J�[�Z�b�g
		CallFunc("system:SetMarkerNPC")

		// �}�b�v�m�[�h�E�A�j��
		MapAnime("mistSphere", "off")	// ���̃}��
		if( FLAG[GF_TBOX_DUMMY087]				// ��[M06S020][�����̂��߃W�����_�����֌�����]
			&& !FLAG[GF_06MP4109_CLEAR_MIST] )		// ��[M06S111][�R��̖���˔j����Q]
		{
			MapAnime("mistSphere", "on")	// ���̃}��
		}

		//�ٌ`�̌Ñ��E�U���ȍ~�͏o��
		if( FLAG[GF_TBOX_DUMMY087] ) {				//�����̂��߃W�����_�����֌�����
			SetChrPos( "v_mons02", -551.99f, 599.52f, 81.11f )
			Turn( "v_mons02", 155.55f, 360.0f )
			SetChrPos( "v_mons03", -484.86f, 643.10f, 74.41f )
			Turn( "v_mons03", 165.53f, 360.0f )
			SetChrPos( "v_mons04", -487.12f, 665.63f, 66.11f )
			Turn( "v_mons04", 138.94f, 360.0f )
			SetChrPos( "v_mons05", -659.15f, 674.84f, 49.47f )
			Turn( "v_mons05", -22.01f, 360.0f )
		}
	}

	//�}�b�v���\��
	if(!FLAG[SF_LOADINIT] && !FLAG[GF_MPxxxx_MAP_NAME_NO_DRAW] && !FLAG[TF_MAPNAME_SHOWN]){
		if( FLAG[SF_LASTENTRY_NO] == 1 || FLAG[SF_LASTENTRY_NO] == 100 ){
			VisualName("visual/mapname/mn_4110.itp",VN_NAMEMAP2,-1,-1,VN_MAPNAME_TIME)//�����炵��
			SetFlag( TF_MAPNAME_SHOWN, 1 )				// �n���\�������i�e���|�����j
		}
	}
}

//////////////////////////////////////////////////////////////////////
//����ʔz�u
//////////////////////////////////////////////////////////////////////
//��ʔz�u
function "NpcPosition"
{
	if( FLAG[GF_SPEEDRUN_SKILL_HUMMEL] &&	// ��荞�݃X�L���K���F�D���q���������u�r�}�X�^�[�R���O����������
		!FLAG[GF_SPEEDRUN_SKILL_ADOL] && FLAG[SF_ADOL_JOINOK])		// ��荞�݃X�L���K���F�E���A�h���u�r�}�X�^�[�R���O����������
	{
		//�}�X�^�[�R���O
		SetChrPos("Monkey",-663.29f, 693.31f, 49.17f)
		Turn("Monkey",179.65f,360.0f)
		ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI", -1, 1 )
	}

	// -----------------------------------------------------------------
	// �ߋ��҃M�~�b�N_�q�����M�̎��J�񃋁[�g_���{��
	// �����{����������ƁA���i�Ō����Ă���ӏ��͑S�Ĉȉ��̑Ή����K�v�ƂȂ�܂�
	// -----------------------------------------------------------------
	if( FLAG[GF_05MP6204_APPEAR_CASTLE] )	//���ł������{����������
	{
		MapAnime("gim03" , "open" )		//�q�����M�̎�
	}
	else
	{
		MapAnime("gim03" , "close" )	//�q�����M�̎�
	}
}



////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//���T�u�C�x���g�Z�N�V����

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//������������������������������������������������������������
//���}�X�^�[�R���O�̃��b�Z�[�W����
//������������������������������������������������������������
function "Speedrun_Monkey6"
{
	//���N�G�X�g�B���� && !�u���E�Ő퓬���I��点���v

	//�@�@�}�X�^�[�R���O�ɘb��������ƁA�C�x���g�J�n�B
	//�@�@�}�X�^�[�R���O�̑O�ɁA�p�[�e�B�����o�[�S����z�u����B

	//	�ˁ��D�Ő퓬���I��点��

//�J�n������������----------------------------------------------------

	CallFunc("system:party_reset")
	CallFunc("system:event_begin")

	//�C�x���g�J�n�O���̕ۑ�
	SaveEventState()
	SaveCamera()

	//�p�[�e�B��Ԃ̃��Z�b�g
	CallFunc("system:party_reset")

	//���̏������E�s�v�Ȃ��̂��B��
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//�L����������Ԃ̐ݒ�
	SetChrWork("ADOL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("ADOL",-663.58f,687.24f,49.21f)
	Turn("ADOL",-175.92f,360.0f)
	ChangeAnimation( "ADOL" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("ADOL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "ADOL" , INFOFLAG_NOCHRATARI)
	LookReset( "ADOL" )

	SetChrWork("RICOTTA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("RICOTTA",-663.50f,688.24f,49.21f)
	Turn("RICOTTA",-177.65f,360.0f)
	ChangeAnimation( "RICOTTA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("RICOTTA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "RICOTTA" , INFOFLAG_NOCHRATARI)
	LookReset( "RICOTTA" )

	SetChrWork("LAXIA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("LAXIA",-664.53f,687.27f,49.20f)
	Turn("LAXIA",-173.53f,360.0f)
	ChangeAnimation( "LAXIA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("LAXIA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "LAXIA" , INFOFLAG_NOCHRATARI)
	LookReset( "LAXIA" )

	SetChrWork("SAHAD", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("SAHAD",-662.60f,687.08f,49.21f)
	Turn("SAHAD",164.58f,360.0f)
	ChangeAnimation( "SAHAD" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("SAHAD",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "SAHAD" , INFOFLAG_NOCHRATARI)
	LookReset( "SAHAD" )

	SetChrWork("HUMMEL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("HUMMEL",-663.19f,686.01f,49.21f)
	Turn("HUMMEL",-173.53f,360.0f)
	ChangeAnimation( "HUMMEL" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("HUMMEL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "HUMMEL" , INFOFLAG_NOCHRATARI)
	LookReset( "HUMMEL" )

	//	�˃_�[�i������ꍇ
	if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
	{
		SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
		SetChrPos("DANA",-664.05f,686.29f,49.20f)
		Turn("DANA",177.76f,360.0f)
		ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
		ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
		SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)
		LookReset( "DANA" )
	}

	//�}�X�^�[�R���O
	SetChrWork("Monkey", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("Monkey",-663.29f, 693.31f, 49.17f)
	Turn("Monkey",5.55f,360.0f)
	ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI", -1, 1 )
	ChangeSubAnimation("Monkey",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("Monkey",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("Monkey",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "Monkey" , INFOFLAG_NOCHRATARI)
	LookReset( "Monkey" )

	LookChr("ADOL", "Monkey")
	LookChr("LAXIA", "Monkey")
	LookChr("SAHAD", "Monkey")
	LookChr("RICOTTA", "Monkey")
	LookChr("HUMMEL", "Monkey")
	LookChr("DANA", "Monkey")

	//BGM�ݒ聟
	//PlayBGM( BGM_FIELD_101 , XX )

	//�J�����ݒ�
	MoveCameraAt( 0 , -661.918f , 690.627f , 51.481f , 0 )	// �����_
	ChangeCameraDistance( 0 , 7.000f , 0 )		// ��{����
	ChangeCameraElevation( 0 , -3.933f , 0 )	// ��{�p
	RotateCamera( 0 , 325.918f , 0 )				// �p�x
	ChangeCameraPers( 0 , 60.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]
	// ResetCameraZPlane()	// �C�x���g�I�����ɌĂяo���ĉ������B�}�b�v���̐ݒ�ɖ߂��܂��B

	// ��ʊE�[�x�̐ݒ�
	SetDoF(0, LERP_LINEAR, 5.000, 250.000 ,1.000 ,0.700 ,0.600)
	// �O���A�̐ݒ�
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//�X�L�b�v����
	SetFlag(TF_MENU_SELECT,0)
	SetSkipScript("mp5104:Speedrun_Monkey6_ED")

//�J�n���������܂�-----------------------------------------------

	Wait(10)

	FadeIn(FADE_BLACK,FADE_FAST)
	WaitFade()

	//	�ː퓬�\�ȃ^�C�~���O�����A���n�}���S�[���������Ă��Ȃ��ꍇ
	if( ALLITEMWORK[ICON3D_US_MANGO_S] == 0 )	//�u���n�}���S�[�v�������Ă��Ȃ� FLAG[GF_NPC_6_02_GOTO_GEND] &&			//����Z���A�W�����_��������֌�����
	{
		//�@�@�����ڂ���Ď��U��B
		ChangeSubAnimation("Monkey", SUBMOT_EYE, ANI_E_CLOSE_S, 1)
		HeadNo("Monkey" , 1 , 25)
		Wait(30)
		
		TalkPopup("RICOTTA",0,2,0,0,0)
		{
			"#000e#000m������[�����Ă�B"
			"�w��V�������҂͑���ɂ��ʁx\p"
			"�݂�ȁA�w���n�}���S�[�x�p�ӂ���I"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		SetFlag(TF_MENU_SELECT,0)
	}
	//	�ː퓬�\�ȃ^�C�~���O�A�����n�}���S�[���������Ă���ꍇ
	else if( ALLITEMWORK[ICON3D_US_MANGO_S] )		//�u���n�}���S�[�v�������Ă��� FLAG[GF_NPC_6_02_GOTO_GEND] &&		//����Z���A�W�����_��������֌�����
	{
		//�@�@�ėp�{�C�X�u���قفi�m��u��������ȁv�j�v���Đ����A
		//�@�@�ȉ��̏����B
		PlayVoice(Y8V_5663,"Monkey",100)
		
		//��������������������������������������������
		//	�ˏ���̂�
		if( !FLAG[GF_SPEEDRUN_SKILL_ADOL_1ST] )	// ��荞�݃X�L���K���F�E���A�h���u�r�}�X�^�[�R���O�@�����b
		{
			TalkPopup("RICOTTA",0,2,0,0,0)
			{
				"#000e#000m�w�Ō�͐ԖсA���傾�x"
				"�ƌ����Ă�B"
			}
			WaitPrompt()
			WaitCloseWindow()
			
			//�@�@�A�h���������B
			HeadYes("ADOL" , 1 , 25)
			Wait(35)
			
			SetFlag( GF_SPEEDRUN_SKILL_ADOL_1ST, 1 )	// ��荞�݃X�L���K���F�E���A�h���u�r�}�X�^�[�R���O�@�����b
		}
		//��������������������������������������������

		//	�i���[�V����
		TalkPopup(UNDEF, 0, 3, SYSTEM_PPOSX, SYSTEM_PPOSY, 0)
		{
			"#7C������[��#2C�u#245I���n�}���S�[�v#7C�����サ�܂����H"
			"#7C�����シ��ƁA�A�h����l��"
			"#7C  ������[�Ɛ퓬���s���܂��B"
		}
		WaitPrompt()
		WaitCloseWindow()

		//�I����
		SetFlag(TF_MENU_SELECT,0)
		MenuReset()
		MenuType(MENUTYPE_POPUP)
//		MenuAdd(1,"�w���n�}���S�[�x�����シ��")
		MenuAdd(1,"#2C#245I���n�}���S�[#0C�����シ��")
		MenuAdd(2,"��߂Ă���")
		MenuOpen( TF_MENU_SELECT , -1 , ADOLMENU_PPOSY , -2 , -2 , 10 , 0)
		WaitMenu(0)
		MenuClose(10,0)
		
		//��������������������������������������������
		//	�ˁw���n�}���S�[�x�����シ��
		if (FLAG[TF_MENU_SELECT] == 1)
		{
			//	�A�C�e�����n���b�Z�[�W
			TalkPopup(UNDEF, 0, 5, 0, 0, 0)
			{
				"#8S"
				"#-1W#4C������[��#2C�u#245I���n�}���S�[�v#4C�����サ���I"
				"#8S"
			}
			WaitPrompt()
			WaitCloseWindow()
			StopBGM(60)
			//�@�@����ʈÓ]���āu�퓬�J�n�C�x���g�v�ɐڑ�
		}
		//	�˂�߂Ă���
		else if (FLAG[TF_MENU_SELECT] == 2)
		{
			//�@�@�����Ȃ��ő��싖�B
		}
		//��������������������������������������������
	}
	//	�ː퓬���ł��Ȃ��^�C�~���O
	//	  �u���D�Ő퓬���I��点���v&& !�u����Z���A�W�����_��������֌������v
	else
	{
		//�@�@�}�X�^�[�R���O���ڂ���Ď��U��B
		ChangeSubAnimation("Monkey", SUBMOT_EYE, ANI_E_CLOSE_S, 1)
		HeadNo("Monkey" , 1 , 25)
		Wait(30)

		TalkPopup("RICOTTA",0,2,0,0,0)
		{
			"#000e#000m������[�����Ă�B"
			"�w�����}���ȁA�������Ղ��Ă���x\p"
			"�݂�ȁA�܂����߂ė���B"
		}
		WaitPrompt()
		WaitCloseWindow()

		SetFlag(TF_MENU_SELECT,0)
	}

	FadeOut(FADE_BLACK,FADE_FAST)
	WaitFade()

//�I��������������----------------------------------------------------
	CallFunc("mp5104:Speedrun_Monkey6_ED")
}
function "Speedrun_Monkey6_ED"
{
	//�I�������̓X�L�b�v�֎~
	SetSkipScript("")

	//�C�x���g�O�̃L�������𕜋A
	RestoreEventState()

	//�B�������̂𕜋A�B
	ResetChrPos((CHRTYPE_MONS | RESET_POS))
//	ResetChrPos((CHRTYPE_MONS | RESET_STATUS))
//	ResetChrPos((CHRTYPE_MONS | RESET_AISTATE))

	//�L�������[�V����������
	CallFunc("system:reset_chrmot_ALL")

	//�p�[�e�B�L���������
	ReleaseEventPartyChr()

	//�}�b�v�p�����[�^�[���Z�b�g
	ResetMapParam(-1)

	//	�ˁw���n�}���S�[�x�����シ��

	if( FLAG[TF_MENU_SELECT] == 1 )
	{
		DeleteItem( ICON3D_US_MANGO_S, 1 )			// �w���n�}���S�[�x
			
		//�@�@����ʈÓ]���āu�퓬�J�n�C�x���g�v�ɐڑ�
		EventCue("mp5104:Speedrun_Monkey6_Battle")
	}
	//	�ː퓬���ł��Ȃ��^�C�~���O
	//	�˂�߂Ă���
	//�C�x���g�X�L�b�v
	else
	{
		//�@�@���싖��
		CallFunc("mp5104:init")

		//�C�x���g��̍Ĕz�u
		SetChrPos("LEADER",-662.05f,686.55f,49.22f)
		Turn("LEADER",167.97f, 360.0f)
		ResetPartyPos()
		ResetFollowPoint()
		//Wait(1) //�����҂��p

		//�J�����ʒu���A
		//MoveCameraAt( 0 , 0.0f , 0.0f , 0.0f , 0 )	// �����_
		//ChangeCameraDistance( 0 , 0.0f , 0 )		// ��{����
		//ChangeCameraElevation( 0 , 0.0f , 0 )		// ��{�p
		//RotateCamera( 0 , 0.0f , 0 )				// �p�x
		//ChangeCameraPers( 0 , 0.0f , 0 )			// ����p
		//SetCameraZPlane( 0 , 0.0f )					// ZPlane
		//RollCamera( 0 , 0.0f , 0 )					// ���[����]

		RestoreCamera(0, 0)		//����L�J�����ʒu���w�肷��ꍇ�͕s�v
		CallFunc("system:camera_reset")

		ResetStopFlag(STOPFLAG_EVENT)

		FadeIn(FADE_BLACK,FADE_FAST)
		//WaitFade()
	}
//�I�����������܂�----------------------------------------------------
}
//������������������������������������������������������������
//���퓬�J�n�C�x���g
//������������������������������������������������������������
function "Speedrun_Monkey6_Battle"
{
	//���A�h���u�r�}�X�^�[�R���O

//�J�n������������----------------------------------------------------

	CallFunc("system:event_begin")

	//�C�x���g�J�n�O���̕ۑ�
	SaveEventState()
	SaveCamera()

	//�p�[�e�B��Ԃ̃��Z�b�g
	CallFunc("system:party_reset")

	//���̏������E�s�v�Ȃ��̂��B��
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//�L����������Ԃ̐ݒ�
	SetChrWork("ADOL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("ADOL",-664.73f,683.48f,49.20f)
	Turn("ADOL",-170.83f,360.0f)
	ChangeAnimation( "ADOL" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("ADOL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "ADOL" , INFOFLAG_NOCHRATARI)
	LookChr( "ADOL", "Monkey")
	SetChrWork( "ADOL" , CWK_BATTLEMODE , 1 )

	//�}�X�^�[�R���O
	SetChrWork("Monkey", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("Monkey",-663.29f, 693.31f, 49.17f)
	Turn("Monkey",5.55f,360.0f)
	ChangeAnimation( "Monkey" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("Monkey",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("Monkey",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("Monkey",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "Monkey" , INFOFLAG_NOCHRATARI)
	LookChr( "Monkey", "ADOL" )

	SetChrWork("RICOTTA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("RICOTTA",-651.76f,688.58f,49.37f)
	Turn("RICOTTA",90.00f,360.0f)
	ChangeAnimation( "RICOTTA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("RICOTTA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "RICOTTA" , INFOFLAG_NOCHRATARI)
	LookReset( "RICOTTA" )

	SetChrWork("LAXIA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("LAXIA",-651.41f,687.62f,49.38f)
	Turn("LAXIA",87.87f,360.0f)
	ChangeAnimation( "LAXIA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("LAXIA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "LAXIA" , INFOFLAG_NOCHRATARI)
	LookReset( "LAXIA" )

	SetChrWork("SAHAD", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("SAHAD",-651.01f,689.80f,49.38f)
	Turn("SAHAD",93.59f,360.0f)
	ChangeAnimation( "SAHAD" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("SAHAD",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "SAHAD" , INFOFLAG_NOCHRATARI)
	LookReset( "SAHAD" )

	SetChrWork("HUMMEL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("HUMMEL",-650.78f,691.20f,49.31f)
	Turn("HUMMEL",93.59f,360.0f)
	ChangeAnimation( "HUMMEL" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("HUMMEL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "HUMMEL" , INFOFLAG_NOCHRATARI)
	LookReset( "HUMMEL" )

	//	�˃_�[�i������ꍇ
	if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
	{
		SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
		SetChrPos("DANA",-651.09f,686.46f,49.39f)
		Turn("DANA",87.87f,360.0f)
		ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
		ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
		SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)
		LookReset( "DANA" )
	}

	//BGM�ݒ聟
	//PlayBGM( BGM_FIELD_101 , XX )

	//�J�����ݒ�
	MoveCameraAt( 0 , -663.797f , 686.643f , 50.613f , 0 )	// �����_
	ChangeCameraDistance( 0 , 6.299f , 0 )		// ��{����
	ChangeCameraElevation( 0 , 0.529f , 0 )	// ��{�p
	RotateCamera( 0 , 341.990f , 0 )				// �p�x
	ChangeCameraPers( 0 , 60.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]
	// ResetCameraZPlane()	// �C�x���g�I�����ɌĂяo���ĉ������B�}�b�v���̐ݒ�ɖ߂��܂��B

	// ��ʊE�[�x�̐ݒ�
	SetDoF(0, LERP_LINEAR, 5.000, 250.000 ,1.000 ,0.700 ,0.600)
	// �O���A�̐ݒ�
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//�X�L�b�v����
//	SetSkipScript("mp5104:Speedrun_Monkey6_Battle_ED")

//�J�n���������܂�-----------------------------------------------

	PlayBGM(BGM_BOSS_002, 0)

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	//�@�@��ʃt�F�[�h�C�����āA�}�X�^�[�R���O�ƌ��������A�h���B
	//�@�@���Ԃ͎��͂ɂ���B

	//�@�@�}�X�^�[�R���O���Њd���[�V����������Đ퓬�J�n�B
	ChangeAnimation( "Monkey", "ANI_UNI1", -1, 1 )
	Wait(10)
	PlayVoice(Y8V_5652, "Monkey", 100)	//���ق��������c�i�C�����𗭂߂� 
	Wait(35)

	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	WaitAnimation2( "Monkey" , -1, 1, "ANI_UNI1",  0)

//	TalkPopup("UNDEF",0,0,0,0,0)
//	{
//		"#7C���C�x���g��p�̋�C�A�^������"
//	}
//	WaitPrompt()
//	WaitCloseWindow()

//�I��������������----------------------------------------------------
	CallFunc("mp5104:Speedrun_Monkey6_Battle_ED")
}
function "Speedrun_Monkey6_Battle_ED"
{
	//�I�������̓X�L�b�v�֎~
	SetSkipScript("")

	//�C�x���g�O�̃L�������𕜋A
	RestoreEventState()

	//�L�����N�^�[������
	CallFunc("system:reset_chrmot_ALL")

	//�}�b�v�p�����[�^�[���Z�b�g
	ResetMapParam(-1)

	// �}�X�^�[�R���O����ʊO�Ɉړ�
	SetChrPos("Monkey" , -100000.00f  , 0.00f ,0.00f )

	//NowLoading ���� Tips �\�����J�b�g
	SetFlag(TF_LOADING_TIPS_OFF, 1)

	CallFunc("system:camera_reset")
	EventCue("mp5104:Retry_Speedrun_Monkey6_Battle")

	ResetStopFlag(STOPFLAG_EVENT)
}
// �퓬����
function "Retry_Speedrun_Monkey6_Battle"
{
	SetStopFlag(STOPFLAG_EVENT)
	FadeOut(FADE_BLACK,0)
	WaitFade()

	//�A�h���ЂƂ� -----------------------------------
	SavePartyMember()							// ���݂̃p�[�e�B�Ґ����o����
	// �p�[�e�B�Ґ��\�󋵃o�b�N�A�b�v
	SetFlag(SF_ADOL_JOINOKBK, FLAG[SF_ADOL_JOINOK])
	SetFlag(SF_LAXIA_JOINOKBK, FLAG[SF_LAXIA_JOINOK])
	SetFlag(SF_SAHAD_JOINOKBK, FLAG[SF_SAHAD_JOINOK])
	SetFlag(SF_HUMMEL_JOINOKBK, FLAG[SF_HUMMEL_JOINOK])
	SetFlag(SF_RICOTTA_JOINOKBK, FLAG[SF_RICOTTA_JOINOK])
	SetFlag(SF_DANA_JOINOKBK, FLAG[SF_DANA_JOINOK])
	// �ЂƂ肾���ɂ���
	SetFlag(SF_ADOL_JOINOK, 1)
	SetFlag(SF_LAXIA_JOINOK, 0)
	SetFlag(SF_SAHAD_JOINOK, 0)
	SetFlag(SF_HUMMEL_JOINOK, 0)
	SetFlag(SF_RICOTTA_JOINOK, 0)
	SetFlag(SF_DANA_JOINOK, 0)
	SetPartyMember(PARTY_ADOL, -1, -1)

	//�{�X�z�u�E�A�j��--------------------------------
	SetChrPos("mons_Monkey",-663.29f, 693.31f, 49.17f)
	Turn("mons_Monkey",5.55f,360.0f)
	ChangeAnimation("mons_Monkey", "ANI_WAIT", -1, 1)

	//PLAYER�z�u--------------------------------------
	SetChrPos("PLAYER1",-664.73f,683.48f,49.20f)
	Turn("PLAYER1",-170.83f,360.0f)
	//TurnToChr("PLAYER1" , "mons_Monkey" , 360.0f )
	//TurnToChr("mons_Monkey" , "PLAYER1" , 360.0f )

	//�J�����ݒ�--------------------------------------
	// arg�̐ݒ���㏑������
//	SetYs8Camera(7.0f, 60.0f, 10.0f, 0.0f, 0.0f)		//�c�c�{�X���[�`���쐬�҂̎w�肪����Γ���
	MoveCameraAt( 0 , -664.727f , 683.478f , 51.066f , 0 )	// �����_
	ChangeCameraDistance( 0 , 7.000f , 0 )		// ��{����
	ChangeCameraElevation( 0 , 14.000f , 0 )	// ��{�p
	RotateCamera( 0 , -9.173f , 0 )				// �p�x
	ChangeCameraPers( 0 , 60.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]

	//�C�x���g�o�g���pCallFunc------------------------
	CallFunc("system:boss_start")						//�c�c�C�x���g�o�g���p�̐F�X�ȏ������s��function

	//���̑�����--------------------------------------
	PlayBGM(BGM_BOSS_002, 15)	//�����ؔŗp��
	MapAnime("CT_EVENT","close")					//�c�c�������Ȃ��X�g�b�p�[�N��
	SetFlag( GF_SPEEDRUN_SKILL_BATTLE, 1)			// ��荞�݃X�L���K���F�퓬���Ǘ��p�i1���퓬���j
	SetFlag( GF_QS400_KONG_LV, 5)					// �}�X�^�[�R���O�̃L�������[�h�i5=�A�h���j
	SetLevel( "mons_Monkey", 60 )					// �}�X�^�[�R���O��Lv.60
	
	FadeIn(FADE_BLACK,FADE_FAST)
	WaitFade()

	ResetStopFlag(STOPFLAG_EVENT)
	//------------------------------------------------

	//��������������������������������������������
	//	�ː퓬�ɏ���
	//		Speedrun_Monkey6_Win
	//	�˔s�k
	//		Speedrun_Monkey6_Lose
	//��������������������������������������������
}
// �퓬�s�k���C�x���g
function "Speedrun_Monkey6_Lose"
{
	//���A�h���u�r�}�X�^�[�R���O
	//	�˔s�k

//�퓬�I��������������-----------------------------------------------

	//���GON�E�F�X�I��������---------------------------
	SetFlag(SF_ALLMUTEKI,1)								//�c�c���G�n�m

	Wait(90)											//�c�c�{�X���S���[�V���������違�h���b�v�A�C�e�����E������
	StopBGM(90)
	Wait(60)

	//�C�x���g�o�g���pCallFunc-------------------------
	CallFunc("system:boss_end")							//�c�c�C�x���g�o�g���p�̐F�X�ȏ������s��function

	//���������E�{�X����-------------------------------
	MapAnime("CT_EVENT","open")							//�c�c�������Ȃ��X�g�b�p�[����
	SetChrPos(mons_Monkey,-100000.00f,0.00f,0.00f)		//�c�c�{�X�������Ȃ��ʒu�ɔ�΂�
	//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))			//�c�c�U�R�Ȃ炱����

	//���㏈��-----------------------------------------
		////-----------------------------------
		//// �^�C���A�^�b�N��
		//if (FLAG[SF_TIMEATK])
		//{
		//	EndTimeAtk()		// �^�C���A�^�b�N�I���i�X�N���v�g���狭���I�ɔ����Ă��낢�돈�����Ă����j
		//}
		////-----------------------------------

	FadeOut(FADE_WHITE,FADE_NORMAL)
	WaitFade()

	SetFlag( GF_SPEEDRUN_SKILL_BATTLE, 0)	// ��荞�݃X�L���K���F�퓬���Ǘ��p�i1���퓬���j

//�퓬�I�����������܂�-----------------------------------------------
//�J�n������������-----------------------------------------------

//	CallFunc("system:event_begin")

	//�C�x���g�J�n�O���̕ۑ�
	SaveEventState()
	SaveCamera()

	// �p�[�e�B�Ґ��\�󋵂�߂�
	SetFlag(SF_ADOL_JOINOK, FLAG[SF_ADOL_JOINOKBK])
	SetFlag(SF_LAXIA_JOINOK, FLAG[SF_LAXIA_JOINOKBK])
	SetFlag(SF_SAHAD_JOINOK, FLAG[SF_SAHAD_JOINOKBK])
	SetFlag(SF_HUMMEL_JOINOK, FLAG[SF_HUMMEL_JOINOKBK])
	SetFlag(SF_RICOTTA_JOINOK, FLAG[SF_RICOTTA_JOINOKBK])
	SetFlag(SF_DANA_JOINOK, FLAG[SF_DANA_JOINOKBK])

	RestorePartyMember()						// �p�[�e�B�����o�[��߂�

	//�p�[�e�B��Ԃ̃��Z�b�g
	CallFunc("system:party_reset")

	//���̏������E�s�v�Ȃ��̂��B��
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//�L����������Ԃ̐ݒ�
	SetChrWork("ADOL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("ADOL",-664.40f,685.24f,49.20f)
	Turn("ADOL",-170.83f,360.0f)
	ChangeAnimation( "ADOL" , "ANI_EV_ZEEWAIT2", -1 , 1 )
	ChangeSubAnimation("ADOL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "ADOL" , INFOFLAG_NOCHRATARI)
	LookChr( "ADOL", "Monkey")

	//�}�X�^�[�R���O
	SetChrWork("Monkey", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("Monkey",-663.29f, 693.31f, 49.17f)
	Turn("Monkey",5.55f,360.0f)
	ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI", -1, 1 )
	ChangeSubAnimation("Monkey",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("Monkey",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("Monkey",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "Monkey" , INFOFLAG_NOCHRATARI)
	LookChr( "Monkey", "ADOL" )

	SetChrWork("RICOTTA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("RICOTTA",-651.76f,688.58f,49.37f)
	Turn("RICOTTA",90.00f,360.0f)
	ChangeAnimation( "RICOTTA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("RICOTTA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "RICOTTA" , INFOFLAG_NOCHRATARI)
	LookReset( "RICOTTA" )

	SetChrWork("LAXIA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("LAXIA",-651.41f,687.62f,49.38f)
	Turn("LAXIA",87.87f,360.0f)
	ChangeAnimation( "LAXIA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("LAXIA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "LAXIA" , INFOFLAG_NOCHRATARI)
	LookReset( "LAXIA" )

	SetChrWork("SAHAD", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("SAHAD",-651.01f,689.80f,49.38f)
	Turn("SAHAD",93.59f,360.0f)
	ChangeAnimation( "SAHAD" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("SAHAD",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "SAHAD" , INFOFLAG_NOCHRATARI)
	LookReset( "SAHAD" )

	SetChrWork("HUMMEL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("HUMMEL",-650.78f,691.20f,49.31f)
	Turn("HUMMEL",93.59f,360.0f)
	ChangeAnimation( "HUMMEL" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("HUMMEL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "HUMMEL" , INFOFLAG_NOCHRATARI)
	LookReset( "HUMMEL" )

	//	�˃_�[�i������ꍇ
	if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
	{
		SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
		SetChrPos("DANA",-651.09f,686.46f,49.39f)
		Turn("DANA",87.87f,360.0f)
		ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
		ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
		SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)
		LookReset( "DANA" )
	}

	//BGM�ݒ聟
	//PlayBGM( BGM_FIELD_101 , XX )

	//�J�����ݒ�
	MoveCameraAt( 0 , -663.787f , 685.664f , 50.357f , 0 )	// �����_
	ChangeCameraDistance( 0 , 2.778f , 0 )		// ��{����
	ChangeCameraElevation( 0 , -7.049f , 0 )	// ��{�p
	RotateCamera( 0 , 9.951f , 0 )				// �p�x
	ChangeCameraPers( 0 , 55.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]
	// ResetCameraZPlane()	// �C�x���g�I�����ɌĂяo���ĉ������B�}�b�v���̐ݒ�ɖ߂��܂��B

	// ��ʊE�[�x�̐ݒ�
	SetDoF(0, LERP_LINEAR, 5.000, 250.000 ,1.000 ,0.700 ,0.600)
	// �O���A�̐ݒ�
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//�X�L�b�v����
//	SetSkipScript("mp5104:Speedrun_Monkey6_Lose_ED")
	
//�J�n���������܂�-----------------------------------------------
	
	FadeIn(FADE_WHITE,FADE_NORMAL)
	WaitFade()
	
	//�@�@�A�h�����G�����Ă���B

	TalkPopup("RICOTTA",0,0,0,0,0)
	{
		"#000e#000m�A�h���Z�A���v���I�H"
	}
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�A�h���������B
	HeadYes("ADOL" , 1 , 25)
	Wait(35)

	//	�i���[�V����
	TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
	{
		"#7C������[�ƍĐ킵�����ꍇ�́A"
//		"#7C�Ăсw���n�}���S�[�x�����サ�Ă��������B"
		"#7C�Ă�#2C�u#245I���n�}���S�[�v#7C�����サ�Ă��������B"
	}
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�C�x���g�I���A���싖�B
	FadeOut(FADE_BLACK,FADE_FAST)
	WaitFade()

//�I��������������----------------------------------------------------
	CallFunc("mp5104:Speedrun_Monkey6_Lose_ED")
}
function "Speedrun_Monkey6_Lose_ED"
{
	//�I�������̓X�L�b�v�֎~
	SetSkipScript("")

	//�C�x���g�O�̃L�������𕜋A
	RestoreEventState()

	//�B�������̂𕜋A�B
	ResetChrPos((CHRTYPE_MONS | RESET_POS))
//	ResetChrPos((CHRTYPE_MONS | RESET_STATUS))
//	ResetChrPos((CHRTYPE_MONS | RESET_AISTATE))

	//�L�������[�V����������
	CallFunc("system:reset_chrmot_ALL")	

	//�p�[�e�B�L���������
	ReleaseEventPartyChr()

	//�}�b�v�p�����[�^�[���Z�b�g
	ResetMapParam(-1)

	//�t���O����
	SetFlag(SF_BOSS_BATTLE, 0)		//�{�X��I��

	// �}�X�^�[�R���O����ʊO�Ɉړ�
	SetChrPos("Monkey" , -100000.00f  , 0.00f ,0.00f )

	CallFunc("mp5104:init")

	//�C�x���g��̍Ĕz�u
	SetChrPos("LEADER",-662.05f,686.55f,49.22f)
	Turn("LEADER",167.97f, 360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //�����҂��p

	//�J�����ʒu���A
	//MoveCameraAt( 0 , 0.0f , 0.0f , 0.0f , 0 )	// �����_
	//ChangeCameraDistance( 0 , 0.0f , 0 )		// ��{����
	//ChangeCameraElevation( 0 , 0.0f , 0 )		// ��{�p
	//RotateCamera( 0 , 0.0f , 0 )				// �p�x
	//ChangeCameraPers( 0 , 0.0f , 0 )			// ����p
	//SetCameraZPlane( 0 , 0.0f )					// ZPlane
	//RollCamera( 0 , 0.0f , 0 )					// ���[����]

	RestoreCamera(0, 0)		//����L�J�����ʒu���w�肷��ꍇ�͕s�v
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	PlayBGM(BGM_5104, 0)

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()

//�I�����������܂�----------------------------------------------------
}
//������������������������������������������������������������
//���N�G�X�g�B���C�x���g
//������������������������������������������������������������
function "Speedrun_Monkey6_Win"
{
	//���GON�E�F�X�I��������---------------------------
	SetFlag(SF_ALLMUTEKI,1)		//���G�n�m

	Wait(30)
	StopBGM(120)
	Wait(90)

	CallFunc("system:boss_end")
	SetFlag(SF_ADOL_JOINOK, FLAG[SF_ADOL_JOINOKBK])
	SetFlag(SF_LAXIA_JOINOK, FLAG[SF_LAXIA_JOINOKBK])
	SetFlag(SF_SAHAD_JOINOK, FLAG[SF_SAHAD_JOINOKBK])
	SetFlag(SF_HUMMEL_JOINOK, FLAG[SF_HUMMEL_JOINOKBK])
	SetFlag(SF_RICOTTA_JOINOK, FLAG[SF_RICOTTA_JOINOKBK])
	SetFlag(SF_DANA_JOINOK, FLAG[SF_DANA_JOINOKBK])

	//�L����������Ԃ̐ݒ�
	RestorePartyMember()						// �p�[�e�B�����o�[��߂�

	//�p�[�e�B��Ԃ̃��Z�b�g
	CallFunc("system:party_remove")
	CallFunc("system:party_reset")
	SetStopFlag(STOPFLAG_EVENT)
	
	// adding this line to remove the invisible walls after the fight
	MapAnime("CT_EVENT","open")							//……逃げられないストッパー解除

	// changed CueEvent to CallFunc
	CallFunc("mp5104:Speedrun_Monkey6_Win_ED")
}

function "Speedrun_Monkey6_Win_old"
{
	//���A�h���u�r�}�X�^�[�R���O
	//	�ː퓬�ɏ���

//�퓬�I��������������-----------------------------------------------

	//���GON�E�F�X�I��������---------------------------
	SetFlag(SF_ALLMUTEKI,1)								//�c�c���G�n�m

	Wait(90)											//�c�c�{�X���S���[�V���������違�h���b�v�A�C�e�����E������
	StopBGM(90)
	Wait(60)

	//�C�x���g�o�g���pCallFunc-------------------------
	CallFunc("system:boss_end")							//�c�c�C�x���g�o�g���p�̐F�X�ȏ������s��function

	//���������E�{�X����-------------------------------
	MapAnime("CT_EVENT","open")							//�c�c�������Ȃ��X�g�b�p�[����
	SetChrPos(mons_Monkey,-100000.00f,0.00f,0.00f)		//�c�c�{�X�������Ȃ��ʒu�ɔ�΂�
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))			//�c�c�U�R�Ȃ炱����

	//���㏈��-----------------------------------------
		////-----------------------------------
		//// �^�C���A�^�b�N��
		//if (FLAG[SF_TIMEATK])
		//{
		//	EndTimeAtk()		// �^�C���A�^�b�N�I���i�X�N���v�g���狭���I�ɔ����Ă��낢�돈�����Ă����j
		//}
		////-----------------------------------

	FadeOut(FADE_WHITE,FADE_NORMAL)
	WaitFade()

	SetFlag( GF_SPEEDRUN_SKILL_BATTLE, 0)	// ��荞�݃X�L���K���F�퓬���Ǘ��p�i1���퓬���j

//�퓬�I�����������܂�-----------------------------------------------
//�J�n������������----------------------------------------------------

//	CallFunc("system:event_begin")

	//�C�x���g�J�n�O���̕ۑ�
	SaveEventState()
	SaveCamera()

	// �p�[�e�B�Ґ��\�󋵂�߂�
	SetFlag(SF_ADOL_JOINOK, FLAG[SF_ADOL_JOINOKBK])
	SetFlag(SF_LAXIA_JOINOK, FLAG[SF_LAXIA_JOINOKBK])
	SetFlag(SF_SAHAD_JOINOK, FLAG[SF_SAHAD_JOINOKBK])
	SetFlag(SF_HUMMEL_JOINOK, FLAG[SF_HUMMEL_JOINOKBK])
	SetFlag(SF_RICOTTA_JOINOK, FLAG[SF_RICOTTA_JOINOKBK])
	SetFlag(SF_DANA_JOINOK, FLAG[SF_DANA_JOINOKBK])

	RestorePartyMember()						// �p�[�e�B�����o�[��߂�

	//�p�[�e�B��Ԃ̃��Z�b�g
	CallFunc("system:party_reset")

	//���̏������E�s�v�Ȃ��̂��B��
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//�L����������Ԃ̐ݒ�
	SetChrWork("ADOL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("ADOL",-663.58f,687.24f,49.21f)
	Turn("ADOL",-175.92f,360.0f)
	ChangeAnimation( "ADOL" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("ADOL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("ADOL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "ADOL" , INFOFLAG_NOCHRATARI)
	LookReset( "ADOL" )

	//�}�X�^�[�R���O
	SetChrWork("Monkey", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("Monkey",-663.64f, 691.55f, 49.19f)
	Turn("Monkey",5.55f,360.0f)
	ChangeAnimation( "Monkey" , "ANI_DEAD2", -1 , 1 )
	ChangeSubAnimation("Monkey",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("Monkey",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("Monkey",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "Monkey" , INFOFLAG_NOCHRATARI)

	SetChrWork("RICOTTA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("RICOTTA",-651.76f,688.58f,49.37f)
	Turn("RICOTTA",90.00f,360.0f)
	ChangeAnimation( "RICOTTA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("RICOTTA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("RICOTTA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "RICOTTA" , INFOFLAG_NOCHRATARI)
	LookReset( "RICOTTA" )

	SetChrWork("LAXIA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("LAXIA",-651.41f,687.62f,49.38f)
	Turn("LAXIA",87.87f,360.0f)
	ChangeAnimation( "LAXIA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("LAXIA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("LAXIA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "LAXIA" , INFOFLAG_NOCHRATARI)
	LookReset( "LAXIA" )

	SetChrWork("SAHAD", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("SAHAD",-651.01f,689.80f,49.38f)
	Turn("SAHAD",93.59f,360.0f)
	ChangeAnimation( "SAHAD" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("SAHAD",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("SAHAD",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "SAHAD" , INFOFLAG_NOCHRATARI)
	LookReset( "SAHAD" )

	SetChrWork("HUMMEL", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("HUMMEL",-650.78f,691.20f,49.31f)
	Turn("HUMMEL",93.59f,360.0f)
	ChangeAnimation( "HUMMEL" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("HUMMEL",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("HUMMEL",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "HUMMEL" , INFOFLAG_NOCHRATARI)
	LookReset( "HUMMEL" )

	//	�˃_�[�i������ꍇ
	if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
	{
		SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
		SetChrPos("DANA",-651.09f,686.46f,49.39f)
		Turn("DANA",87.87f,360.0f)
		ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
		ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
		ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
		SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)
		LookReset( "DANA" )
	}

	LookReset("Monkey")
	LookChr("ADOL", "Monkey")
	LookChr("LAXIA", "Monkey")
	LookChr("SAHAD", "Monkey")
	LookChr("RICOTTA", "Monkey")
	LookChr("HUMMEL", "Monkey")
	LookChr("DANA", "Monkey")

	// �A�h���̃G�t�F�N�g�����[�h
	SetFlag(TF_MENU_SELECT, 0)
	if (WORK[WK_ISEXIST_PLAYER1] && WORK[WK_PLAYER1] == ADOL)
	{
		// ���ɓǂݍ��ݍς�
		SetFlag(TF_MENU_SELECT, 1)
	}
	else if (WORK[WK_ISEXIST_PLAYER2] && WORK[WK_PLAYER2] == ADOL)
	{
		// ���ɓǂݍ��ݍς�
		SetFlag(TF_MENU_SELECT, 1)
	}
	else if (WORK[WK_ISEXIST_PLAYER3] && WORK[WK_PLAYER3] == ADOL)
	{
		// ���ɓǂݍ��ݍς�
		SetFlag(TF_MENU_SELECT, 1)
	}
	else if (WORK[WK_ISEXIST_PLAYER4] && WORK[WK_PLAYER4] == ADOL)
	{
		// ���ɓǂݍ��ݍς�
		SetFlag(TF_MENU_SELECT, 1)
	}

	if (FLAG[TF_MENU_SELECT] == 0)
	{
		// �܂��ǂ܂�ĂȂ�
		LoadEffect("efx_c000.ite")
	}

	//BGM�ݒ聟
	//PlayBGM( BGM_FIELD_101 , XX )
	PlayBGM(BGM_5104, 0)

	//�J�����ݒ�
	MoveCameraAt( 0 , -663.226f , 689.198f , 51.084f , 0 )	// �����_
	ChangeCameraDistance( 0 , 7.000f , 0 )		// ��{����
	ChangeCameraElevation( 0 , 2.586f , 0 )	// ��{�p
	RotateCamera( 0 , 310.139f , 0 )				// �p�x
	ChangeCameraPers( 0 , 60.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]
	// ResetCameraZPlane()	// �C�x���g�I�����ɌĂяo���ĉ������B�}�b�v���̐ݒ�ɖ߂��܂��B

	// ��ʊE�[�x�̐ݒ�
	SetDoF(0, LERP_LINEAR, 5.000, 250.000 ,1.000 ,0.700 ,0.600)
	// �O���A�̐ݒ�
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//�X�L�b�v����
	SetSkipScript("mp5104:Speedrun_Monkey6_Win_ED")

//�J�n���������܂�-----------------------------------------------

	Wait(10)

	FadeIn(FADE_WHITE,FADE_NORMAL)
	WaitFade()

	//�@�@��ʃt�F�[�h�C�����āA
	//�@�@���G�����Ă���}�X�^�[�R���O�Ƃ��̑O�ɃA�h���B	�������́F���G�����Ă���}�X�^�[�R���O�͉����͂ł�
	//�@�@���Ԃ͎��͂ɂ���B

	TalkPopup("LAXIA",0,0,0,0,0)
	{
		"#000e#000m�ӂӁA�ǂ����I������悤�ł��ˁB"
	}
	WaitPrompt()
	WaitCloseWindow()

	TalkPopup("RICOTTA",0,0,0,0,0)
	{
		"#000e#000m�A�h���Z����������[�̋Z�A�g���I"
	}
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�A�h���������A�N�����Ȃ������Ƀu���C�u�`���[�W�𔭓�����B
	HeadYes("ADOL" , 1 , 20)
	Wait(25)

	CrossFade(FADE_CROSS)
	MoveCameraAt( 0 , -670.817f , 686.345f , 50.340f , 0 )	// �����_
	ChangeCameraDistance( 0 , 3.800f , 0 )		// ��{����
	ChangeCameraElevation( 0 , 2.698f , 0 )	// ��{�p
	RotateCamera( 0 , 260.143f , 0 )				// �p�x
	ChangeCameraPers( 0 , 60.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]

	SetChrPos("ADOL",-663.58f,687.24f,49.21f)
	Turn("ADOL",77.49f,360.0f)
	LookReset("ADOL")
	Wait(FADE_CROSS)

	ChangeAnimation( "ADOL", "ANI_EV_SETARM", -1, 1 )
	WaitAnimation2( "ADOL" , -1, 1, "ANI_EV_SETARM",  0)
//	ChangeAnimation( "ADOL", "ANI_SP_A3", -1, 1 )	//��A3�E�u���C�u�`���[�W�F�n��
//	WaitAnimation2( "ADOL" , -1, 1, "ANI_SP_A3",  0)
	//(20140311�呐�F�X�L�������Ń_�b�V���ʂ�ς������ʃJ��������͂ݏo���Ă��܂����̂ŃC�x���g�p�̂�����č����ւ��܂���)
	ChangeAnimation( "ADOL", "ANI_EV_SP_A3", -1, 1 )	//��A3�E�u���C�u�`���[�W�F�n��
	WaitAnimation2( "ADOL" , -1, 1, "ANI_EV_SP_A3",  0)

	Wait(35)

	//PlaySE(SE_TUTORIAL, 100, 0, 0, 0, 1.0f, 0)	//�`���[�g���A��
	PlaySE( SE_SKILLLEARN , 100 , 0,  0, 0, 1.0f, 0)

	//	�i���[�V����
//	TalkPopup(UNDEF,0,5,0,0,0)
//	{
//		""
//		"#4C�A�h���̓X�L��#2C�u�u���C�u�`���[�W�v#4C���K�������I"
//	}
//	WaitPrompt()
//	WaitCloseWindow()

	Message("#4C�A�h���̓X�L��#2C�u�u���C�u�`���[�W�v#4C���K�������I")
	WaitPrompt()
	WaitCloseWindow()
	Wait(10)

	//�@�@��ʃN���X�t�F�[�h�ŁA�A�h�����Ĕz�u�����Ԃ������W�܂�B
	CrossFade(FADE_FAST)
	SetChrPos("ADOL",-663.50f,688.24f,49.21f)
	Turn("ADOL",-177.65f,360.0f)
	SetChrWork( "ADOL" , CWK_BATTLEMODE , 0 )
	ChangeAnimation( "ADOL", "ANI_WAIT", -1, 1 )	// �ҋ@
	LookChr("ADOL", "Monkey")
	SetChrPos("RICOTTA",-663.58f,687.24f,49.21f)
	Turn("RICOTTA",-175.92f,360.0f)
	SetChrPos("LAXIA",-664.53f,687.27f,49.20f)
	Turn("LAXIA",-173.53f,360.0f)
	SetChrPos("SAHAD",-662.60f,687.08f,49.21f)
	Turn("SAHAD",164.58f,360.0f)
	SetChrPos("HUMMEL",-663.19f,686.01f,49.21f)
	Turn("HUMMEL",-173.53f,360.0f)

	SetChrPos("Monkey",-663.30f, 691.99f, 49.19f)
	Turn("Monkey",5.55f,360.0f)

	//	�˃_�[�i������ꍇ
	if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
	{
		SetChrPos("DANA",-664.05f,686.29f,49.20f)
		Turn("DANA",177.76f,360.0f)
	}
	MoveCameraAt( 0 , -661.918f , 690.627f , 52.399f , 0 )	// �����_
	ChangeCameraDistance( 0 , 7.359f , 0 )		// ��{����
	ChangeCameraElevation( 0 , -9.053f , 0 )	// ��{�p
	RotateCamera( 0 , 326.872f , 0 )				// �p�x
	ChangeCameraPers( 0 , 60.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]
	// ResetCameraZPlane()	// �C�x���g�I�����ɌĂяo���ĉ������B�}�b�v���̐ݒ�ɖ߂��܂��B

	//MoveCameraAt( 0 , -661.918f , 690.627f , 51.655f , 0 )	// �����_
	//ChangeCameraDistance( 0 , 7.359f , 0 )		// ��{����
	//ChangeCameraElevation( 0 , -9.053f , 0 )	// ��{�p
	//RotateCamera( 0 , 326.872f , 0 )				// �p�x
	//ChangeCameraPers( 0 , 60.000f , 0 )			// ����p
	//SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ���[����]
	//// ResetCameraZPlane()	// �C�x���g�I�����ɌĂяo���ĉ������B�}�b�v���̐ݒ�ɖ߂��܂��B

	// �J�����ړ�
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -661.918f , 690.627f , 51.655f , 50 )

	Wait(FADE_CROSS)

	// �J�����҂�
	WaitThread(1000)

	//�@�@����Ƀ}�X�^�[�R���O�������オ���Ă���B
	ChangeAnimation( "Monkey", "ANI_RESURRECT", -1, 1 )
	PlaySE(SE_MONKEY_01, 60, 0, 0, 0, 1.0f, 0)
	Wait(10)
	PlayVoice(Y8V_5664, "xxx", 100)	//���فI�i�����m��u���̒ʂ�I�v�j
	Wait(10)
	PlaySE(SE_MONKEY_02, 60, 0, 0, 0, 1.0f, 0)
	WaitAnimation2( "Monkey" , -1, 1, "ANI_RESURRECT",  0)
	ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI_S", -1, 1 )
	WaitAnimation2( "Monkey" , -1, 1, "ANI_EV_UDEGUMI_S",  0)

	//�I����
	SetFlag(TF_MENU_SELECT,0)
	MenuReset()
	MenuType(MENUTYPE_POPUP)
	MenuAdd(1,"�����Ă���Ă��肪�Ƃ�")
	MenuAdd(2,"�L��g�킹�Ă��炤��")
	MenuOpen( TF_MENU_SELECT , -1 , ADOLMENU_PPOSY , -2 , -2 , 10 , 0)
	WaitMenu(0)
	MenuClose(10,0)
	//Wait(20)
	
	// ��U��Z�b�g
	ChangeAnimation( "ADOL", "ANI_EV_TEBURI", -1, 1 )
	SetChrWork("ADOL", CWK_FORCELIPSYNC, 1)	// �����N�`�p�N
	ChangeSubAnimation("ADOL",SUBMOT_EYE,ANI_E_WAIT_S,1)
	ChangeSubAnimation("ADOL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	Wait(30)
	//PlayVoice(Y8V_0160,"ADOL",100)	//���肪�Ƃ��i����̃e���V�����j
	ChangeSubAnimation("ADOL",SUBMOT_MOUTH,ANI_M_WAIT,1)
	SetChrWork("ADOL", CWK_FORCELIPSYNC, 0)
	Wait(20)
	
	//��������������������������������������������
	//	�ˋ����Ă���Ă��肪�Ƃ�
	if (FLAG[TF_MENU_SELECT] == 1)
	{
		//�@�@�}�X�^�[�R���O����b���[�V�����B
		ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI_NO", -1, 1 )
		Wait(40)
		
		TalkPopup("RICOTTA",0,2,0,0,0)
		{
			"#000e#000m�w�ʂɋ������킯�ł͂Ȃ��A"
			"�@���傪����Ɋo�����̂��x"
			"���������Ă�B"
		}
		WaitPrompt()
		WaitCloseWindow()

		if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
		{

			PlayVoice(Y8V_2997,"DANA",100)	//�ӂӁi���΁j
		
			TalkPopup("DANA",0,1,0,0,0)
			{
				"#000e#000m�ӂӁA���t������͏Ƃꉮ���ˁB"
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}
	//	�˗L��g�킹�Ă��炤��
	else if (FLAG[TF_MENU_SELECT] == 2)
	{
		//�@�@�}�X�^�[�R���O����b���[�V�����B
		ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI_YES", -1, 1 )
		Wait(40)
		
		TalkPopup("RICOTTA",0,2,0,0,0)
		{
			"#000e#000m�w�����A�ǂ�ǂ�g���Ƃ����x"
			"���������Ă�B "
		}
		WaitPrompt()
		WaitCloseWindow()

		if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
		{
			PlayVoice(Y8V_2997,"DANA",100)	//�ӂӁi���΁j
		
			TalkPopup("DANA",0,1,0,0,0)
			{
				"#000e#000m�ӂӁA���t������͗D�����ˁB"
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}
	//��������������������������������������������

	if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
	{

		ChangeAnimation( "SAHAD", "ANI_EV_RYOTEKOSI_S", -1, 1 )	// ���荘
		Wait(10)

		PlayVoice(Y8V_1411,"SAHAD",100)	//�K�n�n�i�T���߂ȏ΂��j

		TalkPopup("SAHAD",0,2,0,0,0)
		{
			"#000e#000m�K�n�n�A�܂��������B"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ChangeAnimation( "LAXIA", "ANI_EV_TEBURI", -1, 1 )	// ��U��

	TalkPopup("LAXIA",0,1,0,0,0)
	{
		"#000e#000m����ɂ��Ă��A����łU�l�S����"
		"�Z�������Ă���������ƂɂȂ�܂��ˁB"
	}
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�}�X�^�[�R���O�Ɂu�c�v�G���[�V�����B
	EmotionEx("Monkey", -0.50f, EMO_3DOT, 0, 5, 1, 1, 3.0f)	//�c
	Wait(52)

	ChangeAnimation( "HUMMEL", "ANI_EV_UDEGUMI_S", -1, 1 )	// �r�g

	TalkPopup("HUMMEL",0,1,0,0,0)
	{
		"#000e#000m�t���A�ǂ��������̂��H"
	}
	WaitPrompt()
	WaitCloseWindow()

	TalkPopup("RICOTTA",0,2,0,0,0)
	{
		"#000e#000m������c�c�H"
	}
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�}�X�^�[�R���O����b���[�V�����B
	ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI_TEBURI", -1, 1 )
	Wait(50)

	TalkPopup("RICOTTA",0,2,0,0,0)
	{
		"#000e#000m�w���傽���ɋ�����"
		"�@���邱�Ƃ͂����Ȃ����c�c�x\p"
		"�w���R�b�^�̃Z���p�C�a����"
		"�@�W������ςƕ����Ă���x\p"
		"�w�悯��Ώ��������Ă�낤�x"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "RICOTTA" , "ANI_EV_GUTSPOSE_S", -1 , 1 )

	TalkPopup("RICOTTA",0,2,0,0,0)
	{

		"�{�����A������[�I�H"
	}
	WaitPrompt()
	WaitCloseWindow()

//	//�@�@�}�X�^�[�R���O�������B
//	HeadYes("Monkey" , 1 , 25)
//	Wait(35)

	ChangeAnimation( "LAXIA", "ANI_EV_TEMUNE_S", -1, 1 )	// �苹����

	TalkPopup("LAXIA",0,1,0,0,0)
	{
		"#000e#000m�������Ƃ����Ɓc�c\p"
		"���������Č}�����"
		"�Q�����Ē�����̂ł����H"
	}
	WaitPrompt()
	WaitCloseWindow()

	TalkPopup("SAHAD",0,2,0,0,0)
	{
		"#000e#000m�K�n�n�A�����͐S�����ȁI"
	}
	WaitPrompt()
	WaitCloseWindow()

	if( FLAG[SF_DANA_JOINOK] )		// �_�[�i������
	{
		HeadYes("DANA", 1, 25)	// �L����, ���Ȃ�����, ����
		Wait(10)

		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000m���񂤂�A����ȏ�Ȃ������l����I\p"
			"�ˁA�A�h������B"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	//�@�@�A�h���������B
	HeadYes("ADOL" , 1 , 25)
	Wait(30)

	//�@�@�}�X�^�[�R���O����b���[�V�����B	
	ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI_YES", -1, 1 )
	Wait(30)

	ChangeAnimation( "RICOTTA" , "ANI_EV_GUTSPOSE_E", -1 , 1 )

	TalkPopup("RICOTTA",0,2,0,0,0)
	{
		"#000e#000m�w�ł͗��܂ꂽ�x\p"
		"�w�ꑫ��ɑ��֌����킹�Ă��炤�x"
	}
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�}�X�^�[�R���O���ޏꂷ�郂�[�V�����B�i�W�����v���Ȃ��������j
	ChangeAnimation( "Monkey", "ANI_EV_UDEGUMI_E", -1, 1 )
	WaitAnimation2( "Monkey" , -1, 1, "ANI_EV_UDEGUMI_E",  0)
	//Turn("Monkey", 115.69f, 8.0f)
	Wait(10)
	ChangeAnimation( "Monkey", "ANI_EV_JUMP_S", -1, 1 )

	LookReset("ADOL")
	LookReset("LAXIA")
	LookReset("SAHAD")
	LookReset("HUMMEL")
	LookReset("RICOTTA")
	LookReset("DANA")
	Wait(10)
	EarthQuake( 0.02f , 0.02f , 20 )	// �c�h�ꕝ, ���h�ꕝ, ����
	Blur(BLUR_TYPE_EXPAND, 0.2f, 30)	//�u���[

	WaitAnimation2( "Monkey" , -1, 1, "ANI_EV_JUMP_S",  0)
	SetChrPos("Monkey" , -100000.00f , 0.00f ,0.00f )
	
	Wait(20)
	
	CrossFade(FADE_FAST)
	
	MoveCameraAt( 0 , -663.549f , 687.403f , 50.731f , 0 )	// �����_
	ChangeCameraDistance( 0 , 2.630f , 0 )		// ��{����
	ChangeCameraElevation( 0 , -3.083f , 0 )	// ��{�p
	RotateCamera( 0 , 220.388f , 0 )				// �p�x
	ChangeCameraPers( 0 , 49.000f , 0 )			// ����p
	SetCameraZPlane( 0.100f , 1600.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ���[����]
	// ResetCameraZPlane()	// �C�x���g�I�����ɌĂяo���ĉ������B�}�b�v���̐ݒ�ɖ߂��܂��B

	Wait(FADE_FAST)
	
	PlayVoice(Y8V_0374,"LAXIA",100)	//�ӂӁi���΁j
	
	TalkPopup("LAXIA",0,2,0,0,0)
	{
		"#011e#080m�ӂӁA�v�������Ȃ����͂ł����ˁB"
		"����2�s��"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "RICOTTA" , "ANI_EV_RYOTEKOSI_S", -1 , 1 )
	PlayVoice(Y8V_2560,"RICOTTA",100)	//�R��i����̃e���V�����B�������ʂŎg�p�j

	TalkPopup("RICOTTA",0,2,0,0,0)
	{
		"#021e#080m�R��A������[������ΕS�l����"
		"�ہA��l�́I"
	}
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�A�h���������B
	HeadYes("ADOL" , 1 , 25 )
	ChangeSubAnimation("ADOL", SUBMOT_EYE, ANI_E_CLOSE_S, 1)
	Wait(15)
	ChangeSubAnimation("ADOL", SUBMOT_EYE, ANI_E_CLOSE_E, 1)
	Wait(25)

	SetEnvSEPlayState(-1, 0)	//��SE�S��~

	//�@�@��ʈÓ]�B
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	PlaySE(SE_BONDS_UP, 100, 0, 0, 0, 1.0f, 0)	//�D���x�A�b�v

	//	�i���[�V����
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S"
		"#-1W#4C�}�X�^�[�R���O�̍D���x���l�`�w�ɂȂ����I#10W"
		"#8S"
	}
	Wait(10)
	WaitPrompt()
	WaitCloseWindow()

	PlaySE(SE_TUTORIAL, 100, 0, 0, 0, 1.0f, 0)	//�`���[�g���A��

	//	�V�X�e���e�L�X�g
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S"
		"#-1W#4C�}�X�^�[�R���O���}����ɎQ�����邱�ƂɂȂ����I#10W" 
		"#8S"
	}
	Wait(10)
	WaitPrompt()
	WaitCloseWindow()

	//�@�@�C�x���g�I���A���싖�B

//�I��������������----------------------------------------------------
	CallFunc("mp5104:Speedrun_Monkey6_Win_ED")
}
function "Speedrun_Monkey6_Win_ED"
{
	//�I�������̓X�L�b�v�֎~
	SetSkipScript("")

	//�C�x���g�O�̃L�������𕜋A
	RestoreEventState()

	//�B�������̂𕜋A�B
	ResetChrPos((CHRTYPE_MONS | RESET_POS))
//	ResetChrPos((CHRTYPE_MONS | RESET_STATUS))
//	ResetChrPos((CHRTYPE_MONS | RESET_AISTATE))

	//�L�������[�V����������
	CallFunc("system:reset_chrmot_ALL")	

	//�p�[�e�B�L���������
	ReleaseEventPartyChr()

	// �G�t�F�N�g��j������
	if (FLAG[TF_MENU_SELECT] == 0)
	{
		// �ǉ��œǂ�ł���ꍇ�̂ݔj��
		ReleaseEffect("efx_c000.ite")
	}

	//�}�b�v�p�����[�^�[���Z�b�g
	ResetMapParam(-1)

	//�t���O����
	SetFlag( GF_SPEEDRUN_SKILL_ADOL, 1 )		// ��荞�݃X�L���K���F�E���A�h���u�r�}�X�^�[�R���O����������
	SetFlag( GF_LIKELV_SKILLMONKY, ( FLAG[GF_LIKELV_SKILLMONKY] + 1 ) )	// �D���x�t�o
	//SetFlag( GF_FAME_POINT, (FLAG[GF_FAME_POINT] + 3) )			//��荞�݁F�X�L�����퓬�R���v	�����l+3
	SetFlag(SF_BOSS_BATTLE, 0)		//�{�X��I��
	if(FLAG[GF_TBOX_DUMMY111]) //if skill shuffle is on
    {
        CallFunc("rng:0585")
    }
	else
	{
		GetSkill(PARTY_ADOL, SKILL_ADOL_SP_A3, 1)	//�u���C�u�`���[�W
	}
	
	CallFunc("rng:0428")

	//�}�[�J�[�폜
	DelMapMarker( SMI_SUBEVENT, PAGE_F036, MARKER_SPEEDRUN_SKILL5, 0, 0)	// ��荞�݃X�L���K���F�����炵���ɋ���}�X�^�[�R���O�p

	// �}�X�^�[�R���O����ʊO�Ɉړ��i�C�x���g�X�L�b�v�����ꍇ�p�ɓ���Ă���܂��j
	SetChrPos("Monkey" , -100000.00f  , 0.00f ,0.00f )

	CallFunc("mp5104:init")

	//�C�x���g��̍Ĕz�u
	SetChrPos("LEADER",-662.05f,686.55f,49.22f)
	Turn("LEADER",167.97f, 360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //�����҂��p

	//�J�����ʒu���A
	//MoveCameraAt( 0 , 0.0f , 0.0f , 0.0f , 0 )	// �����_
	//ChangeCameraDistance( 0 , 0.0f , 0 )		// ��{����
	//ChangeCameraElevation( 0 , 0.0f , 0 )		// ��{�p
	//RotateCamera( 0 , 0.0f , 0 )				// �p�x
	//ChangeCameraPers( 0 , 0.0f , 0 )			// ����p
	//SetCameraZPlane( 0 , 0.0f )					// ZPlane
	//RollCamera( 0 , 0.0f , 0 )					// ���[����]

	RestoreCamera(0, 0)		//����L�J�����ʒu���w�肷��ꍇ�͕s�v
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	SetEnvSEPlayState(-1, 1)	//��SE

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()

//�I�����������܂�----------------------------------------------------
}
