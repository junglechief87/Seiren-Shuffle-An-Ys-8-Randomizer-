#include "inc/mons.h"
#include "inc/def.h"
#include "inc/flag.h"
#include "inc/se.h"
#include "inc/scr_inc.h"
#include "inc/3dicon.h"
#include "inc/skilldef.h"
#include "inc/vo.h"
#include "inc/music.h"
#include "inc/efx.h"
#include "inc/temp/mp6401m.h"

//----------------------------------------------------------------------------//
//                                                                            //
// 王都西街区（過去）
//                                                                            //
//----------------------------------------------------------------------------//
///////////////////////////////////////////////////////////////////////////////
// 初期化スクリプト
///////////////////////////////////////////////////////////////////////////////
//-------------------------------------------

function "init"
{
	CallFunc("rng:expMult")
	//遠景不必要ノード削除◆マップ作業者用
	MapHide( "@BG2_etania" , 0 )
	MapHide( "BG2_groundfog_forest" , 0 )
	MapHide( "BG2_grandtemple" , 0 )

	// イベントエリア設定制御
	EventAreaEnable( "SubEV_Past_04_Gimmick" , 0 )	// 過去編Ⅳ：【過去ギミック④：大僧院の扉を直す】
	EventAreaEnable( "Stopper_Past_D3_06" , 0 )		// ダーナ編③：【ストッパー：大僧院に入れない】
	EventAreaEnable( "Stopper_Past_02_06" , 0 )		// 過去編Ⅱ：【ストッパー：大僧院に入れない】
	EventAreaEnable( "Stopper_Past_04_05" , 0 )		// 過去編Ⅳ：【ストッパー：大僧院に入れない】

	if( FLAG[SF_EVENT_ON] )
	{

		MapAnime("dragon_gate_all_A1","open")	//◆仮処理

		// イベントエリア制御
		if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] &&		//▼過去編Ⅳ王宮前へ向かう
			FLAG[GF_SUBEV_PAST_04_GIMMICK] < 2 )		//過去編Ⅳ：【過去ギミック④：大僧院の扉を直す】を見た（1:見て立ち去った、2:直すように口添えした）
		{
			EventAreaEnable( "SubEV_Past_04_Gimmick" , 1 )		// 過去編Ⅳ：【過去ギミック④：大僧院の扉を直す】
		}
	
		// ストッパー制御
		if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )		//▼ダーナ編③王都を歩く
		{
			EventAreaEnable( "Stopper_Past_D3_06" , 1 )	// ダーナ編③：【ストッパー：大僧院に入れない】
		}
		if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )		//▼過去編Ⅱ南門へ向かう
		{
			EventAreaEnable( "Stopper_Past_02_06" , 1 )	// 過去編Ⅱ：【ストッパー：大僧院に入れない】
		}
		if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
		{
			EventAreaEnable( "Stopper_Past_04_05" , 1 )	// 過去編Ⅳ：【ストッパー：大僧院に入れない】
		}
	
		//一般配置ファンクション呼び出し
		CallFunc("mp6203m:NpcPosition")
	
		//ＮＰＣマーカーセット
		CallFunc("system:SetMarkerNPC")
	}
}

//////////////////////////////////////////////////////////////////////
//■一般配置
//////////////////////////////////////////////////////////////////////
function "NpcPosition"
{
	//◆仮入力：【QS522】クエストの入力のため、仮配置しました
	if( FLAG[GF_PAST_EPISODE_6_GO_GARDEN] )				//▼過去編Ⅵセレンの園へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )		//▼過去編Ⅴ王家の谷へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_4_2_GO_OUT] )			//▼過去編Ⅳ-２王宮の外へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )		//▼過去編Ⅳ王宮前へ向かう
	{
		SetChrPos("Matos",-541.17f	848.51f	2.75f)
		Turn("Matos",-172.19f,360.0f)
		ChangeAnimation("Matos","ANI_EV_WAIT_BUKI", -1 , 1 )	//	モーション	：歩哨待機
		SetChrPos("eq4029_1",-541.17f	848.51f	2.75f)			//槍
		SetParent( "eq4029_1" , "Matos", "Null_Rhand" )		//槍
		ChangeAnimation("eq4029_1","ANI_WAIT_c380", -1 , 1 )	//	c380用

		//カジュラ			//	場所		：王都西街区（過去）
//		SetChrPos("Kajura",-453.42f,863.93f,1.43f)
//		Turn("Kajura",84.98f,360.0f)
		SetChrPos("Kajura",-443.35f	851.33f	1.43f)
		Turn("Kajura",130.76f,360.0f)
		//NPC_Move_t01

		SetChrInfoFlag( "Jirul" , INFOFLAG_NOMAPATARICHECK )
		SetChrInfoFlag( "Jirul" , INFOFLAG_NOGRAVITY )
		SetChrPos("Jirul",-510.31f	895.55f	1.43f)
		Turn("Jirul",-58.29f,360.0f)
		ChangeAnimation("Jirul","ANI_EV_SIT_C", -1 , 1 )	
		
//		// 男性				//	場所		：王都西街区（過去）・僧院前 ※過去ギミック④登場キャラ
//		SetChrPos("mp6203m_citizen2",-531.09f,830.37f,5.64f)
//		Turn("mp6203m_citizen2",94.38f,360.0f)
//		
//		// 男性				//	場所		：王都西街区（過去）・僧院前 ※過去ギミック④登場キャラ
//		SetChrPos("mp6203m_citizen3",-532.57f,830.06f,5.64f)
//		Turn("mp6203m_citizen3",-98.79f,360.0f)
//		
//		// 青年				//	場所		：王都西街区（過去）・僧院前 ※過去ギミック④登場キャラ
//		SetChrPos("mp6203m_citizen4",-532.33f,831.23f,5.64f)
//		Turn("mp6203m_citizen4",-57.89f,360.0f)
		// 男性				//	場所		：王都西街区（過去）・僧院前 ※過去ギミック④登場キャラ
		SetChrPos("mp6203m_citizen2",-530.40f	831.34f	5.64f)
		Turn("mp6203m_citizen2",62.93f,360.0f)
		
		// 男性				//	場所		：王都西街区（過去）・僧院前 ※過去ギミック④登場キャラ
		SetChrPos("mp6203m_citizen3",-532.05f	830.61f	5.64f)
		Turn("mp6203m_citizen3",-156.14f,360.0f)
		
		// 青年				//	場所		：王都西街区（過去）・僧院前 ※過去ギミック④登場キャラ
		SetChrPos("mp6203m_citizen4",-532.57f	832.50f	5.64f)
		Turn("mp6203m_citizen4",-20.57f,360.0f)
	}
	else if( FLAG[GF_PAST_EPISODE_3_GO_BAHA] )			//▼過去編Ⅲバハの塔へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )		//▼過去編Ⅱ南門へ向かう
	{
		SetChrPos("Matos",-541.17f	848.51f	2.75f)
		Turn("Matos",-172.19f,360.0f)
		ChangeAnimation("Matos","ANI_EV_WAIT_BUKI", -1 , 1 )	//	モーション	：歩哨待機
		SetChrPos("eq4029_1",-541.17f	848.51f	2.75f)			//槍
		SetParent( "eq4029_1" , "Matos", "Null_Rhand" )		//槍
		ChangeAnimation("eq4029_1","ANI_WAIT_c380", -1 , 1 )	//	c380用

		//カジュラ			//	場所		：王都西街区（過去）
//		SetChrPos("Kajura",-453.42f,863.93f,1.43f)
//		Turn("Kajura",84.98f,360.0f)
		SetChrPos("Kajura",-443.35f	851.33f	1.43f)
		Turn("Kajura",130.76f,360.0f)
		//NPC_Move_t01

		SetChrInfoFlag( "Jirul" , INFOFLAG_NOMAPATARICHECK )
		SetChrInfoFlag( "Jirul" , INFOFLAG_NOGRAVITY )
		SetChrPos("Jirul",-510.31f	895.55f	1.43f)
		Turn("Jirul",-58.29f,360.0f)
		ChangeAnimation("Jirul","ANI_EV_SIT_C", -1 , 1 )	

		SetChrPos("Cryo",-547.79f	879.63f	1.43f)
		Turn("Cryo",-143.94f,360.0f)
		//free_s2

		if(!FLAG[GF_SUBEV_PAST_02_GIMMICK_A])		//[【過去ギミック②：鍵の話を聞く】
		{
			//青年
			SetChrPos("mp6203m_citizen1",-514.62f,838.37f,1.25f)
			Turn("mp6203m_citizen1",-40.69f,360.0f)
		}
	}
	else if( FLAG[GF_PAST_EPISODE_1_GO_CAMP] )			//▼過去編Ⅰアドルがいたポイントへ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )	//▼ダーナ編③王都を歩く
	{
		SetChrPos("Matos",-525.67f	846.99f	2.75f)
		Turn("Matos",-174.26f,360.0f)
		ChangeAnimation("Matos","ANI_EV_WAIT_BUKI", -1 , 1 )	//	モーション	：歩哨待機
		SetChrPos("eq4029_1",-525.80f	848.98f	2.75f)			//槍
		SetParent( "eq4029_1" , "Matos", "Null_Rhand" )		//槍
		ChangeAnimation("eq4029_1","ANI_WAIT_c380", -1 , 1 )	//	c380用

		SetChrPos("Shenna",-532.37f	849.03f	2.75f)
		Turn("Shenna",167.51f,360.0f)
		SetFlag( TF_CAMERATALK_SHENNA, 1 )

		SetChrPos("Cesil",-534.38f	848.29f	2.75f)
		Turn("Cesil",-140.11f,360.0f)
		ChangeAnimation("Cesil","ANI_EV_RYOTEMAE", -1 , 1 )

		SetChrPos("Citizen_D3_A01",-532.71f,850.58f,2.75f)
		Turn("Citizen_D3_A01",-5.52f,360.0f)
		LookChr("Shenna","Citizen_D3_A01")
		LookChr("Citizen_D3_A01","Shenna")

		SetChrPos("Citizen_D3_A02",-534.14f,852.48f,2.75f)
		Turn("Citizen_D3_A02",-12.75f,360.0f)

		//カジュラ			//	場所		：王都西街区（過去）
//		SetChrPos("Kajura",-453.42f,863.93f,1.43f)
//		Turn("Kajura",84.98f,360.0f)
		SetChrPos("Kajura",-443.35f	851.33f	1.43f)
		Turn("Kajura",130.76f,360.0f)
		//NPC_Move_t01

		SetChrInfoFlag( "Jirul" , INFOFLAG_NOMAPATARICHECK )
		SetChrInfoFlag( "Jirul" , INFOFLAG_NOGRAVITY )
		SetChrPos("Jirul",-510.31f	895.55f	1.43f)
		Turn("Jirul",-58.29f,360.0f)
		ChangeAnimation("Jirul","ANI_EV_SIT_C", -1 , 1 )	

	}
	else //▼ダーナ編①Ａ寺院内を歩く
	{
	}
}


function "NPC_Move_t01"
{
	SetFlag( TF_NPC_MOVE_T01_MODE, 0 )

	while(1)
	{
		MoveTo(this,-454.27f,859.35f,1.43f,0.5f,0.25f)
		SetFlag( TF_NPC_MOVE_T01_MODE, 1 )
		MoveTo(this,-495.00f,864.31f,1.43f,0.5f,0.25f)
		SetFlag( TF_NPC_MOVE_T01_MODE, 2 )
		MoveTo(this,-517.17f,879.37f,1.43f,0.5f,0.25f)
		SetFlag( TF_NPC_MOVE_T01_MODE, 3 )
		Wait(60)
		MoveTo(this,-495.00f,864.31f,1.43f,0.5f,0.25f)
		SetFlag( TF_NPC_MOVE_T01_MODE, 4 )
		MoveTo(this,-454.27f,859.35f,1.43f,0.5f,0.25f)
		SetFlag( TF_NPC_MOVE_T01_MODE, 5 )
		MoveTo(this,-438.05f,848.87f,1.67f,0.5f,0.25f)
		SetFlag( TF_NPC_MOVE_T01_MODE, 0 )
		Wait(60)
	}
}
//★パッチ1.01対応：ルートムーブNPCの座標強制指定用ファンクション
function "NPC_Move_t01_Pos"
{
	//Kajura専用。

	if( FLAG[TF_NPC_MOVE_T01_MODE] == 0 )
	{
		SetChrPos( "Kajura",-438.05f,848.87f,1.67f)
		Turn("Kajura",126.29f,360.0f)
	}
	else if( FLAG[TF_NPC_MOVE_T01_MODE] == 1 )
	{
		SetChrPos( "Kajura",-454.27f,859.35f,1.43f)
		Turn("Kajura",97.26f,360.0f)
	}
	else if( FLAG[TF_NPC_MOVE_T01_MODE] == 2 )
	{
		SetChrPos( "Kajura",-495.00f,864.31f,1.43f)
		Turn("Kajura",123.78f,360.0f)
	}
	else if( FLAG[TF_NPC_MOVE_T01_MODE] == 3 )
	{
		SetChrPos( "Kajura",-517.17f,879.37f,1.43f)
		Turn("Kajura",-56.53f,360.0f)
	}
	else if( FLAG[TF_NPC_MOVE_T01_MODE] == 4 )
	{
		SetChrPos( "Kajura",-495.00f,864.31f,1.43f)
		Turn("Kajura",-82.79f,360.0f)
	}
	else if( FLAG[TF_NPC_MOVE_T01_MODE] == 5 )
	{
		SetChrPos( "Kajura",-454.27f,859.35f,1.43f)
		Turn("Kajura",-57.72f,360.0f)
	}
}




////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//■一般会話セクション

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//──────────────────────────────
//	【衛士マトス】
//──────────────────────────────
function "Talk_Matos"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	LookChr("this","LEADER")

	if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：
		//	モーション	：歩哨
		//───────────────
		if( FLAG[GF_SUBEV_PAST_04_GIMMICK] != 2 )
		{
			if( !FLAG[TF_MATOS_TALK] )
			{
				PlayVoice(Y8V_5757,"this",100)	//ふむ

				//	衛士マトス
				TalkPopup("this",0,0,0,0,0)
				{
					"ふむ、気にはなりますが"
					"衛士の出る幕ではないですし……\p"
					"……失礼、少々"
					"注意が散漫になっていたようです。\p"
					"職務に集中するといたしましょう。"
				}
				WaitPrompt()
				WaitCloseWindow()
				SetFlag( TF_MATOS_TALK, 1 )
			}
			else
			{
				//　　★繰り返し
				//　　※カメラ切り替えなし
				//	衛士マトス
				TalkPopup("this",0,0,0,0,0)
				{
					"失礼いたしました。\p"
					"大樹の巫女様、何かございましたら"
					"我らに申しつけ下さいますよう。"
				}
				WaitPrompt()
				WaitCloseWindow()
			}
		}
		else
		{
			//　　★【過去ギミック④：大僧院の扉を直す】達成後
			//	衛士マトス
			TalkPopup("this",0,0,0,0,0)
			{
				"扉が直る見込みが立ったのですね。\p"
				"よかった、これで市民たちも安心して"
				"大僧院に来れましょう……\p"
				"コホン、大樹の巫女様、"
				"自分からもお礼申し上げます。"
			}
			WaitPrompt()
			WaitCloseWindow()
		}

	}
	else if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )			//▼過去編Ⅱ南門へ向かう
	{
		//▼過去編Ⅱ南門へ向かう
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：
		//	モーション	：歩哨
		//───────────────

		PlayVoice(Y8V_5741,"this",100)	//ダーナ様（呼びかけ）

		//	衛士マトス
		TalkPopup("this",0,0,0,0,0)
		{
			"竜種にも知能を持つものはいますが、"
			"我らとは比べ物になりませんね。\p"
			"何より、竜種は理力が扱えません。\p"
			"どれほど知恵を身につけても"
			"所詮は獣の一種ということでしょう。"
		}
		WaitPrompt()
		WaitCloseWindow()

	}
	else if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )			//▼ダーナ編③王都を歩く
	{
		//▼ダーナ編③王都を歩く
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：
		//	モーション	：歩哨
		//───────────────
		if( !FLAG[TF_MATOS_TALK] )
		{

			PlayVoice(Y8V_5746,"this",100)	//どうも

			//	衛士マトス
			TalkPopup("this",0,0,0,0,0)
			{
				"ようこそ、ボラド大僧院へ。\p"
				"ここは王都での冠婚葬祭"
				"全てを執り行う僧院です。\p"
				"本日も多くの市民が訪れていますよ。"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_MATOS_TALK, 1 )
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//	衛士マトス
			TalkPopup("this",0,0,0,0,0)
			{
				"ここは王都での冠婚葬祭 "
				"全てを執り行う僧院です。\p "
				"本日も多くの市民が訪れていますよ。 "
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
}

//──────────────────────────────
//	【修道女シェンナ】
//──────────────────────────────
function "Talk_Shenna"
{
	if( !FLAG[TF_CAMERATALK_SHENNA] )
	{
		SetStopFlag(STOPFLAG_TALK)
		CallFunc("system:talk_begin_zoom")		//TALK_ZOOM
	}

	if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )			//▼ダーナ編③王都を歩く
	{
		//▼ダーナ編①Ａ寺院内を歩く
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：市民と話している
		//	モーション	：
		//───────────────
		if( !FLAG[TF_SHENNA_TALK] )
		{
			//────────  一般・開始処理(過去編)  ──────────
			SetStopFlag(STOPFLAG_TALK2)
			//───────────────
			//	場所		：大峡谷（過去）・スタート地点
			//───────────────
			//	配置・カメラ：
			//	モーション	：
			//───────────────
			SaveCamera()
			ChangeCameraPers( 0 , 60.000f , 0 )	// 視野角
			SetCameraZPlane( 0.500f , 900.000f )	// ZPlane
			RollCamera( 0 , 0.0f , 0 )		// ロール回転
			MoveCameraAt( 0 , -532.109f , 849.425f , 4.344f , 0 )	// 注視点
			MoveCamera( 0 , -531.660f , 850.028f , 4.453f , 0 )		// 視点
			// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

			//キャラ初期動作の記述
			LookSpd("this", 1.0f, 1.0f, 1.0f)
//			LookTo("this",-531.68f	849.98f	4.45f)	// 首を正面に向ける
			LookTo("this",-532.24f	849.55f	4.25f)	// 首を正面に向ける
			Turn("Shenna",-163.23f,360.0f)

			ChangeSubAnimation("this",SUBMOT_EYE,ANI_E_MAJI_CLOSE,1)

			CallFunc("system:talkevent_begin_ps")		//TALK_BEGIN
			LookSpd("this", LOOKSPD_DEFAULT, LOOKSPD_DEFAULT, LOOKSPD_DEFAULT)
			//───────────────────────────────

			//	修道女シェンナ
			TalkPopup("this",0,0,0,0,0)
			{
				"#000mオルガ様が祭司長に"
				"なられてから早３年……\p"
				"私だって、修行を続けてきたんです。"
			}
			WaitPrompt()
			WaitCloseWindow()

			ChangeSubAnimation("this",SUBMOT_EYE,ANI_E_MAJI_CLOSE_E,1)
			LookTo("this",-531.68f	849.98f	4.35f)	// 首を正面に向ける

			TalkPopup("this",0,0,0,0,0)
			{
				"いつか立派な祭司になって"
				"オルガ様のお役に立つんですから。"
			}
			WaitPrompt()
			WaitCloseWindow()

			ChangeAnimation("this","ANI_EV_TEBURI", -1 , 1 )

			TalkPopup("this",0,0,0,0,0)
			{
				"ええ、ここでびしっとこなして"
				"『お喋りシェンナ』の渾名を"
				"返上してみせます！"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_SHENNA_TALK, 1 )
			SetFlag( TF_CAMERATALK_SHENNA, 0 )
			Turn("Shenna",167.51f,360.0f)
			CallFunc("system:talkevent_end_ps")		//TALK_END
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//　　振り返らない
			//	修道女シェンナ
			TalkPopup("this",0,0,0,0,0)
			{
				"集中、集中……！"
				"今日の私は喋りませんよ……！"
			}
			WaitPrompt()
			WaitCloseWindow()

			//　　セシル、シェンナに向く
			LookChr("Cesil","Shenna")
			//	修道女セシル
			TalkPopup("Cesil",0,0,0,0,0)
			{
				"シェンナ、言霊を唱えないと"
				"術が発動しませんよ。"
			}
			WaitPrompt()
			WaitCloseWindow()

//			EmotionEx("this", 0.00f, EMO_GIKU, 0, 5, 1, 1, 1.8f)	//ぎくっ／ガーン／ぎょっ
//			Wait(20)

			//	修道女シェンナ
			TalkPopup("this",0,0,0,0,0)
			{
				"はっ、そうでした……"
			}
			WaitPrompt()
			WaitCloseWindow()

			//　　セシルとダーナに冷や汗エモーション
			EmotionEx("Cesil",0.00f,EMO_TARA,0,5,1,1,1.8f)	// 冷や汗
			EmotionEx("PLAYER1",0.00f,EMO_TARA,0,5,1,1,1.8f)	// 冷や汗
			Wait(45)
			LookReset("Cesil")
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
	LookChr("Shenna","Citizen_D3_A01")
}
//──────────────────────────────
//	【修道女セシル】
//──────────────────────────────
function "Talk_Cesil"
{
//	SetStopFlag(STOPFLAG_TALK)
//	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )			//▼ダーナ編③王都を歩く
	{
		//▼ダーナ編①Ａ寺院内を歩く
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：
		//	モーション	：
		//───────────────
		//　　★ＧＦ初回
		if( !FLAG[GF_1STTALK_PAST_D3_CESIL] )
		{
			//────────  一般・開始処理(過去編)  ──────────
			SetStopFlag(STOPFLAG_TALK2)
			//───────────────
			//	場所		：大峡谷（過去）・スタート地点
			//───────────────
			//	配置・カメラ：
			//	モーション	：
			//───────────────
			SaveCamera()
			MoveCameraAt( 0 , -534.233f , 848.604f , 4.320f , 0 )	// 注視点
			ChangeCameraDistance( 0 , 0.900f , 0 )		// 基本距離
			ChangeCameraElevation( 0 , 6.057f , 0 )	// 基本仰角
			RotateCamera( 0 , 152.012f , 0 )				// 角度
			ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
			SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
			RollCamera( 0 , 0.0f , 0 )				// ロール回転
			// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

			//キャラ初期動作の記述
			LookSpd("this", 1.0f, 1.0f, 1.0f)
			LookTo("this",-533.93f	849.03f	4.35f)	// 首を正面に向ける

			ChangeSubAnimation("this",SUBMOT_MOUTH,ANI_M_SMILE,1)

			CallFunc("system:talkevent_begin")		//TALK_BEGIN
			LookSpd("this", LOOKSPD_DEFAULT, LOOKSPD_DEFAULT, LOOKSPD_DEFAULT)
			//───────────────────────────────

			//	修道女セシル
			TalkPopup("this",0,0,0,0,0)
			{
				"#080mあらダーナ様……"
				"こんな所までいらしていたのですか。"
			}
			WaitPrompt()
			WaitCloseWindow()

			//	"DANA"
			TalkPopup("LEADER",0,3,160,236,0)		//一人称ダーナ：左
			{
				"#000e#000mふふ、少しばかり寄り道を。\p"
				"２人は修行に来ているようですね？"
			}
			WaitPrompt()
			WaitCloseWindow()

			ChangeSubAnimation("this",SUBMOT_EYE,ANI_E_CLOSE_S,1)
			HeadYes("this" , 1 , 25)

			//	修道女セシル
			TalkPopup("this",0,0,0,0,0)
			{
				"ええ、修行の一環として"
				"民間への奉仕活動を。\p"
				"#012e今日は理力を使って傷を癒し"
				"進むべき道を占う《大道》……\p"
				"それに、大樹の葉を使って大いなる"
				"加護を与える《稟奉儀》ですね。"
			}
			WaitPrompt()
			WaitCloseWindow()

			//	"DANA"
			TalkPopup("LEADER",0,3,160,236,0)		//一人称ダーナ：左
			{
				"#000e#000mもうそんな術まで……？\p"
				"まだシェンナには難しいでしょうが、"
				"よく導いてあげてください。"
			}
			WaitPrompt()
			WaitCloseWindow()

			//	修道女セシル
			TalkPopup("this",0,0,0,0,0)
			{
				"#021eふふ、ありがとうございます。"
				"励みにさせていただきますね。"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( GF_1STTALK_PAST_D3_CESIL, 1 )
			CallFunc("system:talkevent_end_ps")		//TALK_END
		}
		else
		{
			//　　★ＧＦ以降

			SetStopFlag(STOPFLAG_TALK)
			CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

			LookChr("this","LEADER")

			if( !FLAG[TF_CESIL_TALK] )
			{
				//	修道女セシル
				TalkPopup("this",0,0,0,0,0)
				{
					"ふふ、今日の奉仕活動は"
					"ウルグナータ様のご指示なので"
					"少し厳しめですね。\p"
					"でも人々と触れ合うのも"
					"修道女にとって大切な事です。\p"
					"シェンナも張り切って"
					"いるようですし。\p"
					"先輩として、しっかり"
					"導いてやらなくてはなりませんね。"
				}
				WaitPrompt()
				WaitCloseWindow()
				SetFlag( TF_CESIL_TALK, 1 )
			}
			else
			{
				//　　★繰り返し
				//　　※カメラ切り替えなし
				//	修道女セシル
				TalkPopup("this",0,0,0,0,0)
				{
					"人々と触れ合うのも"
					"修道女にとって大切な事です。\p "
					"シェンナも張り切っていますし、"
					"先輩として、しっかり "
					"導いてやらなくてはなりませんね。 "
				}
				WaitPrompt()
				WaitCloseWindow()
			}
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
}

//──────────────────────────────
//	【王都市民】（中年男性）
//──────────────────────────────
function "Talk_Citizen_D3_A01"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )			//▼ダーナ編③王都を歩く
	{
		//▼ダーナ編③王都を歩く
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：シェンナと話す
		//	モーション	：
		//───────────────
		if( !FLAG[TF_TALK_MOB01] )
		{
			//　　振り返らない
			//	王都市民
			TalkPopup("this",0,0,0,0,0)
			{
				"おお、持病の痛みが嘘のようだ……"
			}
			WaitPrompt()
			WaitCloseWindow()

			ChangeAnimation( "Citizen_D3_A01", "ANI_EV_PRAY_S", -1, 1 )

			TalkPopup("this",0,0,0,0,0)
			{
				"ありがとうございます、修道女さま！"
				"大樹の恵みに感謝いたします！"
			}
			WaitPrompt()
			WaitCloseWindow()

			//　　シェンナにアセアセエモーション
			EmotionEx("Shenna", 0.00f, EMO_ASE, 0, 8, 2, 1, 2.0f )	// 「あせあせ」
			Wait(45)
			//	修道女シェンナ
			TalkPopup("Shenna",0,0,0,0,0)
			{
				"い、いえいえ、それほどでも。"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_TALK_MOB01, 1 )
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//	王都市民
			TalkPopup("this",0,0,0,0,0)
			{
				"ありがとうございます、修道女さま！"
				"大樹の恵みに感謝いたします！"
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
	
	LookChr("Citizen_D3_A01","Shenna")
}

//──────────────────────────────
//	【女性】（中年女性）
//──────────────────────────────
function "Talk_Citizen_D3_A02"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )			//▼ダーナ編③王都を歩く
	{
		//▼ダーナ編③王都を歩く
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：シェンナの近く（順番待ちする）
		//	モーション	：
		//───────────────
		//	女性
		TalkPopup("this",0,0,0,0,0)
		{
			"今日は修道女さまが"
			"いらっしゃっているんですよ。\p"
			"治水工事に出ている夫が心配で……"
			"大樹の加護を授けてもらおうかしら。"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ResetStopFlag(STOPFLAG_TALK)
}

//──────────────────────────────
//	【カジュラ】
//──────────────────────────────
function "Talk_Kajura"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	//【QS522】奮起の演奏会（オースティン）
	if( FLAG[GF_QUEST_522] == QUEST_START &&
		FLAG[GF_QS522_TALK_SERACH1] &&		//【QS522】▼楽譜探しイベント① を見た
		!FLAG[GF_QS522_TALK_SERACH2] )		//【QS522】▼楽譜探しイベント② を見た
	{
		//──────────────────────────────
		//▼楽譜探しイベント②
		//──────────────────────────────
		//　　過去編のどこでもいいので、
		//　　カジュラに話しかけるとイベント開始。
		
		LookChr("this", "LEADER")
		
		TalkPopup("PLAYER1",0,0,0,0,0)
		{
			"#000e#000mあなたがカジュラさん、かな？\p"
			"『蒼き豊穣』の楽譜を"
			"持ってるって聞いたんだけど……"
		}
		WaitPrompt()
		WaitCloseWindow()

		//	カジュラ
		TalkPopup("this",0,0,0,0,0)
		{
			"#000e#000mあら、巫女様じゃない。\p"
			"確かに竪琴の練習がしたくって、"
			"詩人さんから楽譜をもらったけど……\p"
			"大体覚えたから、もう譲っちゃったの。\p"
			"大体2行目"
			"確か……ラステル君だったかな。"
		}
		WaitPrompt()
		WaitCloseWindow()


		//ダーナにPAエモーション。
		EmotionEx("PLAYER1", 0.00f, EMO_PA, 0, 5, 1, 1, 1.0f)	//パッ
		Wait(50)

		TalkPopup("PLAYER1",0,0,0,0,0)
		{
			"#000e#000mラステルに……そうなんだ。\p"
			"教えてくれてありがとう。"
		}
		WaitPrompt()
		WaitCloseWindow()

		//　　イベント終了、操作許可。
		SetFlag( GF_QS522_TALK_SERACH2, 1 )	//【QS522】▼楽譜探しイベント② を見た
	}
	else if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )		//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//───────────────
		//	場所		：王都西街区（過去）
		//───────────────
		//	配置・カメラ：入り口付近～中央広場をルートムーブ
		//	モーション	：
		//───────────────
		//	カジュラ
		TalkPopup("this",0,0,0,0,0)
		{
			"オケアノスは海生竜種の中でも"
			"最大級に成長するのよね。\p"
			"獰猛で、大型船でも容赦なく襲うから"
			"《海竜王》なんて呼ばれているそうよ。\p"
			"最近数が増えているとか……"
			"ちょっと怖いわね。"
		}
		WaitPrompt()
		WaitCloseWindow()

	}
	else if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )			//▼過去編Ⅱ南門へ向かう
	{
		//▼過去編Ⅱ南門へ向かう
		//───────────────
		//	場所		：王都西街区（過去）
		//───────────────
		//	配置・カメラ：入り口付近～中央広場をルートムーブ
		//	モーション	：
		//───────────────
		if( !FLAG[TF_KAJURA_TALK] )
		{
			
			PlayVoice(Y8V_5762,"this",100)	//えーと
			
			//	カジュラ
			TalkPopup("this",0,0,0,0,0)
			{
				"王都の人は、死んだら"
				"大僧院の墓地に入るわけだけど。\p"
				"王族だけは特別な場所に"
				"埋葬されるのよね。\p"
				"その名も《王家の谷》……\p"
				"そこに葬られた王族は"
				"死後も永遠に生きられるそうよ。"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_KAJURA_TALK, 1 )
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//	カジュラ
			TalkPopup("this",0,0,0,0,0)
			{
				"王族だけは特別な場所に "
				"埋葬されるのよね。\p "
				"その名も《王家の谷》……\p"
				"そこに葬られた王族は"
				"死後も永遠に生きられるそうよ。"
			}
			WaitPrompt()
			WaitCloseWindow()
		}

	}
	else if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )			//▼ダーナ編③王都を歩く
	{
		//▼ダーナ編③王都を歩く
		//───────────────
		//	場所		：王都西街区（過去）
		//───────────────
		//	配置・カメラ：入り口付近～中央広場をルートムーブ
		//	モーション	：
		//───────────────
		if( !FLAG[TF_KAJURA_TALK] )
		{

			PlayVoice(Y8V_5762,"this",100)	//えーと

			//	カジュラ
			TalkPopup("this",0,0,0,0,0)
			{
				"この辺りは職人とか"
				"細工師の工房が多いのよね。\p"
				"気難しいオジサンばっかりだから"
				"あたしとしては退屈しちゃうわ。\p"
				"面白いのはジルル爺様くらいかしら。\p"
				"物知りだから、ワクワクする"
				"英雄譚なんかを沢山話してくれるのよ。"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_KAJURA_TALK, 1 )
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//	カジュラ
			TalkPopup("this",0,0,0,0,0)
			{
				"ジルル爺様はこの辺りの最長老なのよ。"
				"とっても物知りなんだから。\p"
				"ちょ～っとスローテンポなのが"
				"玉にキズだけどね。"
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
}

//──────────────────────────────
//	【ジルル老大人】
//──────────────────────────────
function "Talk_Jirul"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	LookChr("this","LEADER")

	if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//───────────────
		//	場所		：王都西街区（過去）・中央付近
		//───────────────
		//	配置・カメラ：ベンチで座る
		//	モーション	：
		//───────────────
		if( !FLAG[TF_JIRUL_TALK] )
		{
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"エタニア王国が興るより前は"
				"暗黒時代と呼ばれておる……\p"
				"その頃地上には先住民がおり、"
				"度々エタニア人を脅かしていたそうじゃ。\p"
				"しかしてエタニア王国が成立し、"
				"文明が発展するにしたがって"
				"彼らは姿を消したという……"
			}
			WaitPrompt()
			WaitCloseWindow()
			
			PlayVoice(Y8V_5779,"this",100)	//ほっほ…
			Wait(10)
			
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"ふぉふぉ、今では古い伝承の中にしか"
				"語り継がれておらぬ話よのう……"
			}
			WaitPrompt()
			WaitCloseWindow()
			
			SetFlag( TF_JIRUL_TALK, 1 )
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"エタニア王国が成立し、"
				"文明が発展するにしたがって"
				"先住民は姿を消したという……\p"
				"ふぉふぉ、今では古い伝承の中にしか"
				"語り継がれておらぬ話よのう……"
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}
	else if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )			//▼過去編Ⅱ南門へ向かう
	{
		//▼過去編Ⅱ南門へ向かう
		//───────────────
		//	場所		：王都西街区（過去）・中央付近
		//───────────────
		//	配置・カメラ：ベンチで座る
		//	モーション	：
		//───────────────

		if( !FLAG[TF_JIRUL_TALK] )
		{
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"かつて世界は１つの国であった……"
				"古代エタニアという名ののう。\p"
				"やがて国が大きくなり、"
				"大きな功績を立てた家臣には"
				"領土と自治権が与えられるようになった。\p"
				"そうしてさまざまな"
				"小国が生まれたのじゃ。"
			}
			WaitPrompt()
			WaitCloseWindow()
			
			PlayVoice(Y8V_5779,"this",100)	//ほっほ…
			Wait(10)
			
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"ふぉふぉ、長い歴史の中で"
				"互いに確執を抱えるようになった国々も"
				"あるようじゃが……\p"
				"彼らもみなエタニアの名の下にある民よ……"
				"もう少し仲良くしてもよいじゃろうて。"
			}
			WaitPrompt()
			WaitCloseWindow()
			
			SetFlag( TF_JIRUL_TALK, 1 )
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"ふぉふぉ、長い歴史の中で"
				"互いに確執を抱えるようになった国々も"
				"あるようじゃが……\p"
				"彼らもみなエタニアの名の下にある民よ……"
				"もう少し仲良くしてもよいじゃろうて。"
			}
			WaitPrompt()
			WaitCloseWindow()
		}

	}
	else if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )			//▼ダーナ編③王都を歩く
	{
		//▼ダーナ編③王都を歩く
		//───────────────
		//	場所		：王都西街区（過去）・中央付近
		//───────────────
		//	配置・カメラ：ベンチで座る
		//	モーション	：
		//───────────────
		if( !FLAG[TF_JIRUL_TALK] )
		{
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"はるか神代の時代、地上に在りしは"
				"ただ《はじまりの大樹》のみじゃった……\p"
				"しかして時代は下り、数多の種が生まれし頃、"
				"我らは大樹に導かれて地上に現れたのじゃ。\p"
				"大樹は我らに"
				"知恵と理力と文明を授けたという……"
			}
			WaitPrompt()
			WaitCloseWindow()
			
			PlayVoice(Y8V_5779,"this",100)	//ほっほ…
			Wait(10)
			
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"ふぉふぉ、今日の繁栄もまた"
				"遡れば大樹の導きによるものよのう……"
			}
			WaitPrompt()
			WaitCloseWindow()
			
			SetFlag( TF_JIRUL_TALK, 1 )
		}
		else
		{
			//　　★繰り返し
			//	ジルル老大人
			TalkPopup("this",0,0,0,0,0)
			{
				"大樹は我らに"
				"知恵と理力と文明を授けたという……\p"
				"ふぉふぉ、今日の繁栄もまた"
				"遡れば大樹の導きによるものよのう……"
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
}


//──────────────────────────────
//	【クライオ】
//──────────────────────────────
function "Talk_Cryo"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )			//▼過去編Ⅱ南門へ向かう
	{
		//▼過去編Ⅱ南門へ向かう
		//───────────────
		//	場所		：王都西街区（過去）・入り口付近
		//───────────────
		//	配置・カメラ：適当な位置で風景を見る
		//	モーション	：
		//───────────────
		//	//西街区以外に移す？
		if( !FLAG[TF_CRYO_TALK] )
		{

//			PlayVoice(Y8V_5746,"this",100)	//どうも

			//	クライオ
			TalkPopup("this",0,0,0,0,0)
			{
				"サライ陛下の時代になって"
				"不思議といい事が続いてるけどよ。\p"
				"別に陛下の手腕ってわけじゃ"
				"ねーんじゃねえか？\p"
				"別にケチをつけるつもりもねえけどよ。"
				"あの人は寺院で修行してたんだろ？\p"
				"ケチ3行目"
				"上手くいってんのも、"
				"大樹の恵みってだけなんじゃねーのか？"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_CRYO_TALK, 1 )
		}
		else
		{
			//　　★繰り返し
			//	クライオ
			TalkPopup("this",0,0,0,0,0)
			{
				"寺院で修行してた"
				"女王なんて聞いた事もねえぜ。\p"
				"なんだかおっとりした人だしよー。\p"
				"いい事が続いてんのも、"
				"大樹の恵みってだけなんじゃねーのか？ "
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//■過去編Ⅳ　モブ

//──────────────────────────────
//	【男性】※過去ギミック④登場キャラ
//──────────────────────────────
function "Talk_mp6203m_citizen2"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//　　★過去ギミック④前
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：僧院前で話し合っている
		//	モーション	：
		//───────────────
		//　　※話しかけると過去ギミック④が起動
		//　　★過去ギミック④後
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：僧院前で話し合っている（前とは少し配置が違う）
		//	モーション	：
		//───────────────
		//	男性
		TalkPopup("this",0,0,0,0,0)
		{
			"これであれこれ相談せずに済みますぞ。"
			"大樹の巫女様、感謝いたします。"
		}
		WaitPrompt()
		WaitCloseWindow()

		ChangeAnimation("this","ANI_EV_REI", -1 , 1 )

		TalkPopup("this",0,0,0,0,0)
		{
			"はは、一層のご活躍を"
			"お祈りさせてくださいませ。"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ResetStopFlag(STOPFLAG_TALK)
}


//──────────────────────────────
//	【男性】※過去ギミック④登場キャラ
//──────────────────────────────
function "Talk_mp6203m_citizen3"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//　　★過去ギミック④前
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：僧院前で話し合っている
		//	モーション	：
		//───────────────
		//　　※話しかけると過去ギミック④が起動
		//　　★過去ギミック④後
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：僧院前で話し合っている（前とは少し配置が違う）
		//	モーション	：
		//───────────────
		//	男性

		ChangeAnimation("this","ANI_EV_REI", -1 , 1 )

		TalkPopup("this",0,0,0,0,0)
		{
			"お忙しいでしょうに、"
			"お世話になりましたな。\p"
			"後日改めて参拝に参ります。"
			"どうか礼を述べさせてくださいませ。"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ResetStopFlag(STOPFLAG_TALK)
}


//──────────────────────────────
//	【青年】※過去ギミック④登場キャラ
//──────────────────────────────
function "Talk_mp6203m_citizen4"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//　　★過去ギミック④前
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：僧院前で話し合っている
		//	モーション	：
		//───────────────
		//　　※話しかけると過去ギミック④が起動
		//　　★過去ギミック④後
		//───────────────
		//	場所		：王都西街区（過去）・僧院前
		//───────────────
		//	配置・カメラ：僧院前で話し合っている（前とは少し配置が違う）
		//	モーション	：
		//───────────────
		//	青年
		TalkPopup("this",0,0,0,0,0)
		{
			"いてて、説教されちまいました。\p"
			"でもこんな巫女様だから"
			"身近に感じられるっていうか……"
		}
		WaitPrompt()
		WaitCloseWindow()

		ChangeAnimation("this","ANI_EV_REI", -1 , 1 )

		TalkPopup("this",0,0,0,0,0)
		{
			"ともかく、今日は"
			"ありがとうございました！"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ResetStopFlag(STOPFLAG_TALK)
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//■過去編Ⅱ　モブ

//──────────────────────────────
//	青年	【過去ギミック②：鍵の話を聞く】
//──────────────────────────────
function "Talk_mp6203m_citizen1"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	 if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )	//▼過去編Ⅱ南門へ向かう
	{
		if( !FLAG[GF_SUBEV_PAST_02_GIMMICK_A] )	// 過去編Ⅱ：【過去ギミック②：鍵の話を聞く】のイベントを見た
		{
			//──────────────────────────────
			//	【過去ギミック②：鍵の話を聞く】
			//──────────────────────────────
			//　　mp6203m	-514.62f	838.37f	1.25f	-40.69f付近に水面を見ている青年が居る。
			//　　以下は一般メッセージ処理。
		
			//　　振り返らない
		
			TalkPopup("mp6203m_citizen1",0,0,0,0,0)
			{
				"#000e#000mや、やばい……"
				"鍵を落っことしちまったよ。\p"
				"どうしよう……"
				"謝ったら許してもらえっかなぁ……"
			}
			WaitPrompt()
			WaitCloseWindow()
		
			//選択肢
			SetFlag(TF_MENU_SELECT,0)
			MenuReset()
			MenuType(MENUTYPE_POPUP)
			MenuAdd(1,"詳しく聞く")
			MenuAdd(2,"やめておく")
			MenuOpen( TF_MENU_SELECT , -1 , ADOLMENU_PPOSY , -2 , -2 , 10 , 0)
			WaitMenu(0)
			MenuClose(10,0)
//			Wait(20)
			
			//────────────────────
			//	⇒詳しく聞く
			if (FLAG[TF_MENU_SELECT] == 1)
			{
				//	  　下の流れに接続
				FadeOut(FADE_BLACK,FADE_NORMAL)
				WaitFade()
				
				SetFlag( TF_LOADING_TIPS_OFF, 1 )	//NowLoading 時の Tips 表示をカット
				EventCue("mp6203m:SubEV_Past_02_Gimmick")		// 過去編Ⅱ：【過去ギミック②：鍵の話を聞く】
				ResetStopFlag(STOPFLAG_TALK)
			}
			//	⇒やめておく
			else if (FLAG[TF_MENU_SELECT] == 2)
			{
				//	  　操作許可を戻す
			}
			//────────────────────
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
}





////////////////////////////////////////////////////////////////////////////////

//■メインイベントセクション

////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////

//■サブイベントセクション

////////////////////////////////////////////////////////////////////////////////
//──────────────────────────────
//	【過去ギミック②：鍵の話を聞く】
//──────────────────────────────
function "SubEV_Past_02_Gimmick"
{

	//　　ここからイベント形式に移行。

//開始処理ここから----------------------------------------------------

	CallFunc("system:event_begin")

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("DANA",-513.57f,839.72f,1.25f)
	Turn("DANA",12.29f,360.0f)
	ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookChr( "DANA", "mp6203m_citizen1" )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)

	SetChrWork("mp6203m_citizen1", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("mp6203m_citizen1",-513.98f,837.68f,1.25f)
	Turn("mp6203m_citizen1",-53.08f,360.0f)
//	ChangeAnimation( "mp6203m_citizen1" , "ANI_WAIT", -1 , 1 )
//	ChangeSubAnimation("mp6203m_citizen1",SUBMOT_EYE,ANI_E_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen1",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen1",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("mp6203m_citizen1")
	SetChrInfoFlag( "mp6203m_citizen1" , INFOFLAG_NOCHRATARI)

	//BGM設定◆
	//PlayBGM( BGM_FIELD_101 , XX )

	//カメラ設定
//	MoveCameraAt( 0 , -513.434f , 836.355f , 3.023f , 0 )	// 注視点
//	ChangeCameraDistance( 0 , 2.760f , 0 )		// 基本距離
//	ChangeCameraElevation( 0 , 24.840f , 0 )	// 基本仰角
//	RotateCamera( 0 , 297.088f , 0 )				// 角度
//	ChangeCameraPers( 0 , 46.000f , 0 )			// 視野角
//	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
//	RollCamera( 0 , 0.0f , 0 )				// ロール回転
//	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	MoveCameraAt( 0 , -514.256f , 837.972f , 3.023f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.760f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 24.840f , 0 )	// 基本仰角
	RotateCamera( 0 , 297.088f , 0 )				// 角度
	ChangeCameraPers( 0 , 46.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。
	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 3.000, 150.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6203m:SubEV_Past_02_Gimmick_ED")

//開始処理ここまで-----------------------------------------------

	Wait(10)

//	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE ,-514.256f , 837.972f , 3.023f, 100 )		// 注視点
//	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.760f , 130 )		// 基本距離
//	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , 23.943f , 130 )		// 基本仰角
//	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE , 23.453f,  130 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE , -3.6f, 130 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,39.000f, 130 )		// 視野角

	//MoveCameraAt( 0 , -514.256f , 837.972f , 3.023f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.760f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 24.840f , 0 )	// 基本仰角
	//RotateCamera( 0 , 297.088f , 0 )				// 角度
	//ChangeCameraPers( 0 , 46.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

//	Wait(100)

	ChangeAnimation( "DANA" , "ANI_EV_TEBURI", -1 , 1 )

	//　　ここからイベント形式に移行。
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#000e#000mあの、どうかなさいましたか？"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　青年にＰＡエモーション
	//　　振り向く
	//	青年
	EmotionEx("mp6203m_citizen1", 0.01f,EMO_PA,0,5,1,1,1.2f )
	Wait(35)
	
	LookChr("mp6203m_citizen1","DANA")

	TalkPopup(mp6203m_citizen1,0,1,0,-140,1)
	{
		"#000mいや……ちょっと急いでいたら"
		"そこの段差でこけちまってさ。\p"
		"#000mその拍子に預かりものの鍵を"
		"落としちまったんだよ。\p"
		"#000mそれがその、いつも商品を"
		"届けさせてもらってる……\p"
		"#000m衛士隊の倉庫の鍵なんだけどさ。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_S", -1 , 1 )

	//	"DANA"
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#050e#000mそ、それは大変ですね。\p"
		"探すのを手伝いましょうか？"
	}
	WaitPrompt()
	WaitCloseWindow()

	LookReset(mp6203m_citizen1)
	Wait(15)
	HeadNo("mp6203m_citizen1", 1, 35 )

	//	青年
	TalkPopup(mp6203m_citizen1,0,1,0,-140,1)
	{
		"#011e#000mい、いやぁ、無理だよ。"
		"どの辺りに落ちたか判らないしさ。\p"
		"#012e#000m結構ずっしりした鍵だから、"
		"きっと水底の泥に沈んじまったよ……"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	CrossFade(FADE_CROSS)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)

	MoveCameraAt( 0 , -514.461f , 840.951f , 2.180f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.260f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 17.865f , 0 )	// 基本仰角
	RotateCamera( 0 , 23.082f , 0 )				// 角度
	ChangeCameraPers( 0 , 46.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イZZベント終了時に呼び出して下さい。マップ側の設定に戻します。

	Wait(FADE_CROSS)

	LookSpd("DANA",0.08f,0.08f,0.08f)
	Look("DANA" , 0 , -7)

	//	"DANA"
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#011e#000mそうですか。"
		"……でもそのくらいなら……"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	青年
	TalkPopup(mp6203m_citizen1,0,3,100,210,0)
	{
		"えっ……？"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)
	LookReset(DANA)
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_E,1)
	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_E", -1 , 1 )
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_TEMUNE_E",  0)

	Turn("DANA",-52.00f,8.0f)

	//　　ダーナ、少し歩いて水面の方に向く。
	//　　モーションを取って、理力を纏うような演出。

	FadeOut(FADE_BLACK,FADE_FAST)
	WaitFade()

	PlaySE(SE_KAKO_2_01, 80, 0, 200, 500, 0.3f, 200)

	//◆ごそごそSE

	Wait(30)

	PlaySE(SE_KAKO_2_02, 100, 0, 0, 0, 1.0f, 0)
	PlaySE(SE_KAKO_2_03, 20, 0, 0, 0, 1.0f, 0)
	
	TalkPopup(DANA,0,3,100,60,0)
	{
		"……よいしょっ、と。"
	}
	WaitPrompt()
	WaitCloseWindow()	

	Wait(15)

	SetChrInfoFlag(DANA,INFOFLAG_NOATARI)
	SetChrPos("DANA",-511.40f,837.64f,1.62f)
	Turn("DANA",-58.94f,360.0f)
	Look("DANA", 0 , -10)

	//ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE,1)

	SetChrPos("mp6203m_citizen1",-514.18f,837.40f,1.25f)
	Turn("mp6203m_citizen1",-81.78f,360.0f)

	MoveCameraAt( 0 , -510.653f , 836.510f , 0.717f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.260f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 26.792f , 0 )	// 基本仰角
	RotateCamera( 0 , 149.287f , 0 )				// 角度
	ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転


	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE , -511.406f , 837.156f , 2.949f , 120 )		// 注視点
	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 3.260f , 120 )		// 基本距離
	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , 15.182f  , 120 )		// 基本仰角
	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE , 125.785f ,  120 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE , -3.6f, 120 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,39.000f, 120 )		// 視野角

	//MoveCameraAt( 0 , -511.406f , 837.156f , 2.949f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.260f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 15.182f , 0 )	// 基本仰角
	//RotateCamera( 0 , 125.785f , 0 )				// 角度
	//ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	Wait(80)
	
	EmotionEx("mp6203m_citizen1", 0.00f,EMO_ASE,0,5,2,0,1.15f )
	HeadNo("mp6203m_citizen1" , 1, 35 )
	ChangeSubAnimation("mp6203m_citizen1",SUBMOT_EYE,ANI_E_CLOSE_S,1)

	Wait(10)

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000m重たい鍵……水底の泥……\p"
		"#011e#000mきっとまだ水が濁っているはず……"
		"水中に“目”を作れば……"
	}
	WaitPrompt()
	WaitCloseWindow()

	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	WaitThread(1004)
	WaitThread(1005)

	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE , -511.224f , 837.472f , 3.048f , 170 )		// 注視点
	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 1.560f , 170 )		// 基本距離
	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , 23.549f , 170 )		// 基本仰角
	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE , 26.107f,  170 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE , -3.6f, 170 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,39.000f, 170 )		// 視野角

	//MoveCameraAt( 0 , -511.224f , 837.472f , 3.048f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.560f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 23.549f , 0 )	// 基本仰角
	//RotateCamera( 0 , 26.107f , 0 )				// 角度
	//ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	ChangeAnimation( "DANA" , "ANI_EV_KAZASU_S", -1 , 1 )
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_KAZASU_S",  0)

	ChrEffect2( "DANA" , 3900600 , "Bone_root", "", 0 , 0 , 0 , 0.0f,0.0f,0, 1.0f, 1.0f)	//オーラ（ループ）
	PlaySE(SE_KAKO_2_04, 80, 0, 0, 0, 1.0f, 0)

	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	WaitThread(1004)
	WaitThread(1005)

	CrossFade(FADE_NORMAL)
	MoveCameraAt( 0 , -512.375f , 836.555f , 3.271f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.760f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 41.679f , 0 )	// 基本仰角
	RotateCamera( 0 , 262.009f , 0 )				// 角度
	ChangeCameraPers( 0 , 58.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

//	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE , -511.224f , 837.472f , 3.048f , 160 )		// 注視点
//	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 1.560f , 160 )		// 基本距離
//	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , 23.549f , 160 )		// 基本仰角
	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE , 307.500f,  160 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE , -3.6f, 160 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,39.000f, 160 )		// 視野角

	//MoveCameraAt( 0 , -512.375f , 836.555f , 3.271f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.760f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 41.677f , 0 )	// 基本仰角
	//RotateCamera( 0 , 307.500f , 0 )				// 角度
	//ChangeCameraPers( 0 , 58.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	Wait(100)

	Effect( 108000,  -491.350f , 836.490f , -16.503f , 0 , 0 , IMPACT_NONE , KNOCK_EFXPOS , 0 , 3.5f, 1.0f)		//キラリ
	PlaySE(SE_KAKO_2_05, 70, 0, 0, 0, 1.0f, 0)

	//　　カメラで水面を映すと、
	//　　適当な位置に小さくキラリと光るエフェクトがある。


	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	WaitThread(1004)
	WaitThread(1005)

	CrossFade(FADE_CROSS)
	MoveCameraAt( 0 , -511.224f , 837.472f , 2.998f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.280f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -22.557f , 0 )	// 基本仰角
	RotateCamera( 0 , 26.107f , 0 )				// 角度
	ChangeCameraPers( 0 , 34.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	Wait(FADE_CROSS)


	TalkPopup("DANA",0,1,0,0,0)
	{
		"#012e#000m見つけた……！"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	//　　暗転を挟んで、ばしゃっという水音がする。
	//　　理力を纏うダーナの前に、キラキラエフェクトが
	//　　上からゆっくりと降りてくる。
	//　　（ダーナが念力で動かしている）
	//　　ダーナの前の高さに来た所でキラキラを消す。

	//◆バシャっという水音
	FadeOut(FADE_BLACK,5)
	WaitFade()

	SetChrPos("Drop01",-511.053f , 837.223f , 3.421f)
	LookChr("DANA" , "Drop01" )
	ChangeAnimation( "DANA" , "ANI_EV_TEWATASI", -1 , 1 )

	ChangeSubAnimation("mp6203m_citizen1",SUBMOT_EYE,ANI_E_WAIT,1)

	PlaySE(SE_KAKO_2_06, 100, 0, 0, 0, 1.0f, 0)
	Wait(30)

	MoveCameraAt( 0 , -511.053f , 837.223f , 3.421f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.159f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -23.094f , 0 )	// 基本仰角
	RotateCamera( 0 , 80.934f , 0 )				// 角度
	ChangeCameraPers( 0 , 39.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE , -511.053f , 837.223f , 2.850f , 150 )		// 注視点
	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 1.769f , 150 )		// 基本距離
	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , -1.490f , 150 )		// 基本仰角
	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE , 80.944f,  150 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE , -3.6f, 150 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,39.000f, 150 )		// 視野角

	//MoveCameraAt( 0 , -511.053f , 837.223f , 2.850f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.769f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -1.490f , 0 )	// 基本仰角
	//RotateCamera( 0 , 80.944f , 0 )				// 角度
	//ChangeCameraPers( 0 , 39.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	ExecuteCmd(11, MoveZ , "Drop01" , 2.850f , 0 , INTERPOLATE_SPHERE  , 120 )

	FadeIn(FADE_BLACK,FADE_NORMAL)

	Wait(15)
	ExecuteFunc(100,"mp6203m:SubEV_kirakira")

	WaitFade()

	Wait(90)

	PlaySE(SE_TUTORIAL, 100, 0, 0, 0, 1.0f, 0)	//チュートリアル

	//	テキスト
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S"
		"#-1W#4C衛士隊の倉庫の鍵を手に入れた。#10W" 
		"#8S"
	}
	Wait(10)
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)
	
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	StopThread(100)
	SetChrPos("Drop01", -100000.0f ,0 ,0 )
	StopEffect(-1,ALL,1)

	SetChrPos("mp6203m_citizen1",-514.45f,839.23f,1.25f)
	Turn("mp6203m_citizen1",-140.50f,360.0f)
	SetChrPos("DANA",-513.42f,840.39f,1.62f)
	Turn("DANA",31.54f,360.0f)
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SMILE,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_SMILE,1)

	LookChr("DANA" , "mp6203m_citizen1")
	LookChr("mp6203m_citizen1" , "DANA")	

	Wait(30)

	MoveCameraAt( 0 , -514.029f , 839.642f , 3.172f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.060f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 9.663f , 0 )	// 基本仰角
	RotateCamera( 0 , 357.154f , 0 )				// 角度
	ChangeCameraPers( 0 , 30.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	//ChangeAnimation( "DANA" , "ANI_EV_TEWATASI_S", -1 , 1 )
	ChangeAnimation( "DANA" , "ANI_EV_TEWATASI", -1 , 1 )

	FadeIn(FADE_BLACK,FADE_FAST)
	WaitFade()
	
	Wait(10)

	//　　ダーナ、青年に向き直る。
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#080mはい、これで間違いはありませんか？"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_TEWATASI_E", -1 , 1 )

	HeadYes("mp6203m_citizen1" ,1 , 25 )

	//	青年
	TalkPopup(mp6203m_citizen1,0,1,0,0,0)
	{
		"#000mあ、ああ……確かに"
		"オレが落とした鍵だよ……"
	}
	WaitPrompt()
	WaitCloseWindow()

	HeadNo("mp6203m_citizen1" ,1 ,30 )
	TalkPopup(mp6203m_citizen1,0,1,0,0,0)
	{
		"#000mで、でも凄いな君！"
		"信じられないや！"
	}
	WaitPrompt()
	WaitCloseWindow()
	
	ChangeAnimation( "mp6203m_citizen1" , "ANI_EV_TEBURI", -1 , 1 )
	
	TalkPopup(mp6203m_citizen1,0,1,0,0,0)
	{
		"#000m理法具も使わないで、"
		"自分の理力だけでこんなに手早く……\p"
		"#000mえっと、君は一体……"
	}
	WaitPrompt()
	WaitCloseWindow()

	LookReset("DANA")
	ChangeAnimation( "DANA" , "ANI_EV_SEKI", -1 , 1 )

	//	"DANA"
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#091e#080mクスクス……"
		"ただの通りすがりの者です。"
	}
	WaitPrompt()
	WaitCloseWindow()
	
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_SEKI",  0)
	LookChr("DANA","mp6203m_citizen1")
	ChangeAnimation( "DANA" , "ANI_EV_TEBURI", -1 , 1 )

	TalkPopup("DANA",0,2,0,0,0)
	{
		"#092e#080mそれはそうと、一度落とした事は"
		"きちんと伝えた方がいいと思いますよ。\p"
		"これは複雑な理力鍵です。"
		"本来水没させていい物ではありません。"
	}
	WaitPrompt()
	WaitCloseWindow()

	HeadYes("mp6203m_citizen1",1 ,25 )
	//	青年
	TalkPopup(mp6203m_citizen1,0,1,0,0,0)
	{
		"そ、そうだよな。"
		"すぐに返しに行くことにするよ。\p"
		"でも衛士隊の人、"
		"許してくれるかなぁ……\p"
		"通りすがりの人が拾ってくれたなんて"
		"ちょっと疑われちまうかも……"
	}
	WaitPrompt()
	WaitCloseWindow()

	LookReset("DANA")
	ChangeAnimation( "DANA" , "ANI_EV_SIAN_S", -1 , 1 )

	//	"DANA"
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#091e#080mそうですね……では私から"
		"一筆したためましょう。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_SIAN_E", -1 , 1 )
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_SIAN_E",  0)

	FadeOut(FADE_BLACK_HALF,FADE_FAST)
	WaitFade()

	//	ナレーション
	TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
	{
		"#7Cダーナは懐紙を取り出し、"
		"#7C事情を説明する証文を記した。"
	}
	WaitPrompt()
	WaitCloseWindow()

	FadeIn(FADE_BLACK_HALF,FADE_FAST)
	WaitFade()

	LookChr("DANA" , "mp6203m_citizen1")
	ChangeAnimation( "DANA" , "ANI_EV_TEWATASI_S", -1 , 1 )

	//	"DANA"
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#092e#080mこれを持っていけば"
		"きっと信じてもらえるでしょう。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　物を受け取るモーションの後、
	//　　青年にＰＡエモーション

	EmotionEx("mp6203m_citizen1", 0.00f,EMO_PA,0,5,1,1,1.0f )
	Look("mp6203m_citizen1" , 0 , -20)
	Wait(35)

	ChangeAnimation( "DANA" , "ANI_EV_TEWATASI_E", -1 , 1 )

	//	青年
	TalkPopup(mp6203m_citizen1,0,1,0,0,0)
	{
		"こ、この紙にある透かしって……"
		"まさか大樹の寺院の……！？"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　青年は慌ててダーナを見る。
	//	青年

	EmotionEx("mp6203m_citizen1", 0.00f,EMO_ASE,0,7,2,1,1.0f )
	LookChr("mp6203m_citizen1" , "DANA")

	Wait(45)

	HeadNo(mp6203m_citizen1, 1, 35 )
	TalkPopup(mp6203m_citizen1,0,1,0,0,0)
	{
		"あ、あはははは……そのう……"
		""
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "mp6203m_citizen1" , "ANI_EV_REI", -1 , 1 )

	TalkPopup(mp6203m_citizen1,0,1,0,0,0)
	{
		"大樹の巫女様、本当に"
		"ありがとうございました！ "
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　深々と礼をする青年。

	ChangeAnimation( "DANA" , "ANI_EV_RYOTEMAE_S", -1 , 1 )

	TalkPopup("DANA",0,2,0,0,0)
	{
		"#020e#080mふふ、無事に"
		"許してもらえるといいですね。\p"
		"#092e#080m貴方に大樹の加護があらん事を。"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	SetEnvSEPlayState(-1, 0)	//環境SE全停止

	//　　画面暗転。
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	//	ナレーション
	TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
	{
		"#7Cその後、青年は何度も非礼を詫びつつ"
		"#7C衛士隊の詰所へと去っていったのだった。"
	}
	WaitPrompt()
	WaitCloseWindow()

	PlaySE(SE_QUEST_END, 100, 0, 0, 0, 1.0f, 0)		// クエスト達成	

	//	システムテキスト
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S "
		"#-1W#4Cエタニアクエスト#8C【水底に消えた鍵】#4Cを達成した！#10W" 
		"#8S"
	}
	Wait(10)
	CallFunc("system:QuestVoice_Success")
	WaitPrompt()
	WaitCloseWindow()

	PlaySE(SE_VIRTUE, 100, 0, 0, 0, 1.0f, 0)	//徳ポイントアップ

	//	システムテキスト
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S "
		"#-1W#4Cダーナの徳が上昇した。#10W" 
		"#8S"
	}
	Wait(10)
	WaitPrompt()
	WaitCloseWindow()

	//	システムテキスト
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S "
		"#-1W#4C東街区にある衛士隊の倉庫に入れるようになった！#10W"
		"倉庫2行目"
		"#8S"
	}
	Wait(10)
	WaitPrompt()
	WaitCloseWindow()

	//　　イベント終了、操作許可。

//終了処理ここから----------------------------------------------------
	CallFunc("mp6203m:SubEV_Past_02_Gimmick_ED")
}
function "SubEV_Past_02_Gimmick_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
//	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_ALL")

	SetChrPos("mp6203m_citizen1",-100000.0f ,0 , 0 )

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	//フラグ立て
	SetFlag( GF_SUBEV_PAST_02_GIMMICK_A, 1 )	// 過去編Ⅱ：【過去ギミック②：鍵の話を聞く】のイベントを見た
	SetFlag(GF_VIRTURE_POINT,(FLAG[GF_VIRTURE_POINT] + 5 ))			//徳ポイント加算
	EventCue("system:EV_FloorOpen")			//扉が開く予知を視る キューを入れる

	CallFunc("mp6203m:init")
	CallFunc("mp6203m:NPC_Move_t01_Pos")		//★パッチ1.01対応：ルートムーブNPCの座標強制指定

	//マーカーセット
	//DelMapMarker( SMI_DANA_QUEST, PAGE_MF002, MARKER_SUBEV_PAST_2_Q1, 0, 0)		// 過去編Ⅱ：水底に消えた鍵
	CallFunc("system:SetMarkerDANA")
	SetMapMarker( SMI_SUBEVENT, PAGE_F032, MARKER_SUBEV_PAST02_2, -229.58f, 1009.97f, 4.30f , -229.58f, 1009.97f, MARKER_SUBEV_PAST02_2, MN_F_MP6213,0)	// 開いている倉庫

	//イベント後の再配置
	SetChrPos("LEADER",-513.57f,841.34f,1.25f)
	Turn("LEADER",174.18f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	//カメラ位置復帰
	MoveCameraAt( 0 , -513.567f , 841.338f , 3.132f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 7.000f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 18.418f , 0 )	// 基本仰角
	RotateCamera( 0 , -24.503f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	//RestoreCamera(0, 0)		//※上記カメラ位置を指定する場合は不要
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	SetEnvSEPlayState(-1, 1)	//環境SE

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()

//終了処理ここまで----------------------------------------------------
}

function "SubEV_kirakira"
{
	while(1) {
		ChrEffect(Drop01, 108000, 0.0f, 0.0f, 0.0f, 0, 0, IMPACT_NONE , KNOCK_EFXPOS, 1.0f, 0.0f, 0, 0.8f, 1.0f)	// キラリ
		Wait(45)
		ChrEffect(Drop01, 108000, 0.0f, 0.0f, 0.0f, 45, 0, IMPACT_NONE , KNOCK_EFXPOS, 1.0f, 0.0f, 0, 0.8f, 1.0f)	// キラリ
		Wait(45)
		ChrEffect(Drop01, 108000, 0.0f, 0.0f, 0.0f, 90, 0, IMPACT_NONE , KNOCK_EFXPOS, 1.0f, 0.0f, 0, 0.8f, 1.0f)	// キラリ
		Wait(45)

	}
}

//──────────────────────────────
//	【過去ギミック④：大僧院の扉を直す】
//──────────────────────────────
function "SubEV_Past_04_Gimmick"
{
	//　　大僧院の前に行くと３人ほど人が集まっている。

	//　　近づくとダーナとオルガを再配置してイベント起動。

//開始処理ここから----------------------------------------------------

	CallFunc("system:event_begin")

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("DANA",-530.77f, 833.74f, 5.64f)
	Turn("DANA",6.51f,360.0f)
	ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset( "DANA" )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)

//	SetChrWork("Olga", CWK_DEFAULT_SKIPNODE_OFF, 1)
//	SetChrPos("Olga",-531.98f, 833.49f, 5.64f)
//	Turn("Olga",5.96f,360.0f)
//	ChangeAnimation( "Olga" , "ANI_WAIT", -1 , 1 )
//	ChangeSubAnimation("Olga",SUBMOT_EYE,ANI_E_WAIT,1)
//	ChangeSubAnimation("Olga",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("Olga",SUBMOT_EXT1,ANI_E_LOOKC,1)
//	LookReset( "Olga" )
//	SetChrInfoFlag( "Olga" , INFOFLAG_NOCHRATARI)

	SetChrWork("mp6203m_citizen2", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("mp6203m_citizen2",-531.09f,830.37f,5.64f)
	Turn("mp6203m_citizen2",94.38f,360.0f)
//	ChangeAnimation( "mp6203m_citizen2" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("mp6203m_citizen2",SUBMOT_EYE,ANI_E_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen2",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen2",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("mp6203m_citizen2")
	SetChrInfoFlag( "mp6203m_citizen2" , INFOFLAG_NOCHRATARI)

	SetChrWork("mp6203m_citizen3", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("mp6203m_citizen3",-532.57f,830.06f,5.64f)
	Turn("mp6203m_citizen3",-98.79f,360.0f)
//	ChangeAnimation( "mp6203m_citizen3" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("mp6203m_citizen3",SUBMOT_EYE,ANI_E_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen3",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen3",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("mp6203m_citizen3")
	SetChrInfoFlag( "mp6203m_citizen3" , INFOFLAG_NOCHRATARI)

	SetChrWork("mp6203m_citizen4", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("mp6203m_citizen4",-532.33f,831.23f,5.64f)
	Turn("mp6203m_citizen4",-57.89f,360.0f)
//	ChangeAnimation( "mp6203m_citizen4" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("mp6203m_citizen4",SUBMOT_EYE,ANI_E_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen4",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("mp6203m_citizen4",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("mp6203m_citizen4")
	SetChrInfoFlag( "mp6203m_citizen4" , INFOFLAG_NOCHRATARI)

	if( FLAG[GF_SUBEV_PAST_04_GIMMICK_L] == 1 )	// 過去編Ⅳ：【過去ギミック④：大僧院の扉を直す】を見た（1:見て立ち去った、2:直すように口添えした）
	{
		Turn("mp6203m_citizen2",168.99f,360.0f)
		Turn("mp6203m_citizen3",-159.19f,360.0f)
		Turn("mp6203m_citizen4",-164.48f,360.0f)
		LookChr("mp6203m_citizen2", "DANA")
		LookChr("mp6203m_citizen3", "DANA")
		LookChr("mp6203m_citizen4", "DANA")
	}

	//BGM設定◆
	//PlayBGM( BGM_FIELD_101 , XX )

	//カメラ設定
	MoveCameraAt( 0 , -532.046f , 831.727f , 7.466f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 4.670f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -4.829f , 0 )	// 基本仰角
	RotateCamera( 0 , 134.279f , 0 )				// 角度
	ChangeCameraPers( 0 , 43.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 1.000, 80.000 ,1.000 ,0.700 ,0.600)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	SetFlag(TF_MENU_SELECT,0)

	//スキップ許可
	SetSkipScript("mp6203m:SubEV_Past_04_Gimmick_ED")

//開始処理ここまで-----------------------------------------------

	FadeIn(FADE_BLACK,FADE_FAST)
	WaitFade()

	//初回
	if( FLAG[GF_SUBEV_PAST_04_GIMMICK_L] == 0 )	// 過去編Ⅳ：【過去ギミック④：大僧院の扉を直す】を見た（1:見て立ち去った、2:直すように口添えした）
	{
		
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000m#0L（あれ？　人が集まってるけど……）"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		ChangeAnimation( "DANA", "ANI_EV_TEBURI", -1, 1 )	// 手振り
		
		TalkPopup("DANA",0,1,0,0,0)
		{
			"もし、どうかなさいましたか？"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		LookChr("mp6203m_citizen2", "DANA")
		ExecuteCmd( 1000, Turn, "mp6203m_citizen2", 168.99f, 5.0f )
		Wait(2)
		LookChr("mp6203m_citizen3", "DANA")
		ExecuteCmd( 1001, Turn, "mp6203m_citizen3", -159.19f, 8.0f )
		Wait(2)
		LookChr("mp6203m_citizen4", "DANA")
		ExecuteCmd( 1002, Turn, "mp6203m_citizen4", -164.48f, 7.0f )
		WaitThread(1000)
		WaitThread(1001)
		WaitThread(1002)
		
		//	男性
		TalkPopup("mp6203m_citizen2",0,2,0,0,0)
		{
			"#000e#000mおお、大樹の巫女様……！"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		ChangeAnimation( "mp6203m_citizen4", "ANI_EV_TEBURI", -1, 1 )	// 手振り
		
		//	青年
		TalkPopup("mp6203m_citizen4",0,2,0,0,0)
		{
			"#000e#000mいやはや、巫女様の手を"
			"煩わせるようなことでは……！"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		//　　ダーナ、静かに首を振る
		HeadNo("DANA" , 1 , 35 )
		
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#011e#000m皆さんの１つ１つの幸せこそが"
			"エタニアの繁栄の証なのです。\p"
			"#120e#000mどのような些事でも構いません。"
			"どうか教えてください。"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		
		//　　汗汗エモーションを出しつつ礼をする人々。
		EmotionEx("mp6203m_citizen2", 0.00f, EMO_ASE, 0, 5, 1, 1, 1.0f)	//汗汗
		ChangeAnimation( "mp6203m_citizen2" , "ANI_EV_REI", -1 , 1 )
		Wait(5)
		EmotionEx("mp6203m_citizen3", 0.00f, EMO_ASE, 0, 5, 1, 1, 1.0f)	//汗汗
		ChangeAnimation( "mp6203m_citizen3" , "ANI_EV_REI", -1 , 1 )
		Wait(7)
		EmotionEx("mp6203m_citizen4", 0.00f, EMO_ASE, 0, 5, 1, 1, 1.0f)	//汗汗
		ChangeAnimation( "mp6203m_citizen4" , "ANI_EV_REI", -1 , 1 )
		Wait(50)
		WaitAnimation2( "mp6203m_citizen2" , -1, 1, "ANI_EV_REI",  0)
		WaitAnimation2( "mp6203m_citizen3" , -1, 1, "ANI_EV_REI",  0)
		WaitAnimation2( "mp6203m_citizen4" , -1, 1, "ANI_EV_REI",  0)
		
		//	男性
		TalkPopup("mp6203m_citizen2",0,2,0,0,0)
		{
			"#011e#000m巫女様……恐縮でございます。"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		ChangeAnimation("mp6203m_citizen2","ANI_EV_TEBURI", -1 , 1 )
		
		//	男性
		TalkPopup("mp6203m_citizen2",0,0,0,0,0)
		{
			"#012e実はその、大僧院の設備に"
			"問題が見つかりまして……"
		}
		WaitPrompt()
		WaitCloseWindow()

		CrossFade(FADE_CROSS)


		MoveCameraAt( 0 , -530.449f , 834.968f , 21.153f , 0 )	// 注視点
		ChangeCameraDistance( 0 , 8.360f , 0 )		// 基本距離
		ChangeCameraElevation( 0 , -2.764f , 0 )	// 基本仰角
		RotateCamera( 0 , 165.380f , 0 )				// 角度
		ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
		SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
		RollCamera( 0 , 0.0f , 0 )				// ロール回転
		// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

		ExecuteCmd( 1000, MoveCameraAt, INTERPOLATE_SPHERE , -530.449f , 834.968f , 9.991f , 700 )	// 注視点

		Wait(FADE_CROSS)

		TalkPopup("mp6203m_citizen2",0,3,120,240,0)
		{
			"ご存知の通り、ボラド大僧院は"
			"王都民の冠婚葬祭を執り行う施設です。\p"
			"私どもは、子が生まれた時も"
			"親を天へと見送る時も、この正門を潜る……\p"
			"私ども3行目"
			"そういうわけで、この正門の扉は"
			"昔から『祝福の大扉』と呼ばれております。"
		}
		WaitPrompt()
		WaitCloseWindow()

		Wait(30)

		CrossFade(FADE_FAST)
		StopThread(1000)

		MoveCameraAt( 0 , -532.046f , 831.727f , 7.466f , 0 )	// 注視点
		ChangeCameraDistance( 0 , 4.670f , 0 )		// 基本距離
		ChangeCameraElevation( 0 , -4.829f , 0 )	// 基本仰角
		RotateCamera( 0 , 134.279f , 0 )				// 角度
		ChangeCameraPers( 0 , 43.000f , 0 )			// 視野角
		SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
		RollCamera( 0 , 0.0f , 0 )				// ロール回転
		// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

		Wait(FADE_FAST)

		//	男性
		TalkPopup("mp6203m_citizen3",0,0,0,0,0)
		{
			"ですが、さすがに古いらしく。\p"
			"今朝方、開閉用の理力装置が"
			"壊れているのが見つかりましてな。"
		}
		WaitPrompt()
		WaitCloseWindow()

		ChangeAnimation( "mp6203m_citizen4", "ANI_EV_TEBURI", -1, 1 )	// 手振り

		//	青年
		TalkPopup("mp6203m_citizen4",0,0,0,0,0)
		{
			"どうやら数百年も前に造られた"
			"特注品らしく……\p"
			"まずは直し方から"
			"調べなくちゃって事になりまして……"
		}
		WaitPrompt()
		WaitCloseWindow()


		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000m……それは困りましたね。"
		}
		WaitPrompt()
		WaitCloseWindow()

		//TalkPopup("Olga",0,2,0,0,0)
		//{
		//	"#000e#000m……なるほどな。"
		//}
		//WaitPrompt()
		//WaitCloseWindow()

		//フラグ立て
		SetFlag( GF_SUBEV_PAST_04_GIMMICK_L, 1 )	// 過去編Ⅳ：【過去ギミック④：大僧院の扉を直す】を見た（1:見て立ち去った、2:直すように口添えした）
		
	}
	//　　※一度断って話しかけると
	else
	{
		
		//	男性
		TalkPopup("mp6203m_citizen2",0,2,0,0,0)
		{
			"#000e#000m今朝方、開閉用の理力装置が"
			"壊れているのが見つかりましてな。\p"
			"どうしたものかと"
			"話していた所でして……"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	//　　※ここで統合


//	LookChr("Olga", "DANA")
//	Turn("Olga", -50.89f, 6.0f)
//
//	TalkPopup("Olga",0,2,0,0,0)
//	{
//		"#000e#000m（先を急ぎたい所ではあるが……）\p"
//		"（どうする、ダーナ。）"
//	}
//	WaitPrompt()
//	WaitCloseWindow()
//
//	LookChr("DANA", "Olga")
//	Turn("DANA", 56.25f, 5.0f)
//
//	TalkPopup("DANA",0,1,0,0,0)
//	{
//		"#000e#000m（うん、そうだね……）"
//	}
//	WaitPrompt()
//	WaitCloseWindow()
	
	Wait(5)

	//選択肢
	SetFlag(TF_MENU_SELECT,0)
	MenuReset()
	MenuType(MENUTYPE_POPUP)
	MenuAdd(1,"直すように口添えする")
	MenuAdd(2,"このまま立ち去る")
	MenuOpen( TF_MENU_SELECT , -1 , ADOLMENU_PPOSY , -2 , -2 , 10 , 0)
	WaitMenu(0)
	MenuClose(10,0)
	//Wait(20)
	
	//────────────────────
	//	⇒直すように口添えする
	if (FLAG[TF_MENU_SELECT] == 1)
	{
		
		//ChangeAnimation( "DANA", "ANI_EV_RYOTESIRI_S", -1, 1 )	// 両手 尻組み
		//
		//TalkPopup("DANA",0,1,0,0,0)
		//{
		//	"#000e#000m（やっぱりどんな事でも"
		//	"　放ってはおけないかな。）\p"
		//	"（私にできることは、"
		//	"　全てやっておきたいから。）"
		//}
		//WaitPrompt()
		//WaitCloseWindow()
		//
		//TalkPopup("Olga",0,0,0,0,0)
		//{
		//	"#011e#080m（やれやれ、欲張りな奴だ。）"	//（微笑）
		//}
		//WaitPrompt()
		//WaitCloseWindow()
		//
		////	  　オルガ、少し前に出る。
		//LookReset("Olga")
		//TurnTo("Olga",-531.82f, 832.95f, 5.64f,6.0f)

		//ChangeAnimation( "DANA", "ANI_EV_RYOTESIRI_E", -1, 1 )	// 両手 尻組み

		//// 移動
		//SetMotSpd("Olga" ,-1 , 0.7f )	// モーションスピード変更
		//ExecuteCmd(1, MoveTo, "Olga", -531.82f, 832.95f, 5.64f , 0.1f, 0.14f)

		//LookChr("mp6203m_citizen2", "Olga")
		//WaitThread(1)
		//SetMotSpd("Olga" ,-1 , 1.0f )	// モーションスピード戻す
		//Wait(20)
		//ChangeAnimation( "Olga", "ANI_EV_TEBURI", -1, 1 )	// 手振り
		//
		//TalkPopup("Olga",0,2,0,0,0)
		//{
		//	"#000e#000m確かに些事なようだが、"
		//	"門が動かぬのは不便であろう。\p"
		//	"巫女様も、力になろうと"
		//	"お考えのようだぞ。"
		//}
		//WaitPrompt()
		//WaitCloseWindow()
		//
		////	男性
		//TalkPopup("mp6203m_citizen2",0,2,0,0,0)
		//{
		//	"#000e#000mおお、本当でございますか。"
		//}
		//WaitPrompt()
		//WaitCloseWindow()
		//
		//LookChr("DANA", "mp6203m_citizen2")
		//Turn("DANA",6.51f,8.0f)
		
		//	  　ダーナ、頷く
		HeadYes("DANA" , 1 , 25)
		
		LookChr("mp6203m_citizen2", "DANA")
		
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000mよろしければ、私から"
			"バハの塔に連絡しておきましょう。\p"
			"きっと数日のうちに"
			"直していただけると思いますよ。"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		//	男性
		TalkPopup("mp6203m_citizen3",0,2,0,0,0)
		{
			"#011e#000mかたじけない、"
			"このような街の事まで。"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		ChangeAnimation( "mp6203m_citizen4", "ANI_EV_TEBURI", -1, 1 )	// 手振り
		
		PlayVoice(Y8V_5748,"mp6203m_citizen4",100)	//ははは！
		
		//	青年
		TalkPopup("mp6203m_citizen4",0,2,0,0,0)
		{
			"#021e#000mはは、さっすが"
			"お転婆巫女様ですなっ！"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		LookChr( "mp6203m_citizen2",  "mp6203m_citizen4" )
		
		//	男性
		TalkPopup("mp6203m_citizen2",0,0,0,0,0)
		{
			"#000e#000mこらっ、失礼ぞ！"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		LookChr( "mp6203m_citizen3",  "mp6203m_citizen4" )
		ChangeAnimation( "mp6203m_citizen3", "ANI_EV_TEKOSI_S", -1, 1 )
		
		//	男性
		TalkPopup("mp6203m_citizen3",0,2,0,0,0)
		{
			"#000e#000m若いもんは礼儀がなっとらん！"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		ChangeAnimation( "DANA" , "ANI_EV_WAIT2_S", -1 , 1 )
		
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000m（あ、あははは……）"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		//　　暗転。
		FadeOut(FADE_BLACK,FADE_FAST)
		WaitFade()
		
		//	ナレーション
		TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
		{
			"#7Cその後、ダーナは修理を依頼する書簡をしたため、"
			"#7Cバハの塔へ届けるよう手配したのだった。"
		}
		WaitPrompt()
		WaitCloseWindow()

		Wait(5)
		PlaySE(SE_QUEST_END, 100, 0, 0, 0, 1.0f, 0)		// クエスト達成	

		//	システムテキスト
		TalkPopup(UNDEF,0,5,0,0,0)
		{
			"#8S"
			"#-1W#4Cエタニアクエスト#8C【古き祝福の大扉】#4Cを達成した！#10W" 
			"#8S"
		}
		Wait(10)
		CallFunc("system:QuestVoice_Success")
		WaitPrompt()
		WaitCloseWindow()

		PlaySE(SE_VIRTUE, 100, 0, 0, 0, 1.0f, 0)	//徳ポイントアップ

		//	システムテキスト
		TalkPopup(UNDEF,0,5,0,0,0)
		{
			"#8S"
			"#-1W#4Cダーナの徳が上昇した。#10W"
			"#8S"
		}
		Wait(10)
		WaitPrompt()
		WaitCloseWindow()
			//　　暗転明けで操作許可。

		
		//　　※また、現代編に戻ると変化地点に
		//　　　サブイベントのマーカーがついている状態になる。
	}
	//	⇒このまま立ち去る
	else if (FLAG[TF_MENU_SELECT] == 2)
	{
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000m（少し気にはなるんだけど……）"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		//	  　イベント終了、操作許可。
		FadeOut(FADE_BLACK,FADE_FAST)
		WaitFade()
	}
	//────────────────────

//終了処理ここから----------------------------------------------------
	CallFunc("mp6203m:SubEV_Past_04_Gimmick_ED")
}
function "SubEV_Past_04_Gimmick_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
//	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_ALL")

	ChangeAnimation( "mp6203m_citizen2", "ANI_WAIT", -1, 1 )	// 待機
	ChangeAnimation( "mp6203m_citizen3", "ANI_WAIT", -1, 1 )	// 待機
	ChangeAnimation( "mp6203m_citizen4", "ANI_WAIT", -1, 1 )	// 待機

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	if (FLAG[TF_MENU_SELECT] == 1) {
		// クエスト進行させる選択肢を選んだ ------------------------ /
		
		//フラグ立て
		SetFlag( GF_SUBEV_PAST_04_GIMMICK, 2 )	// 過去編Ⅳ：【過去ギミック④：大僧院の扉を直す】を見た（1:見て立ち去った、2:直すように口添えした）
		SetFlag(GF_VIRTURE_POINT,(FLAG[GF_VIRTURE_POINT] + 5 ))			//徳ポイント加算
		EventCue("system:EV_FloorOpen")			//扉が開く予知を視る キューを入れる

		//マーカー設置
 		SetMapMarker( SMI_SUBEVENT, PAGE_F032, MARKER_SUBEV_PAST04,	-535.56f,829.13f,5.64f, 	-535.56f,829.13f,	MARKER_SUBEV_PAST04, MN_F_MP6203,	0)	// 過去編Ⅳ：現代編、大僧院の扉の場所用

	} else {
		// スキップした場合、クエスト進行させない選択肢を選んだ ----/
	}

	CallFunc("system:SetMarkerDANA")	//クエスト系マーカー処理
	
	SetChrPos("Olga" , -100000.00f  , 0.00f ,0.00f )	// オルガを画面外に移動

	CallFunc("mp6203m:init")
	CallFunc("mp6203m:NPC_Move_t01_Pos")		//★パッチ1.01対応：ルートムーブNPCの座標強制指定

	//イベント後の再配置
	SetChrPos("LEADER",-530.04f, 844.58f, 2.75f)
	Turn("LEADER",-173.08f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	//カメラ位置復帰
	//MoveCameraAt( 0 , 0.0f , 0.0f , 0.0f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 0.0f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 0.0f , 0 )		// 基本仰角
	//RotateCamera( 0 , 0.0f , 0 )				// 角度
	//ChangeCameraPers( 0 , 0.0f , 0 )			// 視野角
	//SetCameraZPlane( 0 , 0.0f )					// ZPlane
	//RollCamera( 0 , 0.0f , 0 )					// ロール回転

	RestoreCamera(0, 0)		//※上記カメラ位置を指定する場合は不要
	CallFunc("system:camera_reset")

	FadeIn(FADE_BLACK, FADE_FAST)
	ResetStopFlag(STOPFLAG_EVENT)

//終了処理ここまで----------------------------------------------------
}

////////////////////////////////////////////////////////////////////////////////

//■ストッパー・ＬＰセクション

////////////////////////////////////////////////////////////////////////////////
//──────────────────────────────
//	【ストッパー：大僧院に入れない】
//──────────────────────────────
function "Stopper_Past_D3_06"
{
	//　　※エピソードに関わらず、大僧院の前の門は開けておく。
	//▼ダーナ編③王都を歩く
	//	mp6203m	-535.34f	830.96f	5.64f	1.65f付近

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	TalkPopup("LEADER",0,0,0,0,0)
	{
		"#000e#000mボラド大僧院……"
		"訪ねる用事はなさそうかな。"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-534.62f,835.01f,5.44f)
	Turn("LEADER",-173.18f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ストッパー：大僧院に入れない】
//──────────────────────────────
function "Stopper_Past_02_06"
{
	//	mp6203m	-535.34f	830.96f	5.64f	1.65f付近

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	//▼過去編Ⅱ南門へ向かう
	TalkPopup("LEADER",0,0,0,0,0)
	{
		"#000e#000mボラド大僧院……"
		"訪ねる用事はなさそうかな。"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-534.62f,835.01f,5.44f)
	Turn("LEADER",-173.18f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ストッパー：大僧院に入れない】
//──────────────────────────────
function "Stopper_Past_04_05"
{

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	//▼過去編Ⅳ王宮前へ向かう
	TalkPopup("LEADER",0,0,0,0,0)
	{
		"#000e#000mボラド大僧院……"
		"訪ねる用事はなさそうかな。"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-534.62f,835.01f,5.44f)
	Turn("LEADER",-173.18f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}
