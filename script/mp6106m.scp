#include "inc/mons.h"
#include "inc/def.h"
#include "inc/flag.h"
#include "inc/se.h"
#include "inc/scr_inc.h"
#include "inc/3dicon.h"
#include "inc/skilldef.h"
#include "inc/vo.h"
#include "inc/music.h"
#include "inc/efx.h"
#include "inc/temp/mp6106m.h"

//----------------------------------------------------------------------------//
//                                                                            //
// 西街道（過去）  			                                              //
//                                                                            //
//----------------------------------------------------------------------------//
///////////////////////////////////////////////////////////////////////////////
// 初期化スクリプト
///////////////////////////////////////////////////////////////////////////////
//-------------------------------------------

function "init"
{
	
	//遠景不必要ノード削除◆マップ作業者用
	MapHide( "@BG2_mp6106m" , 0 )
	MapHide( "@BG2_mp6107m_2" , 0 )
	MapHide( "@BG2_mp5104m" , 0 )

	//大樹の色制御
	MapAnime(gim_taiju , normal )

	// イベントエリア設定制御
	EventAreaEnable("evb2_M05S400", 0)		// [M05S400][過去Ⅴ　衛士たちに誰何を受ける]
	EventAreaEnable( "SubEV_Past_05_HuntB_1", 0)	// 過去編Ⅳ：【討伐イベントＢ：竜種と遭遇】
	EventAreaEnable( "Stopper_Past_05_02" , 0 )		// 過去編Ⅴ：【ストッパー：西街道分岐→寺院方面へ行けない】
	EventAreaEnable( "Stopper_Past_05_03" , 0 )		// 過去編Ⅴ：【ストッパー：西街道のストッパー】
	EventAreaEnable( "Stopper_Past_05_04" , 0 )		// 過去編Ⅴ：【ストッパー：王家の谷の門のストッパー】
	EventAreaEnable( "Stopper_Past_06_06" , 0 )		// 過去編Ⅵ：【ストッパー：西街道分岐のストッパー】
	EventAreaEnable( "Stopper_Past_06_07" , 0 )		// 過去編Ⅵ：【ストッパー：西街道のストッパー】
	EventAreaEnable( "Stopper_Past_05_05" , 0 )		// 過去編Ⅵ：【ストッパー：西街道のストッパー】
//	EventAreaEnable( "evb2_act_0525" , 0 )	//アクティブボイス
	EventAreaEnable( "evb2_act_1510" , 0 )	//アクティブボイス

	if (FLAG[SF_EVENT_ON]) {

		SetChrPos("SubEV_Past_SpiritH", -100000.00f, 0.00f, 0.00f)

		// 雪
		Set3DParticle(PARTICLE_TYPE_SNOW, 0.0f,0.0f,-0.1f, 0.1f,0.0f,0.2f, 0.0f,0.0f,0.0f, 0.0f,0.0f,0.0f, 180.0f, 0.0f)

		//一般配置ファンクション呼び出し
		CallFunc("mp6106m:NpcPosition")

		// イベント制御
		if (!FLAG[GF_05MP6105_GOTO_VALLAY]			// ▽[M05S410][王都の谷を目指す]
		&& FLAG[GF_05MP6106M_SOLDIER_ASK]) {		// ▼[M05S400][過去Ⅴ　衛士たちに誰何を受ける]
			//SetChrPos("LP_M05S401", -933.29f, 677.94f, 48.74f)
			SetChrPos("LP_M05S401", -934.02f, 678.87f, 48.03f)
		}
		else if (!FLAG[GF_05MP6106M_SOLDIER_ASK]	// ▽[M05S400][過去Ⅴ　衛士たちに誰何を受ける]
		&& FLAG[GF_05MP6203_GOTO_VALLEY]) { 		// ▼[M05S391][過去Ⅴ　ダーナが王家の谷へ出発]
			EventAreaEnable("evb2_M05S400", 1)
		}
	
		// サブイベント制御
		if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )			//▼過去編Ⅴ王家の谷へ向かう
		{
			if( !FLAG[GF_SUBEV_PAST_05_HUNTB_LOOK] )		// 過去編Ⅴ：【討伐イベントＢ：竜種と遭遇】を見た
			{
				EventAreaEnable("SubEV_Past_05_HuntB_1", 1)	// 過去編Ⅴ：【討伐イベントＢ：竜種と遭遇】
			}
			
			// 討伐イベント用モンスターの配置
			if( FLAG[GF_SUBEV_PAST_05_HUNTB_LOOK] &&	// 過去編Ⅴ：【討伐イベントＢ：竜種と遭遇】を見た
				!FLAG[GF_SUBEV_PAST_05_HUNTB_KILL] )	// 過去編Ⅴ：【討伐イベントＢ：撃破後】を見た
			{
				SetChrPos("HuntB_mons",-922.15f,634.67f,31.69f)
				Turn("HuntB_mons",-104.87f,360.0f)
			}
			if(!FLAG[GF_SUBEV_PAST_SPIRITH])			// 過去編Ⅴ：【精霊救出Ｈ：渦から精霊を救出する】を見た
			{
				SetChrPos("SubEV_Past_SpiritH",-989.96f,636.61f,34.42f)	// 過去編Ⅴ：【精霊救出Ｈ：渦から精霊を救出する】
			}
		}
	
		//過去編Ⅴでのみ発生するイベントのため、他のタイミングで来た時のためにマーカーの表示切替え処理をここで入れてます
		if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )			//▼過去編Ⅴ王家の谷へ向かう
		{
			if( FLAG[GF_SUBEV_PAST_05_HUNTB_LOOK] &&	// 過去編Ⅴ：【討伐イベントＢ：竜種と遭遇】を見た
				!FLAG[GF_SUBEV_PAST_05_HUNTB_KILL] )	// 過去編Ⅴ：【討伐イベントＢ：撃破後】を見た
			{
				SetMapMarker( SMI_SUBEVENT, PAGE_FXXXM, MARKER_SUBEV_PAST05_2,	-922.15f,634.67f,31.69f, 	-922.15f,634.67f,	MARKER_SUBEV_PAST05_2, MN_F_MP6106M,	-1)	// 過去編Ⅴ：出現したモンスターの居場所用
			}
			else
			{
				DelMapMarker( SMI_SUBEVENT, PAGE_FXXXM, MARKER_SUBEV_PAST05_2, 0, 0)	// 過去編Ⅴ：出現したモンスターの居場所用
			}
		}
		else
		{
			DelMapMarker( SMI_SUBEVENT, PAGE_FXXXM, MARKER_SUBEV_PAST05_2, 0, 0)	// 過去編Ⅴ：出現したモンスターの居場所用
		}
	
		// アクティブボイス
//		if(!FLAG[GF_AVOICE_0525] && FLAG[GF_05MP6203_GOTO_VALLEY] && !FLAG[GF_05MP6106M_SOLDIER_ASK]){
//			EventAreaEnable( "evb2_act_0525" , 1 )
//		}
		if(!FLAG[GF_AVOICE_1510] && FLAG[GF_05MP6203_GOTO_VALLEY] && !FLAG[GF_05MP6106M_SOLDIER_ASK]){
			EventAreaEnable( "evb2_act_1510" , 1 )
		}

		// ストッパー制御
		
		if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )			//▼過去編Ⅴ王家の谷へ向かう
		{
			
			if (FLAG[GF_05MP6105_GOTO_VALLAY]) {		// ▼[M05S410][王都の谷を目指す]
				EventAreaEnable( "Stopper_Past_05_05" , 1 )		// 過去編Ⅵ：【ストッパー：西街道のストッパー】
			}
			
			EventAreaEnable( "Stopper_Past_05_02" , 1 )	// 過去編Ⅴ：【ストッパー：西街道分岐→寺院方面へ行けない】
			EventAreaEnable( "Stopper_Past_05_03" , 1 )	// 過去編Ⅴ：【ストッパー：西街道のストッパー】
			EventAreaEnable( "Stopper_Past_05_04" , 1 )	// 過去編Ⅴ：【ストッパー：王家の谷の門のストッパー】
		}
		if( FLAG[GF_PAST_EPISODE_6_GO_GARDEN] )			//▼過去編Ⅵセレンの園へ向かう
		{
			EventAreaEnable( "Stopper_Past_06_06" , 1 )	// 過去編Ⅵ：【ストッパー：西街道分岐のストッパー】
			EventAreaEnable( "Stopper_Past_06_07" , 1 )	// 過去編Ⅵ：【ストッパー：西街道のストッパー】
		}
	
		//ＮＰＣマーカーセット
		CallFunc("system:SetMarkerNPC")
	}

	//マップ名表示
	if(!FLAG[SF_LOADINIT] && !FLAG[GF_MPxxxx_MAP_NAME_NO_DRAW] && !FLAG[TF_MAPNAME_SHOWN]){
		if( FLAG[SF_LASTENTRY_NO] == 0 || FLAG[SF_LASTENTRY_NO] == 2 || FLAG[SF_LASTENTRY_NO] == 100 ){
			VisualName("visual/mapname/mn_6106m.itp",VN_NAMEMAP2,-1,-1,VN_MAPNAME_TIME)//ロディニア街道
			SetFlag( TF_MAPNAME_SHOWN, 1 )				// 地名表示した（テンポラリ）
		}
	}

	// マップノード制御
	MapHide("gim_himorogi", 0)		// ヒモロギ苗
	
	if (FLAG[SF_EVENT_ON]) {
		if (FLAG[GF_05MP6105_GOTO_VALLAY]) {	// ▼[M05S410][王都の谷を目指す]
			MapHide("gim_himorogi", 1)		// ヒモロギ苗
			MapAnime("gim_himorogi", "on")		// ヒモロギ苗
			if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )			//▼過去編Ⅴ王家の谷へ向かう
			{
				SetChrPos("LP_SubEV_Past_05_Return",-933.88f,674.41f,48.03f)		// 過去編Ⅴ：【過去編Ⅴ：現代に戻るイベント】
				SetChrWork( "LP_SubEV_Past_05_Return" , CWK_CHECKRADIUS , 2.5f )	// 範囲
			}
		}
	}

	//サウンド制御
//	if( FLAG[GF_PAST_EPISODE_6_GO_GARDEN] )			//▼過去編Ⅵセレンの園へ向かう
//	{
//		SetWork( WK_BGM , BGM_FIELD_801 )
//	}
}

//////////////////////////////////////////////////////////////////////
//■アクティブボイス
//////////////////////////////////////////////////////////////////////
//function "act_0525"
//{
//	if (!FLAG[GF_AVOICE_0525])
//	{
//		EventAreaEnable( "evb2_act_0525" , 0 )
//		ActiveVoiceStop(ACTIVEVOICESTOP_WINDOWOFF)
//		ActiveVoiceStart(EACT_EVID_0525, 1, 0)	//終点に近づく
//	}
//}
// 0525　が　1510に置き換えられました。
function "act_1510"
{
	if (!FLAG[GF_AVOICE_1510])
	{
		EventAreaEnable( "evb2_act_1510" , 0 )
		ActiveVoiceStop(ACTIVEVOICESTOP_WINDOWOFF)
		ActiveVoiceStart(EACT_EVID_1510, 1, 0)	//王家の私有地の門番が見えたら
	}
}

//////////////////////////////////////////////////////////////////////
//■一般配置
//////////////////////////////////////////////////////////////////////
function "NpcPosition"
{

	if( FLAG[GF_PAST_EPISODE_6_GO_GARDEN] )			//▼過去編Ⅵセレンの園へ向かう
	{
//		SetChrPos("C390_01",-739.65f	660.73f	41.86f)
//		Turn("C390_01",101.43f,360.0f)
		SetChrPos("C390_01",-743.42f	656.71f	41.62f)
		Turn("C390_01",83.64f,360.0f)

		SetChrInfoFlag( "Citizen_6_C01" , INFOFLAG_NOMAPATARICHECK )
		SetChrInfoFlag( "Citizen_6_C01" , INFOFLAG_NOGRAVITY )
		SetChrPos("Citizen_6_C01",-745.07f	661.70f	42.58f)
		Turn("Citizen_6_C01",-163.90f,360.0f)
		ChangeAnimation("Citizen_6_C01","ANI_EV_SIT_C", -1 , 1 )	
		Look("Citizen_6_C01", 0.0f, -30.0f)	// うつむく

	}
	else if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )	//▼過去編Ⅴ王家の谷へ向かう
	{
		if( FLAG[GF_SUBEV_PAST_05_QUEST_A] &&	// 過去編Ⅴ：【過去クエスト⑤Ａ：避難民に話を聞く】を見た
			!FLAG[GF_SUBEV_PAST_05_QUEST_C] )	// 過去編Ⅴ：【過去クエスト⑤Ｃ：達成イベント】を見た
		{
			//	【ユカ】		//	場所		：西街道②（過去）	街道の外れ
			SetChrPos("Yuka",-728.34f, 660.18f, 41.66f)
			Turn("Yuka",19.78f,360.0f)
		}

		if (FLAG[GF_05MP6105_GOTO_VALLAY]) {		// ▼[M05S410][王都の谷を目指す]
		
			// 門に立ってる衛兵
			SetChrPos("soldierA", -957.66f, 669.29f, 47.25f)
			Turn("soldierA", -14.97f, 360.0f)
			SetChrPos("soldierC", -951.75f, 672.11f, 47.25f)
			Turn("soldierC", -29.18f, 360.0f)
			SetChrPos("soldierE", -954.54f, 670.37f, 47.25f)	// ゴツイやつ
			Turn("soldierE", -23.22f, 360.0f)
			// 剣装備
			SetChrPos("ev_eq4028_1", -956.14f, 671.36f, 47.25f)
			SetParent("ev_eq4028_1", "soldierA", "Null_ken")
			SetChrPos("ev_eq4028_2", -953.92f, 672.29f, 47.25f)
			SetParent("ev_eq4028_2", "soldierC", "Null_ken")
			
			ChangeAnimation("soldierA","ANI_EV_WAIT_BUKI", -1 , 1 )	// 歩哨待機
			ChangeAnimation("soldierC","ANI_EV_WAIT_BUKI", -1 , 1 )	// 歩哨待機
			ChangeAnimation("soldierE","ANI_EV_WAIT_BUKI", -1 , 1 )	// 歩哨待機
			SetChrPos("eq4029", -955.28f, 668.66f, 47.25f)	//槍
			SetParent( "eq4029" , "soldierA", "Null_Rhand" )		//槍
			ChangeAnimation("eq4029","ANI_WAIT_c380", -1 , 1 )	// 歩哨待機
			SetChrPos("eq4029_2", -951.21f, 672.84f, 47.25f)	//槍
			SetParent( "eq4029_2" , "soldierC", "Null_Rhand" )		//槍
			ChangeAnimation("eq4029_2","ANI_WAIT_c380", -1 , 1 )	// 歩哨待機
			SetChrPos("eq4029_3", -952.90f, 670.32f, 47.25f)	//槍
			SetParent( "eq4029_3" , "soldierE", "Null_Rhand" )		//槍
			ChangeAnimation("eq4029_3","ANI_WAIT_c381", -1 , 1 )	// 歩哨待機
		
		}
		else if(!FLAG[GF_05MP6105_GOTO_VALLAY]		// ▽[M05S410][王都の谷を目指す
		&& FLAG[GF_05MP6106M_SOLDIER_ASK]) {		// ▼[M05S400][過去Ⅴ　衛士たちに誰何を受ける]

			// うつ伏せ倒れ衛兵
			SetChrPos("soldierA", -951.32f, 666.25f, 47.25f)
			Turn("soldierA", -23.63f, 360.0f)
			SetChrPos("soldierB", -949.54f, 667.93f, 47.25f)
			Turn("soldierB", -47.07f, 360.0f)
			ChangeAnimation( "soldierA", "ANI_EV_TAORE", -1, 1 )	// うつ伏せ倒れ
			ChangeAnimation( "soldierB", "ANI_EV_TAORE", -1, 1 )	// うつ伏せ倒れ
		}
		else if (!FLAG[GF_05MP6106M_SOLDIER_ASK]	// ▽[M05S400][過去Ⅴ　衛士たちに誰何を受ける]
		&& FLAG[GF_05MP6203_GOTO_VALLEY]) { 		// ▼[M05S391][過去Ⅴ　ダーナが王家の谷へ出発]
			
			// 門に立ってる衛兵
			SetChrPos("soldierA", -956.14f, 671.36f, 47.25f)
			Turn("soldierA", -22.08f, 360.0f)
			SetChrPos("soldierB", -953.92f, 672.29f, 47.25f)
			Turn("soldierB", -29.18f, 360.0f)
			// 剣装備
			SetChrPos("ev_eq4028_1", -956.14f, 671.36f, 47.25f)
			SetParent("ev_eq4028_1", "soldierA", "Null_ken")
			SetChrPos("ev_eq4028_2", -953.92f, 672.29f, 47.25f)
			SetParent("ev_eq4028_2", "soldierB", "Null_ken")
			
		}
		
		
	}
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//■一般会話セクション

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//──────────────────────────────
//	【衛士】
//──────────────────────────────
function "Talk_soldierA"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )			//▼過去編Ⅴ王家の谷へ向かう
	{
		//▼過去編Ⅴ王家の谷へ向かう
		//	※ダーナが衛士を気絶させた後に出現
		//───────────────
		//	場所		：西街道②（過去）
		//───────────────
		//	配置・カメラ：メインイベントと同じ位置
		//	モーション	：倒れ／瞑目
		//───────────────
		//　　振り向かない
		//	衛士
		TalkPopup("this",0,0,0,0,0)
		{
			"…………ぐっ…………"
		}
		WaitPrompt()
		WaitCloseWindow()

		//	ナレーション
		TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
		{
			"#7C衛士は気を失っているようだ。"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ResetStopFlag(STOPFLAG_TALK)
}


//──────────────────────────────
//	【衛士】
//──────────────────────────────
function "Talk_soldierB"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )			//▼過去編Ⅴ王家の谷へ向かう
	{
		//▼過去編Ⅴ王家の谷へ向かう
		//	※ダーナが衛士を気絶させた後に出現
		//───────────────
		//	場所		：西街道②（過去）
		//───────────────
		//	配置・カメラ：メインイベントと同じ位置
		//	モーション	：倒れ／瞑目
		//───────────────
		//　　振り向かない
		//	衛士
		TalkPopup("this",0,0,0,0,0)
		{
			"………ううむ……………"
		}
		WaitPrompt()
		WaitCloseWindow()

		//	ナレーション
		TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
		{
			"#7C衛士は気を失っているようだ。"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ResetStopFlag(STOPFLAG_TALK)
}

//──────────────────────────────
//	【男】
//──────────────────────────────
function "Talk_Citizen_6_C01"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_6_GO_GARDEN] )			//▼過去編Ⅵセレンの園へ向かう
	{
		//▼過去編Ⅵセレンの園へ向かう
		//───────────────
		//	場所		：mp6106m西街道（過去）
		//───────────────
		//	配置・カメラ：分岐点を過ぎた辺り／近くに竜車を置く
		//	モーション	：座り込む
		//───────────────
		//	男
		LookChr("this", "LEADER")

		TalkPopup("this",0,0,0,0,0)
		{
			"………誰だ、アンタ………\p"
			"この先にはもう、なにもねえ……"
			"いるのは狂った竜種か野盗だけさ……\p"
			"……ああ……！　オレたちゃ"
			"一体どうすりゃいいんだ……っ！"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

	ResetStopFlag(STOPFLAG_TALK)
	Look("this", 0.0f, -30.0f)	// うつむく
}

//──────────────────────────────
//	【ユカ】
//──────────────────────────────
function "Talk_Yuka"
{
	if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )			//▼過去編Ⅴ王家の谷へ向かう
	{
		if( !FLAG[GF_SUBEV_PAST_05_QUEST_C] )	// 過去編Ⅴ：【過去クエスト⑤Ｃ：達成イベント】を見た
		{
			SetFlag( TF_LOADING_TIPS_OFF, 1 )	//NowLoading 時の Tips 表示をカット
			EventCue("mp6106m:SubEV_Past_05_Quest_B")	// 過去編Ⅴ：【過去クエスト⑤Ｂ：はぐれた娘を発見】
		}
	}
}


////////////////////////////////////////////////////////////////////////////////

//■メインイベントセクション

////////////////////////////////////////////////////////////////////////////////

//──────────────────────────────
//▼過去Ⅴ　衛士たちに誰何を受ける
//──────────────────────────────
function "EV_M05S400"			//過去Ⅴ　衛士たちに誰何を受ける
{
	//開始処理ここから-----------------------------------------------
	CallFunc("system:event_begin")	// イベントボックス起動
	
	SetStopFlag(STOPFLAG_EVENT)
	FadeOut(FADE_BLACK, 0)
	WaitFade()

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	//ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定				
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("DANA", INFOFLAG_NOCHRATARI)
	SetChrPos("DANA", -943.77f, 661.25f, 47.25f)
	Turn("DANA", 139.34f, 360.0f)
	ChangeAnimation("DANA", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("DANA", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	ChangeSubAnimation("DANA", SUBMOT_EXT1, ANI_E_LOOKC, 1)
	LookReset("DANA")
	
	SetChrWork("soldierA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("soldierA", INFOFLAG_NOCHRATARI)
	SetChrPos("soldierA", -956.14f, 671.36f, 47.25f)
	Turn("soldierA", -22.08f, 360.0f)
	ChangeAnimation("soldierA", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("soldierA", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("soldierA", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	LookReset("soldierA")

	SetChrWork("soldierB", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("soldierB", INFOFLAG_NOCHRATARI)
	SetChrPos("soldierB", -953.92f, 672.29f, 47.25f)
	Turn("soldierB", -29.18f, 360.0f)
	ChangeAnimation("soldierB", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("soldierB", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("soldierB", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	LookReset("soldierB")
	
	SetChrPos("ev_eq4028_1", -956.14f, 671.36f, 47.25f)
	SetParent("ev_eq4028_1", "soldierA", "Null_ken")
	SetChrPos("ev_eq4028_2", -953.92f, 672.29f, 47.25f)
	SetParent("ev_eq4028_2", "soldierB", "Null_ken")

	//カメラ設定
	MoveCameraAt( 0 , -954.766f , 670.419f , 49.753f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 4.241f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -2.934f , 0 )	// 基本仰角
	RotateCamera( 0 , 345.713f , 0 )				// 角度
	ChangeCameraPers( 0 , 50.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 3.000, 120.000, 0.000, 0.550, 0.500)					//イベント毎に調整
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300, 1.000, 1.000, 0.600, 0.000, 1.000)	//イベント毎に調整

	//スキップ許可
	SetSkipScript("mp6106m:EV_M05S400_ED")

	//開始処理ここまで-----------------------------------------------

	//　　水晶石のマップに到着するとイベント開始。
	//　　画面フェードインして正面の門と兵士たち、
	//　　そして水晶石を見せた後、ダーナがフレームイン。
	
	// カット1 ----------------------------------------------------------------------------------------

//	// カメラ移動
//	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -954.901f , 669.850f , 49.053f , 120 )
//	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 4.241f , 120 )
//	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -4.067f , 120 )
//	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 321.935f , 120 )
//
//	// フェードイン
//	FadeIn(FADE_BLACK, FADE_NORMAL)
//	Wait(FADE_NORMAL)
//
//	// カメラ待ち
//	WaitThread(1000)
//	WaitThread(1001)
//	WaitThread(1002)
//	WaitThread(1003)
//	
//	Wait(30)
//	
//	// カット2 ----------------------------------------------------------------------------------------
//
//	// クロスフェード
//	CrossFade(FADE_NORMAL)

	FadeBGM(70,30)
	
	// カメラ
	MoveCameraAt( 0 , -946.397f , 664.198f , 49.373f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.621f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -0.753f , 0 )	// 基本仰角
	RotateCamera( 0 , 31.090f , 0 )				// 角度
	ChangeCameraPers( 0 , 50.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。
	
	// 位置調整・表情・モーション
	SetChrPos("soldierA", -954.75f, 669.10f, 47.25f)
	Turn("soldierA", -24.87f, 360.0f)
	SetChrPos("soldierB", -952.88f, 670.05f, 47.25f)
	Turn("soldierB", -24.87f, 360.0f)
		
	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -948.625f , 666.167f , 48.653f , 120 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.621f , 120 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE ,  -3.331f , 120 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 27.652f, 120 )
	
	// 移動
	ExecuteCmd(1, MoveTo, "DANA", -947.92f, 666.00f, 47.25f, 0.1f, 0.245f)

	// フェードイン
	FadeIn(FADE_BLACK, FADE_NORMAL)
	WaitFade()

	
	// 移動待ち
	WaitThread(1)
	
	// ダーナ
	TalkPopup("DANA", 0, 1, 0, 0, 0) {
		"#000e#000mこの辺りだね……"
	}
	WaitPrompt()
	WaitCloseWindow()

	// カメラ待ち
	WaitThread(1000)
	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)

	//　　門に立っている衛士たちにＰＡエモーション。
	EmotionEx("soldierA", 0.00f, EMO_PA, 0, 5, 1, 1, 1.5f )	// 「PA」
	LookChr("soldierA", "DANA")
	EmotionEx("soldierB", 0.00f, EMO_PA, 0, 5, 1, 1, 1.5f )	// 「PA」
	LookChr("soldierB", "DANA")
	Wait(30)
	
	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -948.526f , 666.604f , 48.912f , 90 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.181f , 90 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -9.634f, 90 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 78.921f, 90 )

	//MoveCameraAt( 0 , -948.526f , 666.604f , 48.912f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.181f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -9.634f , 0 )	// 基本仰角
	//RotateCamera( 0 , 78.921f , 0 )				// 角度
	//ChangeCameraPers( 0 , 50.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。
	
	// 移動
	ExecuteCmd(1, MoveTo, "soldierA", -950.35f, 666.81f, 47.25f, 0.1f, 0.24f)
	Wait(10)
	ExecuteCmd(2, MoveTo, "soldierB", -949.46f, 667.88f, 47.25f, 0.1f, 0.24f)

	LookChr("DANA", "soldierA")
	TurnToChr("DANA", "soldierA",8.0f)

	// 移動待ち
	WaitThread(1)

	// カメラ待ち
	WaitThread(1000)
	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)


	// 衛士Ａ
	TalkPopup("soldierA", 0, 2, 0, 0, 0) {
		"貴様、何者だ！？"
	}
	WaitPrompt()
	WaitCloseWindow()

	// 移動待ち
	WaitThread(2)


	// 衛士Ｂ
	TalkPopup("soldierB", 0, 2, 0, 0, 0) {
		"この先は神聖不可侵ともいうべき"
		"王家の谷である。\p"
		"何人たりとも通すわけにはいかん！"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　衛士Ａに「！」エモーション表示。
	EmotionEx("soldierA", 0.00f, EMO_EX, 0, 5, 1, 1, 1.2f )	// 「！」
	Wait(40)
	
	// 衛士Ａ
	TalkPopup("soldierA", 0, 2, 0, 0, 0) {
		"#070e#000mま、待て……この方はまさか……"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　衛士Ｂに「！」エモーション表示。
	EmotionEx("soldierB", 0.00f, EMO_EX, 0, 5, 1, 1, 1.2f )	// 「！」
	Wait(35)
	
	
	// 衛士Ｂ
	TalkPopup("soldierB", 0, 2, 0, 0, 0) {
		"#070e#000mダ、ダ、ダーナ様！？"
		"どうしてこのような場所へ……"
	}
	WaitPrompt()
	WaitCloseWindow()

	// 衛士Ａ
	TalkPopup("soldierA", 0, 0, 0, 0, 0) {
		"#011e#000mえ、ええい、例え巫女様であっても、"
		"ここを通らせるわけには……"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　不意に理力のエフェクトをまとうダーナ。
	SetMotSpd("DANA" ,-1 , 0.6f )	// モーションスピード変更
	ChangeAnimation( "DANA", "ANI_EV_TEMUNE_S", -1, 1 )	// 手胸当て
	Look("DANA", 0.0f, -5.0f)	// うつむく
	ChrEffect2( "DANA" , 3900600 , "Bone_root", "", 0 , 0 , 0 , 0.0f,0.0f,0, 1.0f, 1.0f)	// 理力オーラ（ループ）
	PlaySE(SE_M05S400_01, 80, 0, 500, 0, 1.0f, 0)
	Wait(60)
	
	//　　ここで画面フェードアウト＆暗転のまま下記のセリフ。
	
	FadeBGM(30,30)

	// フェードアウト
	FadeOut(FADE_BLACK, FADE_NORMAL)
	WaitFade()
	
	SetMotSpd("DANA" ,-1 , 1.0f )	// モーションスピード戻す
	
	// ダーナ
	TalkPopup("DANA", 0, 3, 240, 230, 0) {
		"#000e#000m……ごめんね、少しの間、"
		"眠っていてもらうよ。"
	}
	WaitPrompt()
	WaitCloseWindow()

	PlaySE(SE_M05S400_02, 80, 0, 0, 0, 1.0f, 0)
	Wait(45)	// 暗転時間
	PlaySE(SE_M05S400_03, 70, 0, 500, 0, 1.0f, 0)
	Wait(35)

	//　　画面フェードインして操作許可。
	//　　兵士たちがダーナの周囲で眠っている状態。
	//　　水晶石のＬＰを調べて苗木を植えると、
	//　　過去編の遷移エフェクト表示して画面ホワイトアウト。

	//終了処理ここから----------------------------------------------------
	CallFunc("mp6106m:EV_M05S400_ED")
}

function "EV_M05S400_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_DANA")

	// 寝落ちしている衛兵
	SetChrPos("soldierA", -951.32f, 666.25f, 47.25f)
	Turn("soldierA", -23.63f, 360.0f)
	SetChrPos("soldierB", -949.54f, 667.93f, 47.25f)
	Turn("soldierB", -47.07f, 360.0f)
	ChangeAnimation( "soldierA", "ANI_EV_TAORE", -1, 1 )	// うつ伏せ倒れ
	ChangeAnimation( "soldierB", "ANI_EV_TAORE", -1, 1 )	// うつ伏せ倒れ

	//パーティキャラを解放
	ReleaseEventPartyChr()
	StopEffect(-1,ALL,1)

	ActiveVoiceStop(ACTIVEVOICESTOP_FORCE)		//アクティブボイス強制終了
	
	//マップパラメーターリセット
	ResetMapParam(-1)

	// フラグ処理
	SetFlag( GF_05MP6106M_SOLDIER_ASK, 1 )
	CallFunc("mp6106m:init")

	//イベント後の再配置
	SetChrPos("LEADER", -947.07f, 664.00f, 47.25f)
	Turn("LEADER", -152.91f, 360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	//カメラ位置復帰
	MoveCameraAt( 0 , -947.074f , 664.003f , 49.125f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 7.000f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 16.319f , 0 )	// 基本仰角
	RotateCamera( 0 , -27.180f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	FadeBGM(100,30)

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()

	//終了処理ここまで----------------------------------------------------

}

//──────────────────────────────
//▼過去Ⅴ　衛士たちに誰何を受ける２
//──────────────────────────────
function "EV_M05S401"			//過去Ⅴ　衛士たちに誰何を受ける２
{
	//開始処理ここから-----------------------------------------------

	CallFunc("system:event_begin")

//	SetStopFlag(STOPFLAG_EVENT)
//	FadeOut(FADE_BLACK, 0)
//	WaitFade()

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	//ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定				
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("DANA", INFOFLAG_NOCHRATARI)
	SetChrPos("DANA", -933.32f, 673.67f, 48.00f)
	Turn("DANA", 148.37f, 360.0f)
	ChangeAnimation("DANA", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("DANA", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	ChangeSubAnimation("DANA", SUBMOT_EXT1, ANI_E_LOOKC, 1)
	LookReset("DANA")

	SetChrWork("soldierC", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("soldierC", INFOFLAG_NOCHRATARI)
	SetChrPos("soldierC", -928.82f, 671.17f, 47.24f)	// 若いの
	Turn("soldierC", 123.59f, 360.0f)
	ChangeAnimation("soldierC", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("soldierC", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("soldierC", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	LookReset("soldierC")
	
	SetChrWork("soldierD", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("soldierD", INFOFLAG_NOCHRATARI)
	SetChrPos("soldierD", -930.71f, 668.96f, 47.25f)	// 若いの
	Turn("soldierD", 144.91f, 360.0f)
	ChangeAnimation("soldierD", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("soldierD", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("soldierD", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	LookReset("soldierD")
	
	SetChrWork("soldierE", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("soldierE", INFOFLAG_NOCHRATARI)
	SetChrPos("soldierE", -930.64f, 670.69f, 47.24f)	// ゴツイやつ
	Turn("soldierE", 141.36f, 360.0f)
	ChangeAnimation("soldierE","ANI_EV_WAIT_BUKI", -1 , 1 )	// 歩哨待機
	ChangeSubAnimation("soldierE", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("soldierE", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	LookReset("soldierE")

	SetChrPos("eq4029", -930.64f, 670.69f, 47.24f)	//槍
	SetParent( "eq4029" , "soldierE", "Null_Rhand" )		//槍
	ChangeAnimation("eq4029","ANI_WAIT_c381", -1 , 1 )	// 歩哨待機

	SetChrPos("ev_eq4028_1", -930.71f, 668.96f, 47.25f)	// 剣
	SetParent("ev_eq4028_1", "soldierD", "Null_ken")
	SetChrPos("ev_eq4028_2", -928.82f, 671.17f, 47.24f)	// 剣
	SetParent("ev_eq4028_2", "soldierC", "Null_ken")
	SetChrPos("ev_eq4028_3", -930.64f, 670.69f, 47.24f)	// 剣
	SetParent("ev_eq4028_3", "soldierE", "Null_ken")

	// 非表示・再表示
	SetChrInfoFlag("soldierC", INFOFLAG_INVISIBLE)	// 非表示
	SetChrInfoFlag("soldierD", INFOFLAG_INVISIBLE)	// 非表示
	SetChrInfoFlag("soldierE", INFOFLAG_INVISIBLE)	// 非表示
	SetChrInfoFlag("eq4029", INFOFLAG_INVISIBLE)	// 非表示
	SetChrInfoFlag("ev_eq4028_1", INFOFLAG_INVISIBLE)	// 非表示
	SetChrInfoFlag("ev_eq4028_2", INFOFLAG_INVISIBLE)	// 非表示
	SetChrInfoFlag("ev_eq4028_3", INFOFLAG_INVISIBLE)	// 非表示

	// ポートレート読み込み
	Portrait_Load(0, "system/black.itp" )		//擬似フェードアウト用
	Portrait_Create(0, 0, 0, 0, 0, 64,64, 0.0f, 0x00ffffff, 0x00000000)

	//カメラ設定
	MoveCameraAt( 0 , -933.407f , 674.296f , 48.582f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.540f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 10.292f , 0 )	// 基本仰角
	RotateCamera( 0 , 103.041f , 0 )				// 角度
	ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 3.000, 120.000, 0.000, 0.550, 0.500)					//イベント毎に調整
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300, 1.000, 1.000, 0.600, 0.000, 1.000)	//イベント毎に調整

	//スキップ許可
	SetSkipScript("mp6106m:EV_M05S401_ED")

	//開始処理ここまで-----------------------------------------------

	//　　画面フェードインして操作許可。
	//　　兵士たちがダーナの周囲で眠っている。
	//　　水晶石のＬＰを調べるとフェードアウト挟んで
	//　　苗木を植えた状態を見せる。

	// カット1 ----------------------------------------------------------------------------------------
	
	// 位置調整・表情・モーション
	ChangeAnimation( "DANA" , "ANI_EV_SHAGAMI", -1 , 1 )
	
	// 非表示・再表示
	MapHide("gim_himorogi", 1)		// ヒモロギ苗
	MapAnime("gim_himorogi", "on")		// ヒモロギ苗
	
	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -933.544f , 674.025f , 49.395f, 150 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.222f, 150 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -5.464f , 150 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 171.757f , 150 )

	PlaySE(SE_M05S401_05, 100, 0, 0, 0, 1.0f, 0)
	Wait(30)

	StopBGM(120)

	// フェードイン
	FadeIn(FADE_BLACK, FADE_NORMAL)
	WaitFade()

	Wait(45)	//植えてる時間

	ChangeAnimation( "DANA", "ANI_EV_SHAGAMI_E", -1, 1 )	// しゃがみ終了
	Wait(10)
	LookTo("DANA", -933.954f , 674.488f , 49.135f)	// 座標：ヒモロギ

	// カメラ待ち
	WaitThread(1000)
	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	
	Wait(10)
	
	EarthQuake( 0.02f , 0.02f , 10 )	// 縦揺れ幅, 横揺れ幅, 時間
	
	// 男性の声
	SetName("男性の声")
	TalkPopup(UNDEF, 0, 3, 100, 220, 0) {
		"#18Sこれは一体何事だ！？"
	}
	WaitPrompt()
	WaitCloseWindow()
	SetName("")
	
	//　　ダーナに「！」エモーション表示。
	EmotionEx("DANA", 0.00f, EMO_EX, 0, 5, 1, 1, 1.0f )	// 「！」
	Look("DANA", 15 , 0 )
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKR_S,1)
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SUP_S,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_OPEN_S,1)
	Wait(40)

	// フェードアウト
	FadeOut(FADE_BLACK, FADE_FAST)
	WaitFade()
	
	//	衛兵たちが走ってくる足音

	PlayBGM(BGM_EVENT_010, 0)

	PlaySE(SE_M05S401_06, 60, 0, 0, 0, 1.0f, 0)
	Wait(60)

	// カット2（0506改訂版） ----------------------------------------------------------------------------------------
	
	//　　振り向くと眠らせた衛士二人とは別に
	//　　さらに三人ほどの衛士たちが駆けつけてくる。
	
	// カメラ
	MoveCameraAt( 0 , -932.836f , 673.014f , 49.034f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.542f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -0.189f , 0 )	// 基本仰角
	RotateCamera( 0 , 229.272f , 0 )				// 角度
	ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 非表示・再表示
	ResetChrInfoFlag("soldierC", INFOFLAG_INVISIBLE)	// 再表示
	ResetChrInfoFlag("soldierD", INFOFLAG_INVISIBLE)	// 再表示
	ResetChrInfoFlag("soldierE", INFOFLAG_INVISIBLE)	// 再表示
	ResetChrInfoFlag("eq4029", INFOFLAG_INVISIBLE)	// 再表示
	ResetChrInfoFlag("ev_eq4028_1", INFOFLAG_INVISIBLE)	// 非表示
	ResetChrInfoFlag("ev_eq4028_2", INFOFLAG_INVISIBLE)	// 非表示
	ResetChrInfoFlag("ev_eq4028_3", INFOFLAG_INVISIBLE)	// 非表示

	// 位置調整・表情・モーション
	SetChrPos("DANA", -933.39f, 673.74f, 48.03f)
	Turn("DANA", -53.01f, 360.0f)
	LookChr("soldierC", "DANA")
	LookChr("soldierD", "DANA")
	LookChr("soldierE", "DANA")
	LookReset("DANA")
	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_WAIT, 1)	// 目
	ChangeSubAnimation("DANA", SUBMOT_MOUTH, ANI_M_WAIT, 1)	// 口
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)

	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -933.023f , 672.839f , 49.134f , 70 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 3.062f , 70 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -2.481f , 70 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 246.745f , 70 )

	// フェードイン
	FadeIn(FADE_BLACK, FADE_NORMAL)
	WaitFade()

	// カメラ待ち
	WaitThread(1000)
	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)

	// 衛士C
	TalkPopup("soldierC", 0, 2, 0, 0, 0) {
		"#070e#000mあ、あなたは大樹の巫女様！？"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "soldierD", "ANI_EV_TEBURI", -1, 1 )	// 手振り

	// 衛士D
	TalkPopup("soldierD", 0, 2, 0, 0, 0) {
		"#000e#000m一体どうして王家の谷へ……"
		"それに何故このようなことを！？"
	}
	WaitPrompt()
	WaitCloseWindow()

	// 衛士E
	TalkPopup("soldierE", 0, 2, 0, 0, 0) {
		"#031e#000m返答次第によっては"
		"いくら貴女とは言え……"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　包囲の輪を狭めようとする衛士たち。

	// 移動
	ExecuteCmd(1, MoveTo, "soldierC", -930.36f, 672.25f, 47.24f, 0.1f, 0.195f)
	Wait(5)
	ExecuteCmd(2, MoveTo, "soldierD", -931.96f, 670.79f, 47.24f, 0.1f, 0.195f)

	WaitThread(1)
	WaitThread(2)
	Wait(20)

	// カット3 ----------------------------------------------------------------------------------------
	
	// クロスフェード
	CrossFade(FADE_CROSS)
	
	// カメラ
	MoveCameraAt( 0 , -933.161f , 673.464f , 49.534f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.382f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -1.333f , 0 )	// 基本仰角
	RotateCamera( 0 , 86.147f , 0 )				// 角度
	ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_WAIT, 1)	// 目

	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -933.161f , 673.464f , 49.534f , 300 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 1.382f , 300 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -1.905f , 300 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 100.462f , 300 )

	Wait(FADE_CROSS)

	ChangeAnimation( "DANA", "ANI_EV_TEMUNE_S", -1, 1 )	// 手胸当て

	// ダーナ
	TalkPopup("DANA", 0, 1, 0, 0, 0) {
		"#011e……やっぱり一筋縄では"
		"いかないみたいだね。\p"
		"#012e#020l#000mここは一旦退くしかないかな……"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	// カット4 ----------------------------------------------------------------------------------------

	//　　過去編の遷移エフェクト表示して画面ホワイトアウト。
	//　　過去編へ再度切り替えた場合は兵士たちが門の前に集まり、
	//　　眠らされた衛士の介抱と警戒をしているような状態。
	//　　ダーナは少し距離のある崖下で様子を窺っているような
	//　　状況から再スタートなどの処理が必要。

	// クロスフェード
	CrossFade(FADE_NORMAL)

	// カメラ停止
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	
	// カメラ
	MoveCameraAt( 0 , -932.014f , 677.456f , 49.602f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.822f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 3.538f , 0 )	// 基本仰角
	RotateCamera( 0 , 80.411f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -932.074f , 677.475f , 52.722f , 270 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 3.302f , 270 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -24.825f , 270 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 141.726f , 270 )

	Wait(30)

	// ▼転移のエフェクト ------------------------
	Effect2(3900570, -933.712f , 678.810f , 48.542f, 0.0f, 0, 0, IMPACT_NONE, KNOCK_EFXPOS, 0, 1.7f, 1.0f)	// 過去に飛ぶ時の画面切り替えエフェクト
	PlaySE(SE_M05S401_04, 80, 1, 1000, 0, 1.0f, 0)
	Wait(90)
	PlaySE(SE_M05S401_03, 80, 0, 0, 0, 1.0f, 0)
	Wait(60)
	PlaySE(SE_M05S401_03, 80, 0, 0, 0, 1.0f, 0)
	Wait(30)
	// ▲ ----------------------------------------

	StopBGM(120)
	PlaySE(SE_M05S401_01, 100, 0, 0, 0, 1.0f, 0)
	SetEnvSEPlayState(-1, 0)	//環境SE全停止
	StopSE(SE_M05S401_04, 2000)

	// フェードアウト
	FadeOut(FADE_WHITE, FADE_SLOW)
	Wait(30)
	PlaySE(SE_M05S401_03, 70, 0, 0, 0, 1.0f, 0)
	WaitFade()

	Wait(60)
	
	// 擬似フェードアウト表示
	Portrait_Anime(0 ,PR_ANIME_SCALE, 30.0f, 17.0f, 0, 0, 0)
	Portrait_Anime(0 ,PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, 0)

	// フェードイン
	FadeIn(FADE_WHITE, FADE_NORMAL)
	WaitFade()
	
	// フェードアウト
	FadeOut(FADE_BLACK, 0)
	WaitFade()

/*	// カット2（OLD） ----------------------------------------------------------------------------------------
	
	// クロスフェード
	CrossFade(FADE_NORMAL)
	
	// カメラ
	MoveCameraAt( 0 , -933.483f , 674.042f , 49.322f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.580f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -5.749f , 0 )	// 基本仰角
	RotateCamera( 0 , 288.120f , 0 )				// 角度
	ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 位置調整・表情・モーション
	LookReset("DANA")
	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_WAIT, 1)	// 目
	ChangeSubAnimation("DANA", SUBMOT_MOUTH, ANI_M_WAIT, 1)	// 口
	
	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -933.250f , 673.154f , 50.202f , 390 )		// 注視点
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 6.140f , 390 )		// 基本距離
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 14.018f , 390 )		// 基本仰角
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 3.753f , 390 )		// 角度
	ExecuteCmd(1004, ChangeCameraPers, INTERPOLATE_SPHERE , 40.000f , 390 )		// 視野角
	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE , -8.6f , 390 )		// ロール回転

	// フェード待ち
	Wait(FADE_NORMAL)

	PlayBGM(BGM_EVENT_013, 0)

	ChangeAnimation( "DANA", "ANI_EV_PRAY_S", -1, 1 )	// 祈り開始
	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_CLOSE_S, 1)	// 目
	ChrEffect2( "DANA" , 3900600 , "Bone_root", "", 0 , 0 , 0 , 0.0f,0.0f,0, 1.0f, 1.0f)	//オーラ（ループ）
	PlaySE(SE_M05S401_02, 50, 0, 500, 0, 1.0f, 0)
	
	Wait(80)
	//ヒモロギのオーラ
	Effect2( 3900610, -934.026f , 674.404f , 49.275f, 90.00f, 0, 0, IMPACT_NONE, KNOCK_EFXPOS, 0, 7.0f, 1.0f)

	Effect2(3900570, -933.712f , 678.810f , 48.542f, 0.0f, 0, 0, IMPACT_NONE, KNOCK_EFXPOS, 0, 1.7f, 1.0f)	// 過去に飛ぶ時の画面切り替えエフェクト
	PlaySE(SE_M05S401_04, 80, 1, 1000, 0, 1.0f, 0)

//	Wait(180)
	Wait(90)
	PlaySE(SE_M05S401_03, 80, 0, 0, 0, 1.0f, 0)
	Wait(60)
	PlaySE(SE_M05S401_03, 80, 0, 0, 0, 1.0f, 0)
	Wait(30)

	StopBGM(120)
	PlaySE(SE_M05S401_01, 100, 0, 0, 0, 1.0f, 0)
	SetEnvSEPlayState(-1, 0)	//環境SE全停止
	StopSE(SE_M05S401_04, 2000)

	// フェードアウト
	FadeOut(FADE_WHITE, FADE_SLOW)
	Wait(30)
	PlaySE(SE_M05S401_03, 70, 0, 0, 0, 1.0f, 0)
	WaitFade()

	
	Wait(60)
	
	// 擬似フェードアウト表示
	Portrait_Anime(0 ,PR_ANIME_SCALE, 30.0f, 17.0f, 0, 0, 0)
	Portrait_Anime(0 ,PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, 0)

	// フェードイン
	FadeIn(FADE_WHITE, FADE_NORMAL)
	WaitFade()
	
	// フェードアウト
	FadeOut(FADE_BLACK, 0)
	WaitFade()
*/

	//終了処理ここから----------------------------------------------------
	CallFunc("mp6106m:EV_M05S401_ED")
}

function "EV_M05S401_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//過去Ⅴ　終了処理呼び出し
	CallFunc("system:ReturnFrom_EPISODE_5")

	// エフェクト停止
	StopEffect(-1, ALL, 1)

	// ポートレートリリース
	Portrait_Close(-1)
	Portrait_Unload(-1)

	//隠したものを復帰。
	//ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//マップマーカー
	DelMapMarker( SMI_DANA_SYMBOL ,PAGE_MF005, MARKER_EV_M05S401, 0,0)		//メイン：衛士たちに誰何を受ける２

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_DANA")

	//パーティキャラを解放
	//ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	//CallFunc("system:camera_reset")

	//NowLoading 時の Tips 表示をカット
	SetFlag(TF_LOADING_TIPS_OFF, 1)

	LoadArg("map/mp6105/mp6105.arg")
	EventCue("mp6105:EV_M05S410")	// NEXT：[M05S410][王都の谷を目指す]

	ResetStopFlag(STOPFLAG_EVENT)

	//終了処理ここまで----------------------------------------------------

}



//──────────────────────────────
//	【過去クエスト⑤Ｂ：はぐれた娘を発見】
//──────────────────────────────
function "SubEV_Past_05_Quest_B"
{
	//　　上記イベント後、街道の外れにユカが配置される。
	//　　-728.67f	659.37f	41.65f	23.33f付近
	//　　話しかけるとイベント起動。

//開始処理ここから----------------------------------------------------

	CallFunc("system:event_begin")

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("DANA",-729.76f,661.56f,41.83f)
	Turn("DANA",-31.25f,360.0f)
	ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset( "DANA" )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)

	SetChrWork("Yuka", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("Yuka",-728.62f, 660.09f, 41.68f)
	Turn("Yuka",23.33f,360.0f)
	ChangeAnimation( "Yuka" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("Yuka",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("Yuka",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("Yuka",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset( "Yuka" )
	SetChrInfoFlag( "Yuka" , INFOFLAG_NOCHRATARI)

	//BGM設定◆
	//PlayBGM( BGM_FIELD_101 , XX )

	//カメラ設定
	MoveCameraAt( 0 , -729.254f , 660.698f , 43.105f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.319f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 1.164f , 0 )	// 基本仰角
	RotateCamera( 0 , 172.963f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 2.000, 10.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6106m:SubEV_Past_05_Quest_B_ED")

//開始処理ここまで-----------------------------------------------

	//　　ユカは草花に向いて振り返らない。

	LookChr("DANA", "Yuka")

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	ChangeAnimation( "DANA", "ANI_EV_TEBURI", -1, 1 )	// 手振り

	TalkPopup("DANA",0,1,360,160,0)
	{
		"#000e#000mあなたは……もしかして"
		"理法具職人の娘さんでは？"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　ユカに！？エモーション
	EmotionEx("Yuka", 0.00f, EMO_EXQ, 0, 5, 1, 1, 1.0f)	//！？
	Wait(35)
	LookChr( "Yuka", "DANA" )
	TurnToChr( "Yuka", "DANA", 8.0f )

	TalkPopup("Yuka",0,2,0,0,0)
	{
		"#000e#000mわあっ！？\p"
		"びび、びっくりした……"
		"いきなり声をかけないで！"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　ダーナにＰＡエモーション
	EmotionEx("DANA", 0.00f, EMO_PA, 0, 5, 1, 1, 1.0f)	//パッ
	Wait(35)
	ChangeAnimation( "DANA", "ANI_EV_RYOTEMAE_S", -1, 1 )	// 両手 前組み

	TalkPopup("DANA",0,1,360,160,0)
	{
		"#000e#000mそれは薬草ですね？"
	}
	WaitPrompt()
	WaitCloseWindow()

	// うなずきセット
	HeadYes("Yuka" , 1 , 25 )
	TalkPopup("Yuka",0,2,0,0,0)
	{
		"#011e#000mう、うん……"
		"お母さん、ずっと辛そうだから……\p"
		"#012e#000m王都じゃもう、どこの店にも"
		"薬なんて残ってない……\p"
		"でも試しに新作の理法具を使ったら、"
		"街道沿いに少し自生してるって分かって。"
		"自生7行目"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA", "ANI_EV_RYOTEMAE_E", -1, 1 )	// 両手 前組み

	TalkPopup("DANA",0,1,360,160,0)
	{
		"#000e#000mだから一人で……\p"
		"でもどうしてご両親に"
		"話しておかなかったのですか？\p"
		"お父様が心配していましたよ。"
	}
	WaitPrompt()
	WaitCloseWindow()


	ChangeAnimation( "Yuka", "ANI_EV_UDEGUMI_S", -1, 1 )	// 腕組

	TalkPopup("Yuka",0,2,0,0,0)
	{
		"#000e#000mむっ……\p"
		"#011e#000m父さんに心配される筋合いなんてない。\p"
		"#012e#000m毎日遊び歩いてるくせに、"
		"たまに理法具を作ったら一流だし……\p"
		"#011e#000mフン、今まで好き勝手しといて、"
		"調子よすぎ！"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　ダーナに冷や汗エモーション
	EmotionEx("DANA", 0.00f, EMO_TARA, 0, 5, 1, 1, 1.0f)	//冷や汗
	Wait(50)

	TalkPopup("DANA",0,1,360,160,0)
	{
		"#000e#000m#0L（うーん、色々鬱憤があるみたいだね……）"
	}
	WaitPrompt()
	WaitCloseWindow()
	
	ChangeAnimation( "DANA", "ANI_EV_TEBURI", -1, 1 )	// 手振り
	
	TalkPopup("DANA",0,1,360,160,0)
	{
		"とりあえず、薬草を"
		"摘んだら戻りませんか？\p"
		"私も少しなら治療の心得があります。"
		"薬草があれば、お母様を癒せるかもしれません。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "Yuka", "ANI_EV_UDEGUMI_E", -1, 1 )	// 腕組

	TalkPopup("Yuka",0,2,0,0,0)
	{
		"#012e#000mほ、ほんと……！？\p"
		"#011eそういう事なら……"
		"よろしくお願いシマス。"
	}
	WaitPrompt()
	WaitCloseWindow()

//	//　　ペコリと頭を下げるユカ。
//	HeadYes("Yuka" , 1 , 25)
//	Wait(30)

	//　　以下のイベントに接続。
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

//終了処理ここから----------------------------------------------------
	CallFunc("mp6106m:SubEV_Past_05_Quest_B_ED")
}
function "SubEV_Past_05_Quest_B_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
//	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_ALL")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	SetFlag( TF_LOADING_TIPS_OFF, 1 )	//NowLoading 時の Tips 表示をカット
	
	LoadArg("map/mp6113m/mp6113m.arg")
	EventCue("mp6113m:SubEV_Past_05_Quest_C")		// 過去編Ⅴ：【過去クエスト⑤Ｃ：達成イベント】
	
//終了処理ここまで----------------------------------------------------
}


//──────────────────────────────
//	【討伐イベントＢ：竜種と遭遇】
//──────────────────────────────
function "SubEV_Past_05_HuntB_1"
{
	//　　6106m街道の外れに行くとイベント。
	//　　-902.09f	640.24f	30.35f	45.27f付近

//開始処理ここから----------------------------------------------------

	CallFunc("system:event_begin")

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("DANA",-900.10f,640.32f,30.44f)
	Turn("DANA",80.40f,360.0f)
	ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset( "DANA" )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)

	SetChrWork("ev_HuntB_mons", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("ev_HuntB_mons",-936.84f, 631.56f, 33.32f)
	Turn("ev_HuntB_mons",-104.87f,360.0f)
	ChangeAnimation( "ev_HuntB_mons" , "ANI_WAIT", -1 , 1 )
//	ChangeSubAnimation("ev_HuntB_mons",SUBMOT_EYE,ANI_E_WAIT,1)
//	ChangeSubAnimation("ev_HuntB_mons",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("ev_HuntB_mons",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "ev_HuntB_mons" , INFOFLAG_NOCHRATARI)

	//BGM設定◆
	//PlayBGM( BGM_FIELD_101 , XX )

	//カメラ設定
	MoveCameraAt( 0 , -900.691f , 641.080f , 31.690f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.089f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -5.579f , 0 )	// 基本仰角
	RotateCamera( 0 , 314.338f , 0 )				// 角度
	ChangeCameraPers( 0 , 47.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 5.000, 200.000 ,1.000 ,0.700 ,0.600)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6106m:SubEV_Past_05_HuntB_1_ED")

//開始処理ここまで-----------------------------------------------

	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE ,  -900.420f , 640.685f , 31.690f , 80 )
//	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 6.170f  , 80 )
//	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -8.959f , 80 )
//	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 15.198f , 80 )

	//MoveCameraAt( 0 , -900.420f , 640.685f , 31.690f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.089f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -5.579f , 0 )	// 基本仰角
	//RotateCamera( 0 , 314.338f , 0 )				// 角度
	//ChangeCameraPers( 0 , 47.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転
	//// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()


	//　　振動と咆哮がして、大型雑魚が現れる。m1041	◆未入力
	PlaySE(SE_KAKO_3_01, 50, 0, 0, 0, 1.0f, 0)		//
	EarthQuake( 0.018 , 0.023 , 80 )
	Wait(50)

	//　　ダーナに！？エモーション。
	EmotionEx("DANA", 0.00f, EMO_EXQ, 0, 5, 1, 1, 1.0f)	//！？
	ChangeAnimation( "DANA" , "ANI_EV_STWAIT_S", -1 , 1 )
	Wait(50)

	CrossFade(FADE_NORMAL)
	
	MoveCameraAt( 0 , -900.590f , 640.022f , 31.705f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.840f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -7.094f , 0 )	// 基本仰角
	RotateCamera( 0 , 89.703f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -900.603f , 639.882f , 31.945f , 120 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.080f , 120 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -9.099f , 120 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 75.670f , 120 )

	// 移動
	ExecuteCmd(1, MoveTo, "ev_HuntB_mons", -911.98f, 637.72f, 30.88f, 0.1f, 1.0f)
	ExecuteFunc(98 , "mp6106m:se_foot")

	Wait(FADE_NORMAL)

	// 移動待ち
	WaitThread(1)

	// カメラ待ち
	WaitThread(1000)
	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000e#000mこ、この竜種は……！？\p"
		"（水生種の変異体……？"
		"　なんて凶悪な気配！）"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　ダーナ、改めて武器を構える
	ChangeAnimation( "DANA", "ANI_EV_SETARM", -1, 1 )
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_SETARM",  0)

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000e#000m……この街道は、まだ"
		"通る人たちが大勢いるの。\p"
		"悪いけど、倒させてもらうよ！"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　大型雑魚の咆哮演出など
	ChangeAnimation( "ev_HuntB_mons", "ANI_UNI1", -1, 1 )
	EarthQuake( 0.018 , 0.023 , 80 )
	Wait(15)
	PlaySE(SE_KAKO_5_02, 55, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_01, 80, 0, 0, 0, 1.0f, 0)		//咆哮
	Wait(60)


	//　　イベント終了、操作許可
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()
	WaitAnimation2( "ev_HuntB_mons" , -1, 1, "ANI_UNI1",  0)

	//　　※討伐イベントはストッパーなどは掛からない。
	//　　　以降、倒すまではマップ切り替えしても出現するようにする。

//終了処理ここから----------------------------------------------------
	CallFunc("mp6106m:SubEV_Past_05_HuntB_1_ED")
}
function "SubEV_Past_05_HuntB_1_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	// カメラ停止
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)

	StopThread(1)

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
//	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_ALL")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	//フラグ立て
	SetFlag( GF_SUBEV_PAST_05_HUNTB_LOOK, 1 )	// 過去編Ⅴ：【討伐イベントＢ：竜種と遭遇】を見た
 	//マーカー設置

	CallFunc("system:SetMarkerDANA")	//クエスト系マーカー処理
	//SetMapMarker( SMI_SUBEVENT, PAGE_FXXXM, MARKER_SUBEV_PAST05_2,	-922.15f,634.67f,31.69f, 	-922.15f,634.67f,	MARKER_SUBEV_PAST05_2, MN_F_MP6106M,	-1)	// 過去編Ⅴ：出現したモンスターの居場所用

	CallFunc("mp6106m:init")

	//イベント後の再配置
	SetChrPos("LEADER",-900.10f,640.32f,30.44f)
	Turn("LEADER",80.40f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()

	SetChrPos("ev_HuntB_mons" , -100000.00f  , 0.00f ,0.00f )	// 大型雑魚を画面外に移動
	Wait(1)

	//カメラ位置復帰
	MoveCameraAt( 0 , -900.100f , 640.320f , 32.309f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 7.000f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 14.000f , 0 )	// 基本仰角
	RotateCamera( 0 , 104.014f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

//	RestoreCamera(0, 0)		//※上記カメラ位置を指定する場合は不要
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()

//終了処理ここまで----------------------------------------------------
}

function "se_foot"
{
	PlaySE(SE_KAKO_5_02, 30, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_02, 35, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_02, 35, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_02, 40, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_02, 45, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_02, 50, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_02, 55, 0, 0, 0, 1.0f, 0)
	Wait(15)
	PlaySE(SE_KAKO_5_02, 60, 0, 0, 0, 1.0f, 0)
}

//──────────────────────────────
//	【討伐イベントＢ：撃破後】
//──────────────────────────────
function "SubEV_Past_05_HuntB_2"
{
//開始処理ここから----------------------------------------------------

	CallFunc("system:event_begin")

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("DANA",-900.10f,640.32f,30.44f)
	Turn("DANA",80.40f,360.0f)
	ChangeAnimation( "DANA" , "ANI_EV_ZEEWAIT2", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SAD_CLOSE,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset( "DANA" )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)
	SetChrWork( "DANA" , CWK_BATTLEMODE , 1 )

	SetChrWork("ev_HuntB_mons", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("ev_HuntB_mons",-911.99f, 635.73f, 30.82f)
	Turn("ev_HuntB_mons",-111.98f,360.0f)
	ChangeAnimation( "ev_HuntB_mons" , "ANI_WAIT", -1 , 1 )
//	ChangeSubAnimation("ev_HuntB_mons",SUBMOT_EYE,ANI_E_WAIT,1)
//	ChangeSubAnimation("ev_HuntB_mons",SUBMOT_MOUTH,ANI_M_WAIT,1)
//	ChangeSubAnimation("ev_HuntB_mons",SUBMOT_EXT1,ANI_E_LOOKC,1)
	SetChrInfoFlag( "ev_HuntB_mons" , INFOFLAG_NOCHRATARI)

	SetChrPos("HuntB_mons" , -100000.00f  , 0.00f ,0.00f )	// 戦闘に使用した大型雑魚を画面外に移動

	//カメラ設定
	MoveCameraAt( 0 , -910.366f , 636.521f , 32.508f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 11.669f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 15.679f , 0 )	// 基本仰角
	RotateCamera( 0 , 57.302f , 0 )				// 角度
	ChangeCameraPers( 0 , 49.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 12.1f , 0 )				// ロール回転

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 5.000, 200.000 ,1.000 ,0.700 ,0.600)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6106m:SubEV_Past_05_HuntB_2_ED")

//開始処理ここまで-----------------------------------------------

	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -910.063f , 636.989f , 32.160f , 100 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 13.620f , 100 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -4.006f , 100 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 103.793f , 100 )
	ExecuteCmd(1004, RollCamera, INTERPOLATE_SPHERE , 2.5f , 100 )

	//MoveCameraAt( 0 , -910.063f , 636.989f , 32.160f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 13.620f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -4.006f , 0 )	// 基本仰角
	//RotateCamera( 0 , 103.793f , 0 )				// 角度
	//ChangeCameraPers( 0 , 49.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	//RollCamera( 0 , 2.5f , 0 )				// ロール回転
	//// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	FadeIn(FADE_BLACK,FADE_NORMAL)

	//　　再配置し、大型雑魚が倒れる演出。
	ChangeAnimation( "ev_HuntB_mons", "ANI_DEAD", -1, 1 )
	PlaySE(SE_KAKO_5_03, 100, 0, 0, 0, 1.0f, 0)
	Wait(70)
	PlaySE(SE_KAKO_5_04, 70, 0, 100, 0, 1.0f, 0)
	WaitAnimation2( "ev_HuntB_mons" , -1, 1, "ANI_DEAD",  0)

	StopSE(SE_KAKO_5_04, 500)

	Wait(10)

	//　　疲労して座り込むダーナ。（もしくは疲労待機のまま）
	CrossFade(FADE_NORMAL)
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	
	MoveCameraAt( 0 , -900.896f , 639.739f , 31.653f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.240f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 11.052f , 0 )	// 基本仰角
	RotateCamera( 0 , 319.377f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	Wait(FADE_NORMAL)

	ChangeAnimation( "DANA" , "ANI_EV_ZEEWAIT2_E", -1 , 1 )
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_ZEEWAIT2_E",  0)

	TalkPopup("DANA",0,2,0,0,0)
	{
		"#000mはあ、はあ……"
		"これで少しは安全になるよね……"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　ダーナ、武器をしまってしっかりと立ち
	//　　王家の谷の方を振り向く。
	ChangeAnimation( "DANA" , "ANI_EV_ZEEWAIT_E", -1 , 1 )
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_ZEEWAIT_E",  0)
	ChangeAnimation( "DANA" , "ANI_DISARM", -1 , 1 )
	WaitAnimation2( "DANA" , -1, 1, "ANI_DISARM",  0)

	CrossFade(FADE_CROSS)
	MoveCameraAt( 0 , -901.222f , 640.428f , 31.938f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.870f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -24.356f , 0 )	// 基本仰角
	RotateCamera( 0 , 336.691f , 0 )				// 角度
	ChangeCameraPers( 0 , 57.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	Wait(FADE_CROSS)

	Look( "DANA" , 20, 20 )

	TalkPopup("DANA",0,2,0,0,0)
	{
		"#000e#000m行こう……"
		"アドルさんたちを導かないと。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　イベント終了、操作許可。
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	PlaySE(SE_QUEST_END, 100, 0, 0, 0, 1.0f, 0)		// クエスト達成	

	//	システムテキスト
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S "
		"#-1W#4Cエタニアクエスト#8C【竜種討伐②】#4Cを達成した！#10W" 
		"#8S"
	}
	Wait(10)
	CallFunc("system:QuestVoice_Success")
	WaitPrompt()
	WaitCloseWindow()

	PlaySE(SE_VIRTUE, 100, 0, 0, 0, 1.0f, 0)	//徳ポイントアップ

	//	システムテキスト
	TalkPopup(UNDEF,0,5,0,0,0)
	{
		"#8S "
		"#-1W#4Cダーナの徳が上昇した。#10W"
		"#8S"
	}
	Wait(10)
	WaitPrompt()
	WaitCloseWindow()


//終了処理ここから----------------------------------------------------
	CallFunc("mp6106m:SubEV_Past_05_HuntB_2_ED")
}
function "SubEV_Past_05_HuntB_2_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
	ResetChrPos((CHRTYPE_MONS | RESET_POS))
//	ResetChrPos((CHRTYPE_MONS | RESET_STATUS))
//	ResetChrPos((CHRTYPE_MONS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_ALL")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	//フラグ立て
	SetFlag( GF_SUBEV_PAST_05_HUNTB_KILL, 1 )	// 過去編Ⅴ：【討伐イベントＢ：撃破後】をクリアした

	SetFlag(GF_VIRTURE_POINT,(FLAG[GF_VIRTURE_POINT] + 5 ))			//徳ポイント加算

	EventCue("system:EV_FloorOpen")			//扉が開く予知を視る キューを入れる

	//マーカー消去
	CallFunc("system:SetMarkerDANA")	//クエスト系マーカー処理
 	//DelMapMarker( SMI_SUBEVENT, PAGE_FXXXM, MARKER_SUBEV_PAST05_2, 0, 0)	// 過去編Ⅴ：出現したモンスターの居場所用

	CallFunc("mp6106m:init")

	//イベント後の再配置
	SetChrPos("LEADER",-900.10f,640.32f,30.44f)
	Turn("LEADER",80.40f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()

	SetChrPos("ev_HuntB_mons" , -100000.00f  , 0.00f ,0.00f )	// 大型雑魚を画面外に移動
	Wait(1)

	//カメラ位置復帰
	//MoveCameraAt( 0 , 0.0f , 0.0f , 0.0f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 0.0f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 0.0f , 0 )		// 基本仰角
	//RotateCamera( 0 , 0.0f , 0 )				// 角度
	//ChangeCameraPers( 0 , 0.0f , 0 )			// 視野角
	//SetCameraZPlane( 0 , 0.0f )					// ZPlane
	//RollCamera( 0 , 0.0f , 0 )					// ロール回転

	RestoreCamera(0, 0)		//※上記カメラ位置を指定する場合は不要
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()

//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【過去編Ⅴ：現代に戻るイベント】
//──────────────────────────────
function "SubEV_Past_05_Return"
{
	//　　再訪時にヒモロギを調べると起動。

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	TurnToChr( LEADER , this , 7.5f )
	Wait(10)

	SetFlag( TF_MENU_SELECT, 0 )
	YesNoMenu(TF_MENU_SELECT,"#7Cヒモロギの木に祈りを捧げますか？",1)
	
	//────────────────────
	//	⇒はい
	if( FLAG[TF_MENU_SELECT] )	// Yesを選んだ
	{
	//開始処理ここから-----------------------------------------------
		ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
	
		CallFunc("system:event_begin_fast")
	
		//イベント開始前情報の保存
		SaveEventState()
		SaveCamera()
	
		//パーティ状態のリセット
		CallFunc("system:party_reset")
	
		//環境の初期化・不要なものを隠す
		ClearDebris()
		//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
		//ResetChrPos((CHRTYPE_NPC | REMOVE_POS))
	
		//キャラ初期状態の設定
		SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
		SetChrPos("DANA", -932.94f, 673.97f, 48.03f)
		Turn("DANA", 112.84f, 360.0f)
		ChangeAnimation("DANA", "ANI_WAIT", -1, 1)
		ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_WAIT, 1)
		ChangeSubAnimation("DANA", SUBMOT_MOUTH, ANI_M_WAIT, 1)
		ChangeSubAnimation("DANA", SUBMOT_EXT1, ANI_E_LOOKC, 1)
		LookReset("DANA")
	
		//BGM設定◆
		//PlayBGM( BGM_FIELD_101 , XX )
	
		//カメラ設定
		MoveCameraAt( 0 , -933.702f , 674.770f , 48.793f , 0 )	// 注視点
		ChangeCameraDistance( 0 , 1.181f , 0 )		// 基本距離
		ChangeCameraElevation( 0 , 7.128f , 0 )	// 基本仰角
		RotateCamera( 0 , 200.740f , 0 )				// 角度
		ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
		SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
		RollCamera( 0 , 0.0f , 0 )				// ロール回転
		// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。
	
		// 被写界深度の設定
		SetDoF(0, LERP_LINEAR, 5.000, 170.000, 2.000, 0.550, 0.500)					//イベント毎に調整
		// グレアの設定
		SetGlare(0, LERP_LINEAR, 0.700, 1.300, 1.000, 1.000, 0.600, 0.000, 1.000)	//イベント毎に調整
	
		// ポートレート読み込み
		Portrait_Load(0, "system/black.itp" )		//擬似フェードアウト用
		Portrait_Create(0, 0, 0, 0, 0, 64,64, 0.0f, 0x00ffffff, 0x00000000)
	
		//スキップ許可
		SetSkipScript("mp6106m:SubEV_Past_05_Return_ED")
	
		//開始処理ここまで-----------------------------------------------
	
		// カメラ移動
		ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -934.034f , 673.962f , 49.913f , 330 )
		ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 1.181f , 330 )
		ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 6.267f , 330 )
		ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 289.543f , 330 )
	
		FadeIn(FADE_BLACK, FADE_NORMAL)
		Wait(FADE_NORMAL)
	
		//	  　ダーナがヒモロギに祈りを捧げ、
		//	  　過去編の遷移エフェクト表示して画面アウト。
	
		ChangeAnimation( "DANA", "ANI_EV_PRAY_S", -1, 1 )	// 祈り開始
		ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_CLOSE_S, 1)	// 目
		ChrEffect2( "DANA" , 3900600 , "Bone_root", "", 0 , 0 , 0 , 0.0f,0.0f,0, 1.0f, 1.0f)	//オーラ（ループ）
		
	//	Wait(80)
	//◆	Effect2( 3900620, -933.959f , 674.442f , 49.244f, 90.00f, 0, 0, IMPACT_NONE, KNOCK_EFXPOS, 0, 1.0f, 1.0f)	// ヒモロギ苗エフェクト
	
		Effect2(3900570, -933.862f , 675.117f , 49.553f, 0.0f, 0, 0, IMPACT_NONE, KNOCK_EFXPOS, 0, 1.7f, 1.0f)	// 過去に飛ぶ時の画面切り替えエフェクト
		PlaySE(SE_GO_KAKO_1, 100, 1, 1500, 0, 1.0f, 0)	//水晶石と交信エフェクトループ	

		//Wait(180)
		Wait(90)
		PlaySE(SE_GO_KAKO_2, 80, 0, 0, 0, 1.0f, 0)	//	発光（過去編ワープ）
		Wait(60)
		PlaySE(SE_GO_KAKO_2, 80, 0, 0, 0, 1.0f, 0)	//	発光（過去編ワープ）
		Wait(30)

		StopBGM(120)
		PlaySE(SE_GO_KAKO_3, 100, 0, 0, 0, 1.0f, 0)	//	ホワイトアウト
		SetEnvSEPlayState(-1, 0)	//環境SE全停止
		StopSE(SE_GO_KAKO_1, 2000)
	
		// フェードアウト
		FadeOut(FADE_WHITE, FADE_SLOW)
		Wait(30)
		PlaySE(SE_GO_KAKO_2, 70, 0, 0, 0, 1.0f, 0)	//	発光（過去編ワープ）
		WaitFade()
		
		Wait(60)
		
		// 擬似フェードアウト表示
		Portrait_Anime(0 ,PR_ANIME_SCALE, 30.0f, 17.0f, 0, 0, 0)
		Portrait_Anime(0 ,PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, 0)
	
		// フェードイン
		FadeIn(FADE_WHITE, FADE_NORMAL)
		WaitFade()
		
		// フェードアウト
		FadeOut(FADE_BLACK, 0)
		WaitFade()
	
		//	  　※ここで、過去編で入手したアイテムの入手処理を行う。
		//	  　現代編の水晶石の前に復帰して操作許可を戻す。	
	
	//終了処理ここから----------------------------------------------------
		CallFunc("mp6106m:SubEV_Past_05_Return_ED")
	}
	//	⇒いいえ
	else
	{
		//	  　そのまま操作許可を戻す
	
	//終了処理ここから----------------------------------------------------
		CrossFade(FADE_CROSS)
		SetStopFlag(STOPFLAG_NOCHARACLIP)
	
		//イベント後の再配置
		//SetChrPos("LEADER",0.00f,0.00f,0.00f)
		//Turn("LEADER",0.00f,360.0f)
		ResetPartyPos()
		ResetFollowPoint()
		//Wait(1) //処理待ち用
	
		RestoreCamera(0,0)
		ResetCameraObserver(0)
		ResetCameraZPlane()
		//WaitFade()
		Wait(FADE_CROSS)
	
		ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
	//終了処理ここまで----------------------------------------------------
	}
	//────────────────────
}
function "SubEV_Past_05_Return_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	// カメラ停止
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//過去Ⅴ　終了処理呼び出し
	CallFunc("system:ReturnFrom_EPISODE_5")

	//エフェクトの停止
	StopEffect(-1,ALL,1)

	//エフェクトリリース
	ReleaseEffect("efx_ev04.ite")

	// ポートレートリリース
	Portrait_Close(-1)
	Portrait_Unload(-1)

	//隠したものを復帰。
	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_DANA")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	CallFunc("system:camera_reset")

	//NowLoading 時の Tips 表示をカット
	SetFlag( TF_LOADING_TIPS_OFF, 1 )

	LoadArg("map/mp6105/mp6105.arg")
	EventCue("mp6105:SubEV_Past_05_Return_Relocate")

	//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//【過去編Ⅴ：水晶石を調べて再訪する】（続き）
//──────────────────────────────
function "SubEV_Past_05_Rearrive2"
{
//開始処理ここから----------------------------------------------------

	CallFunc("system:event_begin_fast")

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//過去Ⅴ　開始処理呼び出し
	CallFunc("system:BackTo_EPISODE_5")

	CallFunc("fxxxm:init")	//ヒモロギ表示用

	//キャラ初期状態の設定
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("DANA", -886.10f, 658.18f, 30.90f)
	Turn("DANA", -18.62f, 360.0f)
	ChangeAnimation( "DANA", "ANI_WAIT", -1, 1 )	// 待機
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_S,1)	
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("DANA")
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)

	//BGM設定◆
	//PlayBGM( BGM_FIELD_101 , XX )

	//カメラ設定
	MoveCameraAt( 0 , -910.752f , 654.040f , 54.018f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 20.900f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 7.331f , 0 )	// 基本仰角
	RotateCamera( 0 , 57.560f , 0 )				// 角度
	ChangeCameraPers( 0 , 70.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 5.000, 150.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6106m:SubEV_Past_05_Rearrive2_ED")

//開始処理ここまで-----------------------------------------------

	//　　対応する過去編の、終点にあるヒモロギ前にフェードイン。
	//　　ダーナが祈りを捧げている状態。

	Look("DANA", 0.0f, -10.0f)	// うつむく

	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , -885.260f , 655.383f , 32.686f , 150 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 5.300f, 150 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , -4.987f , 150 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 75.608f , 150 )
	
	FadeIn(FADE_BLACK, FADE_NORMAL)
	WaitFade()


	// カメラ待ち
	WaitThread(1000)
	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)

	// クロスフェード
	CrossFade(FADE_NORMAL)

	MoveCameraAt( 0 , -885.973f , 657.896f , 32.366f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.220f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 10.481f , 0 )	// 基本仰角
	RotateCamera( 0 , 59.558f , 0 )				// 角度
	ChangeCameraPers( 0 , 40.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。


	LookSpd("DANA", 0.08f, 0.08f, 0.08f )// ゆっくりめに首向き
	Look("DANA", 0.0f, 0.0f)	// うつむく
	Wait(10)
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_E,1)	

	Wait(30)

	//　　暗転を挟んで過去編ダーナに操作許可を戻す。
	FadeOut(FADE_BLACK, FADE_FAST)
	WaitFade()

	if(!FLAG[GF_1ST_REARRIVE])
	{
		// チュートリアルポートレート読み込み
		Portrait_Load(0, "system/black.itp" )		//擬似フェードアウト用
		Portrait_Create(0, 0, 0, 0, 0, 64,64, 0.0f, 0x00ffffff, 0x00000000)
		Portrait_Load(1, "visual/help/hp_00.itp" )	// 背景用
		Portrait_Create(1, HELP_POS_X, HELP_POS_Y, 0, 0, HELP_SCALE_X, HELP_SCALE_Y, 0.0f, 0x00ffffff, 0x00000000)
		Portrait_Load(2, "visual/help/hp_a44b.itp" )	// help_a44b：意識交代
		Portrait_Create(2, HELP_POS_X, HELP_POS_Y, 0, 0, HELP_SCALE_X, HELP_SCALE_Y, 0.0f, 0x00ffffff, 0x00000000)

		// チュートリアル =================================================================================
		if ( !FLAG[SF_2NDSTART] ) {		// 2周目判定
			
			//自動送り禁止
			ResetStopFlag(STOPFLAG_AUTOMESSAGE)
			Wait(10)

			// 擬似フェードアウト表示
			Portrait_Anime(0 ,PR_ANIME_SCALE, 30.0f, 17.0f, 0, 0, 0)
			Portrait_Anime(0 ,PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, 0)
			FadeIn(FADE_BLACK, 0)
			WaitFade()

			// ポートレート表示
				PlaySE(SE_TUTORIAL, 100, 0, 0, 0, 1.0f, 0)		//チュートリアル
			Portrait_Anime(1, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, FADE_NORMAL)	// チュートリアル背景
			Portrait_Anime(2, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, FADE_NORMAL)
			Wait(FADE_NORMAL)
			Message2(1, TOPIC_BUTTUN_X, TOPIC_BUTTUN_Y, "", "", "", "", "", "", "", "", "", "")		//ボタン入力可能を提示
			WaitPrompt()
			Portrait_Anime(1, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 0.0f, FADE_FAST)	// チュートリアル背景
			Portrait_Anime(2, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 0.0f, FADE_FAST)
			Wait(FADE_FAST)
			Portrait_Close(1)
			Portrait_Close(2)
			
			// 擬似フェードアウト削除
			FadeOut(FADE_BLACK, 0)
			WaitFade()
			Portrait_Close(0)

			//自動送り許可
			SetStopFlag(STOPFLAG_AUTOMESSAGE)
		
		}
		// ================================================================================================
	}

//終了処理ここから----------------------------------------------------
	CallFunc("mp6106m:SubEV_Past_05_Rearrive2_ED")
}
function "SubEV_Past_05_Rearrive2_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
//	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_ALL")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	//フラグ立て
	if(!FLAG[GF_1ST_REARRIVE])
	{
		// ポートレートリリース 	2018.04.25 m.arai
		Portrait_Close(-1)
		Portrait_Unload(-1)

		SetFlag(GF_1ST_REARRIVE,1)		//始めて過去編再訪した
	}
	CallFunc("mp6106m:init")

	//イベント後の再配置
	SetChrPos("LEADER",-886.10f, 658.18f, 30.90f)
	Turn("LEADER",-50.60f, 360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	//カメラ位置復帰
	//MoveCameraAt( 0 , 0.0f , 0.0f , 0.0f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 0.0f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 0.0f , 0 )		// 基本仰角
	//RotateCamera( 0 , 0.0f , 0 )				// 角度
	//ChangeCameraPers( 0 , 0.0f , 0 )			// 視野角
	//SetCameraZPlane( 0 , 0.0f )					// ZPlane
	//RollCamera( 0 , 0.0f , 0 )					// ロール回転

	RestoreCamera(0, 0)		//※上記カメラ位置を指定する場合は不要
	CallFunc("system:camera_reset")

	VisualName("visual/portrait/ep_0150.itp",VN_NAMEMAP,-1,-1,VN_MAPNAME_TIME)	//過去Ⅴ

	ResetStopFlag(STOPFLAG_EVENT)

	FadeIn(FADE_BLACK, FADE_FAST)
	//WaitFade()

//終了処理ここまで----------------------------------------------------
}

function "SubEV_Past_SpiritH"
{
	//開始処理ここから-----------------------------------------------

	CallFunc("system:event_begin")


	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定				
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("DANA", INFOFLAG_NOCHRATARI)
	SetChrPos("DANA",-989.41f,634.38f,34.54f)
	Turn("DANA",165.71f,360.0f)
	ChangeAnimation("DANA", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_WAIT, 1)
	ChangeSubAnimation("DANA", SUBMOT_MOUTH, ANI_M_WAIT, 1)
	ChangeSubAnimation("DANA", SUBMOT_EXT1, ANI_E_LOOKC, 1)
	ChangeSubAnimation("DANA",SUBMOT_EXT2,ANI_SIGN_HIDE,1)

	// チュートリアルポートレート読み込み
	Portrait_Load(0, "system/black.itp" )		//擬似フェードアウト用
	Portrait_Create(0, 0, 0, 0, 0, 64,64, 0.0f, 0x00ffffff, 0x00000000)
	Portrait_Load(1, "visual/help/hp_00.itp" )	// 背景用
	Portrait_Create(1, HELP_POS_X, HELP_POS_Y, 0, 0, HELP_SCALE_X, HELP_SCALE_Y, 0.0f, 0x00ffffff, 0x00000000)
	Portrait_Load(2, "visual/help/hp_b27.itp" )	// help_b27：グラティカ強化
	Portrait_Create(2, HELP_POS_X, HELP_POS_Y, 0, 0, HELP_SCALE_X, HELP_SCALE_Y, 0.0f, 0x00ffffff, 0x00000000)

	//カメラ設定
	MoveCameraAt( 0 , -989.766f , 635.478f , 35.832f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.929f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -1.564f , 0 )	// 基本仰角
	RotateCamera( 0 , 335.903f , 0 )				// 角度
	ChangeCameraPers( 0 , 51.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 3.000, 70.000, 2.000, 0.950, 0.500)					//イベント毎に調整
	SetDoFFocus(0,0,0)
	
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300, 1.000, 1.000, 0.600, 0.000, 1.000)	//イベント毎に調整

	//スキップ許可
	SetSkipScript("mp6106m:SubEV_Past_SpiritH_ED")

	//開始処理ここまで-----------------------------------------------

	FadeBGM(70,30)
	PlaySE(SE_SPIRIT_SAVE_01, 80, 1, 500, 0, 1.0f, 0)

	FadeIn(FADE_BLACK, FADE_FAST)
	WaitFade()

	//──────────────────────────────
	//	【PS4】【精霊救出Ｆ：渦から精霊を救出する】
	//──────────────────────────────
	//　　寺院の廊下に光る渦がある。
	//　　49.96f	37.02f	-0.00f	36.74f付近
	//　　調べるとイベント起動。

	//選択肢
	SetFlag(TF_MENU_SELECT,0)
	MenuReset()
	MenuType(MENUTYPE_POPUP)
	MenuAdd(1,"淀みを開放する")
	MenuAdd(2,"やめておく")
	MenuOpen( TF_MENU_SELECT , -1 , ADOLMENU_PPOSY , -2 , -2 , 10 , 1)
	WaitMenu(0)
	MenuClose(10,0)

	//────────────────────
	//	⇒淀みを開放する
	//　　下の流れに接続。
	//	⇒やめておく
	//　　操作許可を戻す。
	//────────────────────
	
	if(FLAG[TF_MENU_SELECT] == 1)
	{
		//精霊飛び出す演出
		ChangeAnimation( "DANA" , "ANI_EV_SPIRIT_S", -1 , 1 )
		Wait(15)
		PlaySE(SE_SPIRIT_SAVE_02, 60, 1, 500, 0, 1.0f, 0)
		WaitAnimation2( "DANA" , -1, 1, "ANI_EV_SPIRIT_S",  0)

		ChangeAnimation( "DANA" , "ANI_EV_SPIRIT_E", -1 , 1 )
		StopEffect(106720,ALL,1)
		StopSE(SE_SPIRIT_SAVE_02, 3000)

		CrossFade(15)
		ChangeAnimation( "SubEV_Past_SpiritH" , "ANI_RELEASE", -1 , 1 )
		Wait(90)
		StopSE(SE_SPIRIT_SAVE_01, 1000)
		PlaySE(SE_SPIRIT_SAVE_03, 100, 0, 0, 0, 1.0f, 0)
		
		WaitAnimation2( "SubEV_Past_SpiritH" , -1, 1, "ANI_RELEASE",  0)

		Wait(15)
		SetChrPos("Orivis",-989.96f,636.61f,34.42f)
		ChangeAnimation( "Orivis" , "ANI_EV_ESCAPE", -1 , 1 )
		Blur(BLUR_TYPE_EXPAND, 0.4f , 10)
		EarthQuake(0.15, 0.15 , 10)
		PlaySE(SE_SPIRIT_SAVE_04, 80, 0, 0, 0, 1.0f, 0)
		Wait(7)
		ChangeAnimation( "DANA" , "ANI_EV_SUP_S", -1 , 1 )
		Wait(60)

		ChangeAnimation( "DANA" , "ANI_EV_SUP_E", -1 , 1 )

		//　　ダーナは指先に理力を纏わせて、光る渦にそっと触れる。
		//　　すると光る渦ははじけて消滅し、
		//　　中から小さな精霊が現れる。
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000mよかった、無事みたいだね。"
		}
		WaitPrompt()
		WaitCloseWindow()

		//	精霊
		SetName("精霊")
		TalkPopup("Orivis",0,2,0,0,0)
		{
			"ハァ……ハァ……"
			"再び外へ出られるとはな……！\p"
			"だが私は一体……"
			"これからどうすれば……"
		}
		WaitPrompt()
		WaitCloseWindow()
		SetName("")
		
		ChangeAnimation( "DANA" , "ANI_EV_UDEGUMI_S", -1 , 1 )

		//	"DANA"
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000mもしかして精霊のあなた達なら"
			"何か知っているのかな？\p"
			"エタニアに……この世界に"
			"一体何が起こっているのかを。"
		}
		WaitPrompt()
		WaitCloseWindow()

		//	精霊
		SetName("精霊")
		TalkPopup("Orivis",0,2,0,0,0)
		{
			"眷属の気配……"
			"貴女は大樹の巫女とやらか。\p"
			"私は南限の山脈に住まう白夜の精霊。"
			"名をオリヴィスと言う。"
		}
		WaitPrompt()
		WaitCloseWindow()
		SetName("")
		
		//	"DANA"
		TalkPopup("DANA",0,1,0,0,0)
		{
			"#000e#000m私はダーナ。\p"
			"南限の山脈……聞いた事あるかな。\p"
			"南限の山脈2行目"
			"私の故郷よりさらに南──"
			"大陸の果つる地に大山脈があるって。\p"
			"でも、どうしてこんな場所へ……？"
		}
		WaitPrompt()
		WaitCloseWindow()

		//	白夜の精霊オリヴィス
		TalkPopup("Orivis",0,2,0,0,0)
		{
			"それが……判らんのだ。\p"
			"あの凄まじい地脈の乱れの後、"
			"私の友人たちは次々に消滅していった。\p"
			"私は……私には何も出来なかった。"
			"ただ見ている事しかな……\p"
			"だが気づけば、この地にいたのだ……"
			"なぜ故郷を捨て置いて一人だけ……\p"
			"私はいま恐怖している……"
			"何が起きようとしているのか……"
		}
		WaitPrompt()
		WaitCloseWindow()

		CrossFade(FADE_CROSS)
		MoveCameraAt( 0 , -989.538f , 634.665f , 36.006f , 0 )	// 注視点
		ChangeCameraDistance( 0 , 1.530f , 0 )		// 基本距離
		ChangeCameraElevation( 0 , 5.825f , 0 )	// 基本仰角
		RotateCamera( 0 , 218.934f , 0 )				// 角度
		ChangeCameraPers( 0 , 46.000f , 0 )			// 視野角
		SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
		RollCamera( 0 , 0.0f , 0 )				// ロール回転
		// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

		Wait(FADE_CROSS)

		//	"DANA"
		TalkPopup("DANA",0,2,0,0,0)
		{
			"#000e#000m（精霊が消え始めている？"
			"　どうしてまた……）"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		TalkPopup("DANA",0,2,0,0,0)
		{
			"#0L#011e#000m………………………………"
		}
		WaitPrompt()
		WaitCloseWindow()

		CrossFade(FADE_CROSS)
		MoveCameraAt( 0 , -989.806f , 635.615f , 35.708f , 0 )	// 注視点
		ChangeCameraDistance( 0 , 3.301f , 0 )		// 基本距離
		ChangeCameraElevation( 0 , 3.645f , 0 )	// 基本仰角
		RotateCamera( 0 , 164.101f , 0 )				// 角度
		ChangeCameraPers( 0 , 46.000f , 0 )			// 視野角
		SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
		RollCamera( 0 , 0.0f , 0 )				// ロール回転
		// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

		Wait(FADE_CROSS)

		ChangeAnimation( "DANA" , "ANI_EV_UDEGUMI_E", -1 , 1 )
		ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_E,1)

		//	白夜の精霊オリヴィス
		TalkPopup("Orivis",0,1,0,0,0)
		{
			"ああ……すまない。"
			"礼を言うのを忘れていたな。\p"
			"もはや大した力もないが、"
			"どうか我が加護を受けとってくれ。\p"
			"南天を頂#2Rいただ#Rきし我が故郷、"
			"大山脈の加護だ。"
		}
		WaitPrompt()
		WaitCloseWindow()

		WaitAnimation2( "DANA" , -1, 1, "ANI_EV_UDEGUMI_E",  0)

		//　　精霊からエフェクトが放たれ
		//　　ダーナに吸い込まれていく。
		ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_S,1)
		ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_S", -1 , 1 )

		//力を授かるエフェクト
		PlaySE(SE_SPIRIT_SAVE_05, 70, 1, 1000, 0, 1.0f, 0)
		ChrEffect2( "Orivis" , 106640 , "effect_base","" , 0 , IMPACT_NONE , KNOCK_EFXPOS , 0.0f,0.0f,0, 1.0f, 1.0f)
		Wait(20)
		StopEffect(106640,ALL,1)

		ChrEffect("DANA", 106660, 0.0f , -0.13f , 1.37f, 0, 0, 0 , 0, 1.0f, 0.0f, 0, 1.0f, 1.0f)		//力授かり
		Wait(45)
		StopSE(SE_SPIRIT_SAVE_05, 2000)
		StopEffect(106660,ALL,1)
		Wait(65)

		//	力が宿る
		FadeBGM(25,30)	
		PlaySE( SE_GET_THE_BOX03 , 100 , 0,  0, 0, 1.0f, 0)		//ITEMMSG_SE_JINGLE

		Message("#-1W#4Cダーナに#3C白夜の精霊オリヴィス#4Cの力が宿った。#10W")		//（※「息吹の精霊ジンヤ」を色換えしたい）
		Wait(60)
		WaitPrompt()
		WaitCloseWindow()

		PlaySE( SE_HEAL , 100 , 0,  0, 0, 1.0f, 0)
		Message("#-1W#4Cダーナの#3C【グラティカ】#4Cスタイルが強化された。#10W")
		WaitPrompt()
		WaitCloseWindow()

		GetItemMessageExPlus(ICON3D_EARTHSTYLE2, 1 , ITEMMSG_SE_NONE, "を手に入れた！", 1, 1)
		WaitPrompt()
		WaitCloseWindow()

		FadeBGM(70,30)
		
		Wait(15)

		//	チュートリアル画像：【グラティカ】スタイルの強化
		// チュートリアル =================================================================================
		if ( !FLAG[SF_2NDSTART] ) {		// 2周目判定
			
			//自動送り禁止
			ResetStopFlag(STOPFLAG_AUTOMESSAGE)
			Wait(10)

			// 擬似ハーフフェードアウト表示
			Portrait_Anime(0 ,PR_ANIME_SCALE, 30.0f, 17.0f, 0, 0, 0)
			Portrait_Anime(0 ,PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 0.7f, FADE_FAST)
			Wait(FADE_FAST)

			// ポートレート表示
			PlaySE(SE_TUTORIAL, 100, 0, 0, 0, 1.0f, 0)		//チュートリアル
			Portrait_Anime(1, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, FADE_NORMAL)	// チュートリアル背景
			Portrait_Anime(2, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 1.0f, FADE_NORMAL)
			Wait(FADE_NORMAL)
			Message2(1, TOPIC_BUTTUN_X, TOPIC_BUTTUN_Y, "", "", "", "", "", "", "", "", "", "")		//ボタン入力可能を提示
			WaitPrompt()
			Portrait_Anime(1, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 0.0f, FADE_FAST)	// チュートリアル背景
			Portrait_Anime(2, PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 0.0f, FADE_FAST)
			Wait(FADE_FAST)
			Portrait_Close(1)
			Portrait_Close(2)
			
			// 擬似フェードアウト削除
			Portrait_Anime(0 ,PR_ANIME_COLOR, 1.0f, 1.0f, 1.0f, 0.0f, FADE_FAST)
			Wait(FADE_FAST)
			Portrait_Close(0)

			//自動送り許可
			SetStopFlag(STOPFLAG_AUTOMESSAGE)
		
		}
		// ================================================================================================

		ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SMILE_CLOSE_E,1)
		ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_E", -1 , 1 )

		TalkPopup("DANA",0,2,0,0,0)
		{
			"#080mありがとう、オリヴィス。"
		}
		WaitPrompt()
		WaitCloseWindow()

		//	白夜の精霊オリヴィス
		TalkPopup("Orivis",0,1,0,0,0)
		{
			"いや……大して"
			"役に立てず済まなかったな。\p"
			"私は友人たちを探したい。"
			"せめて私が正気でいる間はな……\p"
			"ではな、巫女殿。"
			"貴女も達者でな……"
		}
		WaitPrompt()
		WaitCloseWindow()

		//　　精霊はフェードしながら去ってしまう。
		ChangeAnimation( "Orivis" , "ANI_EV_LEAVE", -1 , 1 )
		
		Wait(30)
		PlaySE(SE_SPIRIT_SAVE_07, 80, 0, 0, 0, 1.0f, 0)
		Wait(30)
		
		Look("DANA" , 0 ,13)
		
		Wait(25)

		TalkPopup("DANA",0,2,0,0,0)
		{
			"#011e#000mこの状況が精霊にも影響しているのは"
			"間違いないみたいだね……"
		}
		WaitPrompt()
		WaitCloseWindow()

		LookReset("DANA")

		//　　ダーナ、首を振る
		TalkPopup("DANA",0,2,0,0,0)
		{
			"#012e#000m気になるけど……そろそろ行こう。"
			"今はできることをやらないと。"
		}
		WaitPrompt()
		WaitCloseWindow()

		//　　暗転。
		FadeOut(FADE_BLACK,FADE_NORMAL)
		WaitFade()

		//　　画面暗転。
		PlaySE(SE_QUEST_END, 100, 0, 0, 0, 1.0f, 0)		// クエスト達成	

		//	システムテキスト
		TalkPopup(UNDEF,0,5,0,0,0)
		{
			"#8S "
			"#-1W#4C白夜の精霊オリヴィスを救出した！#10W" 
			"#8S"
		}
		Wait(10)
		CallFunc("system:QuestVoice_Success")
		WaitPrompt()
		WaitCloseWindow()

		PlaySE(SE_VIRTUE, 100, 0, 0, 0, 1.0f, 0)	//徳ポイントアップ

		//	システムテキスト
		TalkPopup(UNDEF,0,5,0,0,0)
		{
			"#8S"
			"#-1W#4Cダーナの徳が上昇した。#10W"
			"#8S"
		}
		Wait(10)
		WaitPrompt()
		WaitCloseWindow()

		//　　徳ポイントを+5する。
		//　　
		//　　イベント終了、操作許可を戻す。
		//──────────────────────────────
	}

	StopSE(SE_SPIRIT_SAVE_01, 1000)

	// フェードアウト
	FadeOut(FADE_BLACK, FADE_FAST)
	WaitFade()

	//終了処理ここから----------------------------------------------------
	CallFunc("mp6106m:SubEV_Past_SpiritH_ED")
}

function "SubEV_Past_SpiritH_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_DANA")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	SetChrPos("Orivis",-100000.00f,0.00f,0.00f)

	// ポートレートリリース
	Portrait_Close(-1)
	Portrait_Unload(-1)
	
	if(FLAG[TF_MENU_SELECT] == 1)
	{

		//フラグ処理
		SetFlag(GF_SUBEV_PAST_SPIRITH, 1)	// 過去編Ⅴ：【精霊救出Ｈ：渦から精霊を救出する】を見た
		SetFlag(GF_TROPHY_ETERNIASPIRIT_08,1)		//精霊救出率カウント
		SetFlag(GF_VIRTURE_POINT,(FLAG[GF_VIRTURE_POINT] + 5 ))			//徳ポイント加算

		SetFlag(SF_DANA_EARTHSTYLE_LV,1)			// グラティカのスタイル強化

		GetItem(ICON3D_EARTHSTYLE2,1)		//轟岩の碌印

		SetFlag(GF_HELP_B27,1)		//グラティカ強化

		CallFunc("system:Get_DanaSpirit")		//「全てのエタニアの精霊を救出した。」トロフィー判定用
		EventCue("system:EV_FloorOpen")			//扉が開く予知を視る キューを入れる

		CallFunc("system:SetMarkerDANA")	//クエスト系マーカー処理

		CallFunc("mp6106m:init")
	}

	//イベント後の再配置
	SetChrPos("LEADER",-986.68f,632.06f,34.45f)
	Turn("LEADER",-58.05f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	//カメラ位置復帰
	MoveCameraAt( 0 , -986.680f , 632.058f , 36.302f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 7.000f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 9.077f , 0 )	// 基本仰角
	RotateCamera( 0 , 73.596f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.100f , 1200.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	FadeIn(FADE_BLACK, FADE_FAST)
	//WaitFade()

	//終了処理ここまで----------------------------------------------------

}



////////////////////////////////////////////////////////////////////////////////

//■ストッパー・ＬＰセクション

////////////////////////////////////////////////////////////////////////////////
//──────────────────────────────
//	【ストッパー：西街道分岐→寺院方面へ行けない】
//──────────────────────────────
function "Stopper_Past_05_02"
{
	//	mp6106m1	-727.70f	684.46f	42.81f	-111.07f付近

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	//▼過去編Ⅴ王家の谷へ向かう
	TalkPopup("LEADER",0,0,0,0,0)
	{
		"#000e#000m（この先を行くと大樹の寺院だけど……"
		"　戻っている場合じゃないよね。）"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-729.57f,683.66f,42.76f)
	Turn("LEADER",65.50f,360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ストッパー：西街道のストッパー】
//──────────────────────────────
function "Stopper_Past_05_03"
{

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	//▼過去編Ⅴ王家の谷へ向かう
	TalkPopup("LEADER",0,0,0,0,0)
	{
		"#000e#000m（王家の谷はこっちじゃない……）\p"
		"（さっきの分かれ道を北に向かおう。）"
		"道3行目"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-1001.61f,627.26f,34.37f)
	Turn("LEADER",-95.99f,360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ストッパー：王家の谷の門のストッパー】
//──────────────────────────────
function "Stopper_Past_05_04"
{

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	//▼過去編Ⅴ王家の谷へ向かう
	if( !FLAG[TF_STOPER_PAST_05_04] )
	{
		TalkPopup("LEADER",0,0,0,0,0)
		{
			"#000e#000m（この先が王家の谷……でも先に"
			"　アドルさんたちを導いておかないと。）\p"
			"（何となくだけど、分かってきた……）\p"
			"（未来の彼らを導かない限り、"
			"　私は答えに辿りつけない気がする……）"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		SetFlag( TF_STOPER_PAST_05_04, 1 )
	}
	else
	{
		//　　★繰り返し
		//　　※カメラ切り替えなし
		TalkPopup("PLAYER1",0,0,0,0,0)
		{
			"#000e#000m（王家の谷に入る前に"
			"　アドルさんたちを導こう。）\p"
			"（……ヒモロギに祈りを捧げよう。"
			"　できる限りの理力を込めて……）"
		}
		WaitPrompt()
		WaitCloseWindow()
	}

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-956.57f,673.68f,47.25f)
	Turn("LEADER",-25.16f,360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ストッパー：王家の谷の門のストッパー：再訪用】
//──────────────────────────────
function "Stopper_Past_05_05"
{

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	LookChr("soldierE", "LEADER")
	LookChr("soldierC", "LEADER")
	LookChr("soldierA", "LEADER")

	TalkPopup("soldierE",0,0,0,0,0)
	{
		"巫女様、どうかお引取りを。"
		"でなくば我らも矛を向けざるを得ませんぞ。"
	}
	WaitPrompt()
	WaitCloseWindow()

	TalkPopup("soldierC",0,0,0,0,0)
	{
		"先ほどのご所業についても"
		"改めてご説明いただきたいですな。"
	}
	WaitPrompt()
	WaitCloseWindow()

	TalkPopup("LEADER",0,0,0,0,0)
	{
		"（警備も強化されたみたい。"
		"　通るのは難しそうだね……）\p"
		"（仕方ない、ここは未来の"
		"　 アドルさんたちに託そう……）"
	}
	WaitPrompt()
	WaitCloseWindow()

	LookReset("soldierE")
	LookReset("soldierC")
	LookReset("soldierA")

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-947.65f, 663.67f, 47.25f)
	Turn("LEADER",-42.28f,360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}


//──────────────────────────────
//	【ストッパー：西街道分岐のストッパー】
//──────────────────────────────
function "Stopper_Past_06_06"
{

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	//▼過去編Ⅵセレンの園へ向かう
	TalkPopup("LEADER",0,0,0,0,0)
	{
		"#000e#000m（こっちは王都方面だ……）\p"
		"（セレンの園は王家の谷にあるはず。"
		"　ここから西に進まないと。）"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-778.97f,710.35f,44.24f)
	Turn("LEADER",-13.44f,360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ストッパー：西街道のストッパー】
//──────────────────────────────
function "Stopper_Past_06_07"
{

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	//▼過去編Ⅵセレンの園へ向かう
	TalkPopup("LEADER",0,0,0,0,0)
	{
		"#000e#000m（王家の谷はこっちじゃない……"
		"　さっきの道を北に向かおう。）\p"
		"（………急がないと……！）"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
	SetChrPos("LEADER",-1001.61f,627.26f,34.37f)
	Turn("LEADER",-95.99f,360.0f)

	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}
