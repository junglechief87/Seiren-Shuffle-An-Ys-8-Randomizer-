#include "inc/mons.h"
#include "inc/def.h"
#include "inc/flag.h"
#include "inc/se.h"
#include "inc/scr_inc.h"
#include "inc/3dicon.h"
#include "inc/skilldef.h"
#include "inc/vo.h"
#include "inc/music.h"
#include "inc/efx.h"
#include "inc/temp/mp6401m.h"

//----------------------------------------------------------------------------//
//                                                                            //
// 
//                                                                            //
//----------------------------------------------------------------------------//
///////////////////////////////////////////////////////////////////////////////
// 初期化スクリプト
///////////////////////////////////////////////////////////////////////////////
//-------------------------------------------


function "init"
{
	

	MapHide("dorape_bed" , 1 )	//通常布団ON
	MapHide("dorape_sleep" , 0 )	//眠り布団OFF
	MapHide("dorape_wokeup" , 0 )	//起き上がり時布団OFF

	// ◆ダーナ確認用　SF_EVENT_ONフラグが立っていると消します
	if( FLAG[SF_EVENT_ON] )
	{
		SetChrPos("Dana" , -100000.00f , 0.00f , 0.00f )
		SetChrPos("Dana2" , -100000.00f , 0.00f , 0.00f )
		SetChrPos("Dana3" , -100000.00f , 0.00f , 0.00f )
	}

	if( FLAG[SF_EVENT_ON] )
	{
		//一般配置ファンクション呼び出し
		CallFunc("mp6402m:NpcPosition")

		// イベント制御
		if( FLAG[GF_PAST_EPISODE_D1A_TEM] )				//▼ダーナ編①Ａ寺院内を歩く
		{
			if( !FLAG[GF_SUBEV_PAST_D1_ROOM] )	// ダーナ編①：【サブイベント：ダーナの私室に入る】を見た
			{
				EventCue("mp6402m:SubEV_Past_D1_Room")		// ダーナ編①：【サブイベント：ダーナの私室に入る】
			}
		}

		// ＬＰ制御
		SetChrPos("LP_Past_D1_02",20.05f,-3.25f,0.30f)		// ダーナ編①：ダーナ編①：【ＬＰ：ダーナの部屋の祭壇】常時
		SetChrWork( "LP_Past_D1_02" , CWK_CHECKRADIUS , 2.5f )		// 範囲
		
		SetChrPos("LP_Past_Bookshelf",26.88f, 1.96f, 0.30f)	// ダーナ編①＆過去編Ⅰ：【ＬＰ：ダーナの部屋の書架】常時
		SetChrWork( "LP_Past_Bookshelf" , CWK_CHECKRADIUS , 2.5f )		// 範囲
		
		SetChrPos("LP_Past_Bed",14.18f,3.36f,-1.00f)		// ダーナ編①：【ＬＰ：ダーナの部屋のベッド】常時
		SetChrWork( "LP_Past_Bed" , CWK_CHECKRADIUS , 3.5f )		// 範囲
		
		if( FLAG[GF_PAST_EPISODE_D1A_TEM] )				//▼ダーナ編①Ａ寺院内を歩く
		{
			SetChrPos("LP_Past_D1_01",26.00f,12.50f,0.30f)	// ダーナ編①：【ＬＰ：ダーナの部屋の棚を調べる】
			SetChrWork( "LP_Past_D1_01" , CWK_CHECKRADIUS , 2.5f )		// 範囲
		}
	}
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//■配置制御セクション

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function "NpcPosition"
{
	if( FLAG[GF_PAST_EPISODE_6_GO_GARDEN] )				//▼過去編Ⅵセレンの園へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_5_GO_VALLAY] )		//▼過去編Ⅴ王家の谷へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_4_2_GO_OUT] )			//▼過去編Ⅳ-２王宮の外へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )		//▼過去編Ⅳ王宮前へ向かう
	{
		SetChrPos("Sister_4_01",21.13f,5.74f,0.30f)
		Turn("Sister_4_01",4.97f,360.0f)

		SetChrPos("Sister_4_02",25.85f,1.66f,0.30f)
		Turn("Sister_4_02",-87.45f,360.0f)

	}
	else if( FLAG[GF_PAST_EPISODE_3_GO_BAHA] )			//▼過去編Ⅲバハの塔へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_2_GO_SOUTHGATE] )		//▼過去編Ⅱ南門へ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_1_GO_CAMP] )			//▼過去編Ⅰアドルがいたポイントへ向かう
	{
	}
	else if( FLAG[GF_PAST_EPISODE_D3_WALK_CAPITAL] )	//▼ダーナ編③王都を歩く
	{
	}
	else if( FLAG[GF_PAST_EPISODE_D1A_TEM] )			//▼ダーナ編①Ａ寺院内を歩く
	{
	}
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//■一般会話セクション

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


//──────────────────────────────
//	【侍女】
//──────────────────────────────
function "Talk_Sister_4_01"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//───────────────
		//	場所		：寺院（過去）・ダーナの部屋
		//───────────────
		//	配置・カメラ：机の前で整理
		//	モーション	：
		//───────────────

		if( !FLAG[TF_TALK_MOB01] )
		{
			//	侍女
			TalkPopup("this",0,0,0,0,0)
			{
				"ご要望にあった"
				"オルサン国の文献が届いたのです。\p"
				"あの国は巫女様の予言をきっかけに"
				"長い戦乱を終えることができました。\p"
				"そのためでしょう、随分沢山の"
				"文献を貸し出してくださいました。\p"
				"そうそう、それとバハの塔からも"
				"ご要望の資料をお送りするとの連絡が……"
			}
			WaitPrompt()
			WaitCloseWindow()

			ChangeAnimation("this","ANI_EV_TEBURI", -1 , 1 )

			//	侍女
			TalkPopup("this",0,0,0,0,0)
			{
				"その、巫女様。"
				"連日遅くまで調べ物を"
				"なさっているようですが……\p"
				"どうか、あまり"
				"ご無理はなさいませんよう。"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_TALK_MOB01, 1 )
		}
		else
		{
			//　　★繰り返し
			//	侍女
			TalkPopup("this",0,0,0,0,0)
			{
				"教導師様も古文書を"
				"お持ちくださったそうですね。\p"
				"こちらに目録をお持ちしておきます。\p"
				"巫女様、どうか"
				"あまりご無理はなさいませんよう。"
			}
			WaitPrompt()
			WaitCloseWindow()
		}
	}

	ResetStopFlag(STOPFLAG_TALK)
}


//──────────────────────────────
//	【侍女】
//──────────────────────────────
function "Talk_Sister_4_02"
{
	SetStopFlag(STOPFLAG_TALK)
	CallFunc("system:talk_begin_zoom")		//TALK_ZOOM

	if( FLAG[GF_PAST_EPISODE_4_GO_CASTLE] )			//▼過去編Ⅳ王宮前へ向かう
	{
		//▼過去編Ⅳ王宮前へ向かう
		//───────────────
		//	場所		：寺院（過去）・ダーナの部屋
		//───────────────
		//	配置・カメラ：棚の前で整理
		//	モーション	：
		//───────────────

		if( !FLAG[TF_TALK_MOB02] )
		{
			//	侍女
			TalkPopup("this",0,0,0,0,0)
			{
				"アトラ侍女長の指示で"
				"資料の整理を行っているのです。\p"
				"……あの巫女様、なぜこれほど資料を"
				"お集めになっているのでしょう……"
			}
			WaitPrompt()
			WaitCloseWindow()

			ChangeAnimation("this","ANI_EV_REI", -1 , 1 )

			TalkPopup("this",0,0,0,0,0)
			{
				"す、すみません。"
				"差し出がましい事を申しました。"
			}
			WaitPrompt()
			WaitCloseWindow()
			SetFlag( TF_TALK_MOB02, 1 )
		}
		else
		{
			//　　★繰り返し
			//　　※カメラ切り替えなし
			//	侍女
			TalkPopup("this",0,0,0,0,0)
			{
				"アトラ侍女長の指示で"
				"資料の整理を行っているのです。"
			}
			WaitPrompt()
			WaitCloseWindow()

			ChangeAnimation("this","ANI_EV_REI", -1 , 1 )

			TalkPopup("this",0,0,0,0,0)
			{
				"……巫女様、どうか"
				"お早いお帰りをお待ちしております。"
			}
			WaitPrompt()
			WaitCloseWindow()
		}

	}

	ResetStopFlag(STOPFLAG_TALK)
}


////////////////////////////////////////////////////////////////////////////////

//■メインイベントセクション

////////////////////////////////////////////////////////////////////////////////
function "EV_M03S110"		 //[ダーナ編②]サライとの別れ
{
//開始処理ここから-----------------------------------------------
	SetStopFlag(STOPFLAG_EVENT)

	FadeOut(FADE_BLACK,0)
	WaitFade()

	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")
	CallFunc("system:party_remove")

	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))
	
	//キャラクター初期化
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "DANA" , INFOFLAG_NOATARI )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI )
//	SetChrPos("DANA",13.71f,13.39f,0.25f)
//	Turn("DANA",-90.16f,360.0f)
	SetChrPos("DANA",13.80f,13.82f,0.23f)
	Turn("DANA",-104.19f,360.0f)

	ChangeAnimation("DANA","ANI_EV_SC_SIAN", -1 , 1 )	
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT2,ANI_SIGN_HIDE,1)
//	Look("DANA" , 0 , -8 )

	SetFlag(SF_PAST_MODE,1)	//ダーナ紋章制御

	SetChrWork("Sarai", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "Sarai" , INFOFLAG_NOCHRATARI )
	SetChrInfoFlag( "Sarai" , INFOFLAG_NOATARI )
	SetChrPos("Sarai",20.02f,20.97f,0.00f)
	Turn("Sarai",1.17f,360.0f)
	ChangeAnimation("Sarai","ANI_WAIT", -1 , 1 )	
	//ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_WAIT,1)
	//ChangeSubAnimation("Sarai",SUBMOT_MOUTH,ANI_M_WAIT,1)
	//ChangeSubAnimation("Sarai",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("Sarai")

	Wait(30)

	Look("DANA" ,  -20 , -13)
	LookSpd("DANA" , 0.08 , 0.08 , 0.08 )

	SetFlag(SF_CHARANORECVSHADOW,1)	//キャラ影受けない

	//BGM設定◆
	//PlayBGM( BGM_FIELD_101 , XX )
	StopBGM(10)
	
	//カメラ設定
	MoveCameraAt( 0 , 11.911f , 15.794f , 2.242f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.720f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -27.712f , 0 )	// 基本仰角
	RotateCamera( 0 , 57.870f , 0 )				// 角度
	ChangeCameraPers( 0 , 44.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 3.000, 80.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6402m:EV_M03S110_ED")

//開始処理ここまで-----------------------------------------------

	PlaySE(SE_WHITEOUT, 100, 0, 0, 0, 1.0f, 0)
	Wait(70)

	SetEnvSEPlayState(-1, 1)	//環境SE
	PlayBGM(BGM_6402_M, 0)

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	//　　フェードインしてダーナの自室────
	//　　(窓があるなら)外を眺めているダーナ。

	Wait(25)

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 12.037f , 14.519f , 1.102f , 100 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 3.090f  ,  100 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 5.222f ,  100 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE , 76.966f ,  100 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 6.7f , 4000 )				// ロール回転

	//MoveCameraAt( 0 , 12.037f , 14.519f , 1.102f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.090f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 5.222f , 0 )	// 基本仰角
	//RotateCamera( 0 , 76.966f , 0 )				// 角度
	//ChangeCameraPers( 0 , 44.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	WaitThread(1004)

	Wait(10)

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000m植樹祭で視えた"
		"水底へ引き込まれるような光景……"
	}
	WaitPrompt()
	WaitCloseWindow()

	SetMotSpd("DANA" , SUBMOT_EYE , 0.6 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_E,1)
	Wait(10)

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#020l#000mあれは結局何だったのかな？"
		"予知とも違う不思議な感覚だった……"
	}
	WaitPrompt()
	WaitCloseWindow()

	SubAnimationMode( "DANA" , SUBMOT_EYE , SUBMODE_MTDDISABLE )	//自動まばたき禁止

	Wait(30)
	LookReset("DANA")
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKL_E,1)

	Wait(20)

	CrossFade(FADE_NORMAL)
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)

	MoveCameraAt( 0 , 13.514f , 10.808f , 1.548f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 4.770f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -5.171f , 0 )	// 基本仰角
	RotateCamera( 0 , 176.108f , 0 )				// 角度
	ChangeCameraPers( 0 , 44.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	Wait(FADE_NORMAL)
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_S,1)
	SubAnimationMode( "DANA" , SUBMOT_EYE , SUBMODE_MTDENABLE )	//自動まばたき許可
	Wait(20)

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 17.894f , 13.408f , 1.895f , 220)	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 4.780f  ,  220 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , -9.456f ,  220 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE , 252.204f ,  220 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 6.7f , 4000 )				// ロール回転

	//MoveCameraAt( 0 , 17.894f , 13.408f , 1.895f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 4.780f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -9.456f , 0 )	// 基本仰角
	//RotateCamera( 0 , 252.204f , 0 )				// 角度
	//ChangeCameraPers( 0 , 44.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転
	//// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。


	Wait(30)

	VisualName("visual/mapname/mn_6402m.itp",VN_NAMEMAP2,-1,-1,VN_MAPNAME_TIME)

	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	WaitThread(1004)

	Wait(10)

	CrossFade(FADE_NORMAL)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)

	SetMotSpd("DANA" , SUBMOT_EYE , 0.6 )

	MoveCameraAt( 0 , 17.675f , 11.192f , 1.672f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 4.270f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -8.159f , 0 )	// 基本仰角
	RotateCamera( 0 , 299.310f , 0 )				// 角度
	ChangeCameraPers( 0 , 31.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

//	Wait(FADE_NORMAL)

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 15.061f , 14.632f , 1.672f , 120 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 4.270f  ,  120 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , -10.380f  ,  120 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE ,  318.306f ,  120 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 6.7f , 140 )				// ロール回転

	//MoveCameraAt( 0 , 15.061f , 14.632f , 1.672f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 4.270f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -10.380f , 0 )	// 基本仰角
	//RotateCamera( 0 , 318.306f , 0 )				// 角度
	//ChangeCameraPers( 0 , 31.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転
	//// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	Wait(100)

	//　　扉がノックされるＳＥ。
	PlaySE(SE_M03S110_01, 100, 0,  0, 0, 1.0f, 0)	

	Wait(40)

	//　　ダーナにＰＡエモーション表示して振り返る。

	EmotionEx("DANA", 0.02f,38,38,5,1,1,0.8f)	// パッ
	LookSpd("DANA" , 0.10 , 0.10 , 0.10 )
	LookChr("DANA" , "Sarai")

	Wait(35)
	TalkPopup("DANA",0,1,1,175,0)
	{
		"#000e#000m……開いています。"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	CrossFade(FADE_FAST)
MoveCameraAt( 0 , 20.413f , 22.536f , 1.348f , 0 )	// 注視点
ChangeCameraDistance( 0 , 1.920f , 0 )		// 基本距離
ChangeCameraElevation( 0 , -7.331f , 0 )	// 基本仰角
RotateCamera( 0 , 170.902f , 0 )				// 角度
ChangeCameraPers( 0 , 41.000f , 0 )			// 視野角
SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
RollCamera( 0 , 0.0f , 0 )				// ロール回転
// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	SetChrPos("DANA",14.07f,13.31f,0.00f)
	Turn("DANA",-104.03f,360.0f)
	ChangeAnimation( "DANA" , "ANI_EV_SIT_C", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_E,1)

	DoorOpen(door_01 , 0, 1, 1)
//	PlaySE(SE_M03S110_02, 100, 0, 0, 0, 1.0f, 0)	//	扉開く(正式に扉SEが入れば勝手に鳴るような気もするのでひとまず保留)

	Wait(25)

	ExecuteCmd( 1, MoveTo, "Sarai" ,20.32f,16.33f,0.00f, 0.1f , 0.12f )
	//SetChrPos("Sarai",20.32f,16.33f,0.00f)
	//Turn("Sarai",1.17f,360.0f)

	Wait(20)

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 19.784f , 17.037f , 1.621f , 130 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 2.030f ,  130 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 2.674f ,  130 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE , 144.030f  ,  130 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 6.7f , 4000 )				// ロール回転

	//MoveCameraAt( 0 , 19.784f , 17.037f , 1.621f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.030f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 2.674f , 0 )	// 基本仰角
	//RotateCamera( 0 , 144.030f , 0 )				// 角度
	//ChangeCameraPers( 0 , 41.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	Wait(70)

	ChangeAnimation( "DANA" , "ANI_EV_SIT_C_E", -1 , 1 )

//	WaitThread(1001)
//	WaitThread(1002)
//	WaitThread(1003)
//	WaitThread(1004)

	Wait(40)

	CrossFade(FADE_NORMAL)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)

	//ドアを瞬時に閉じる
	DoorClose("door_01" , 1 , 0 )

	MoveCameraAt( 0 , 20.235f , 16.644f , 1.695f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.640f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -4.376f , 0 )	// 基本仰角
	RotateCamera( 0 , 340.919f , 0 )				// 角度
	ChangeCameraPers( 0 , 38.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -1.1f , 0 )				// ロール回転

	Wait(FADE_NORMAL)

	WaitThread(1)
	LookSpd("Sarai" , 0.11f , 0.11f , 0.11f )
	LookChr("Sarai" , "DANA")
	Wait(10)

	TalkPopup("Sarai",0,1,0,0,0)
	{
		"#021e#080mふふ……巫女様、お邪魔します。"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	CrossFade(FADE_NORMAL)
	MoveCameraAt( 0 , 16.047f , 14.447f , 1.522f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.780f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -0.157f , 0 )	// 基本仰角
	RotateCamera( 0 , 308.139f , 0 )				// 角度
	ChangeCameraPers( 0 , 34.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -1.8f , 0 )				// ロール回転
// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	TurnToChr("Sarai" , "DANA" , 7.0f)
	ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_CLOSE_E,1)
	ExecuteFunc( 10 , "mp6402m:Sarai_move" )

	Wait(FADE_NORMAL)

	Wait(10)

	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_S", -1 , 1 )

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000mサライちゃん……"
		"どうしたの、こんな夜中に？"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	"Sarai"
	HeadYes("Sarai" , 1 , 30)
	TalkPopup("Sarai",0,2,0,0,0)
	{
		"#000mええ、実はですね……"
		"今日はお別れを言いに参りました。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_E", -1 , 1 )

	TalkPopup("DANA",0,1,90,190,0)
	{
		"#000mえ……"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(20)

	SetEnvSEPlayState(6402003, 0)	//	

	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

//終了処理ここから----------------------------------------------------
	CallFunc("mp6402m:EV_M03S110_ED")
}

function "EV_M03S110_ED"
{
	SetSkipScript("")
	RestoreEventState()

	//キャラクター初期化
	CallFunc("system:reset_chrmot_DANA")
	CallFunc("system:reset_chrmot_Sarai")

	//マップパラメーターリセット
	ResetMapParam(-1)

	//#28570修正
	PlayBGM(BGM_6402_M, 0)
	SetEnvSEPlayState(6402001, 1)

	EventCue("mp6402m:EV_M03S111")

	ResetStopFlag(STOPFLAG_EVENT)

//終了処理ここまで----------------------------------------------------
}

function "EV_M03S111"		 //[ダーナ編②]サライとの別れ２
{
//開始処理ここから-----------------------------------------------
	SetStopFlag(STOPFLAG_EVENTIMPOSE)
	ResetStopFlag(STOPFLAG_CINEMA)

	FadeOut(FADE_BLACK,0)
	WaitFade()

	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")
	CallFunc("system:party_remove")

	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))
	
	//キャラクター初期化
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "DANA" , INFOFLAG_NOATARI )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI )
	SetChrPos("DANA",18.90f,8.10f,0.30f)
	Turn("DANA",-95.55f,360.0f)
	ChangeAnimation("DANA","ANI_WAIT", -1 , 1 )	
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT2,ANI_SIGN_HIDE,1)

	SetFlag(SF_PAST_MODE,1)	//ダーナ紋章制御


	SetChrWork("Sarai", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "Sarai" , INFOFLAG_NOCHRATARI )
	SetChrInfoFlag( "Sarai" , INFOFLAG_NOATARI )
	SetChrPos("Sarai",20.67f,8.08f,0.30f)
	Turn("Sarai",87.13f,360.0f)
	ChangeAnimation("Sarai","ANI_WAIT", -1 , 1 )	
	//ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_WAIT,1)
	//ChangeSubAnimation("Sarai",SUBMOT_MOUTH,ANI_M_WAIT,1)
	//ChangeSubAnimation("Sarai",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("Sarai")

	SetChrInfoFlag("eq0501_1",INFOFLAG_INVISIBLE)
	SetChrInfoFlag("eq0501_2",INFOFLAG_INVISIBLE)
	SetChrPos("eq0501_1",20.67f,8.08f,0.30f)
	Turn("eq0501_1",87.13f,360.0f)
	SetChrPos("eq0501_2",20.67f,8.08f,0.30f)
	Turn("eq0501_2",87.13f,360.0f)

	LookSpd("DANA" , 0.08 , 0.08 , 0.08 )
	LookChr("DANA" , "Sarai")

	LookSpd("Sarai" , 0.10 , 0.10 , 0.10 )
	LookChr("Sarai" , "DANA")

	Wait(40)

	SetFlag(SF_CHARANORECVSHADOW,1)	//キャラ影受けない

	//BGM設定
	//PlayBGM( BGM_FIELD_101 , XX )
	SoundEfx( SEFX_EV_CAVE_S, 15 )

	//カメラ設定
	MoveCameraAt( 0 , 20.472f , 6.815f , 1.794f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.960f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 2.304f , 0 )	// 基本仰角
	RotateCamera( 0 , 156.445f , 0 )				// 角度
	ChangeCameraPers( 0 , 30.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 2.000, 13.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6402m:EV_M03S111_ED")

//開始処理ここまで-----------------------------------------------

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 19.505f , 7.754f , 1.794f , 95 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 3.390f ,  95 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 2.304f ,  95 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE , 132.794f ,  95 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 6.7f , 95 )				// ロール回転

	//MoveCameraAt( 0 , 19.505f , 7.754f , 1.794f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.390f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 2.304f , 0 )	// 基本仰角
	//RotateCamera( 0 , 132.794f , 0 )				// 角度
	//ChangeCameraPers( 0 , 30.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -0.0f , 0 )				// ロール回転
	//// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	Wait(65)

	//	"Sarai"
	TalkPopup("Sarai",0,1,0,0,0)
	{
		"#000e#000m選ばれなかった候補者は故郷へ戻るか、"
		"巫女に仕えるか選ぶことになる……\p"
		"私も本当は寺院に残って、"
		"お手伝いをしたかったのですが……\p"
		"どうしても戻ってくるようにと"
		"家から少し前に連絡がありまして。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_WAIT2_S", -1 , 1 )


	//	"DANA"
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#061e#000mそっか……寂しくなるなぁ。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "Sarai" , "ANI_EV_TEMUNE_S", -1 , 1 )

	//	"Sarai"
	TalkPopup("Sarai",0,0,0,0,0)
	{
		"#000e#000mええ、ご一緒できず申し訳ありません。"
	}
	WaitPrompt()
	WaitCloseWindow()
	
	Wait(10)

	CrossFade(FADE_FAST)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	MoveCameraAt( 0 , 19.456f , 8.023f , 1.794f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.650f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 13.571f , 0 )	// 基本仰角
	RotateCamera( 0 , 109.747f , 0 )				// 角度
	ChangeCameraPers( 0 , 23.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -2.5f , 0 )				// ロール回転

	Wait(FADE_FAST)

	ChangeAnimation( "DANA" , "ANI_EV_WAIT2_E", -1 , 1 )

	HeadNo("DANA" , 1, 35 )

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#092e#080mううん、戻ってきてほしいって"
		"家族が言うのは当然だと思うな。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_MUNEGASSHOU_S", -1 , 1 )

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#020e#080m私のほうは大丈夫だから。"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	CrossFade(FADE_NORMAL)
	ChangeAnimation( "DANA" , "ANI_EV_MUNEGASSHOU_E", -1 , 1 )

	MoveCameraAt( 0 , 20.872f , 7.950f , 2.038f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.000f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -5.674f , 0 )	// 基本仰角
	RotateCamera( 0 , 252.375f , 0 )				// 角度
	ChangeCameraPers( 0 , 20.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -1.8f , 0 )				// ロール回転

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 20.872f , 7.950f , 2.038f , 120 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 2.540f ,  120 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , -5.674f ,  120 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE ,252.375f ,  120 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 6.7f , 4000 )				// ロール回転

	//MoveCameraAt( 0 , 20.872f , 7.950f , 2.038f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.540f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -5.674f , 0 )	// 基本仰角
	//RotateCamera( 0 , 252.375f , 0 )				// 角度
	//ChangeCameraPers( 0 , 20.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -1.8f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。


	Wait(FADE_NORMAL)

	Wait(10)

	//	"Sarai"
	TalkPopup("Sarai",0,1,0,0,0)
	{
		"#011e#000mダーナさん……#0L#60W"
		"#1L#0W#012e#080mありがとうございます。"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)
	
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 20.698f , 7.507f , 2.038f , 70 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 4.240f ,  70 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , -5.674f ,  70 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE ,245.364f ,  70 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 6.7f , 4000 )				// ロール回転

	//MoveCameraAt( 0 , 20.698f , 7.507f , 2.038f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 4.240f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -5.674f , 0 )	// 基本仰角
	//RotateCamera( 0 , 245.364f , 0 )				// 角度
	//ChangeCameraPers( 0 , 20.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -1.8f , 0 )				// ロール回転

	Wait(55)

	ChangeAnimation( "Sarai" , "ANI_EV_TEMUNE_E", -1 , 1 )

	TalkPopup("Sarai",0,0,0,0,0)
	{
		"#000e#080m今日はせめてダーナさんに"
		"お祝いの贈り物をと思いまして。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_SUP_S", -1 , 1 )


	HeadNo("DANA" , 1 , 30 )

	//	"DANA"
	TalkPopup("DANA",0,0,0,0,0)
	{
		"#000e#000mええっ？"
		"い、いいよ、そんな……悪いよ。"
	}
	WaitPrompt()
	WaitCloseWindow()

	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	WaitThread(1004)

	CrossFade(FADE_FAST)

	SetFlag(SF_TOWNMODE,0)	//武器出し許可

	SetParent(eq0501_2,Sarai,Null_tg_Rhand)
	SetParent(eq0501_1,Sarai,Null_tg_Lhand)

	MoveCameraAt( 0 , 20.485f , 8.144f , 1.939f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.100f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 17.345f , 0 )	// 基本仰角
	RotateCamera( 0 , 167.881f , 0 )				// 角度
	ChangeCameraPers( 0 , 30.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	Wait(FADE_FAST)
	
	Wait(10)

	//	"Sarai"
	LookSpd("Sarai" , 0.08 , 0.08 , 0.08 )
	HeadNo("Sarai" , 1 , 35 )
	TalkPopup("Sarai",0,0,0,0,0)
	{
		"#000e#000mそんなことを仰らずに。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 20.353f , 8.358f , 2.014f , 150 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 2.100f,  150 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 27.056f   150 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE 125.424f ,  150 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 1.4f , 4000 )				// ロール回転

	//MoveCameraAt( 0 , 20.353f , 8.358f , 2.014f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.100f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 27.056f , 0 )	// 基本仰角
	//RotateCamera( 0 , 125.424f , 0 )				// 角度
	//ChangeCameraPers( 0 , 30.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転


	ChangeAnimation( "DANA" , "ANI_EV_SUP_E", -1 , 1 )
	
	LookChr("Sarai" , "DANA")
	LookSpd("DANA" , 0.08 , 0.08 , 0.08 )
	Look("DANA", 0 , -12 )

	ChangeAnimation( "Sarai" , "ANI_EV_GIVESWORD_S", -1 , 1 )
	PlaySE(SE_M03S111_01, 50, 0, 0, 0, 1.0f, 0)

	Wait(5)
	ResetChrInfoFlag("eq0501_1",INFOFLAG_INVISIBLE)
	ResetChrInfoFlag("eq0501_2",INFOFLAG_INVISIBLE)

	TalkPopup("Sarai",0,0,0,0,0)
	{
		"さあさあ、こちらをお持ちしました。"

	}
	WaitPrompt()
	WaitCloseWindow()
	Wait(20)

	FadeOut(FADE_BLACK,FADE_FAST)
	WaitFade()
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	ChangeAnimation( "Sarai" , "ANI_EV_RYOTESIRI", -1 , 1 )
	SetChrInfoFlag("Sarai",INFOFLAG_INVISIBLE)

	ChangeAnimation( "DANA" , "ANI_EV_GETSWORD", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SUP,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_OPEN,1)

	SetParent(eq0501_2,0,0)
	SetParent(eq0501_1,0,0)
	SetParent(eq0501_2,DANA,Null_tg_Rhand)
	SetParent(eq0501_1,DANA,Null_tg_Lhand)


	MoveCameraAt( 0 , 19.118f , 8.051f , 0.748f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.380f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 27.315f , 0 )	// 基本仰角
	RotateCamera( 0 , 57.119f , 0 )				// 角度
	ChangeCameraPers( 0 , 34.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 7.0f , 0 )				// ロール回転
	Wait(20)
//	PlaySE( SE_M03S111_01 , 80 , 0,  0, 0, 1.0f, 0)		

	Wait(30)

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	Wait(20)

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE ,  19.142f , 8.123f , 1.691f  , 220 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE ,1.360f ,  220 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 6.011f  ,  220 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE, 118.740f ,  220 )				// 角度
	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , -7.5f , 220 )				// ロール回転

	//MoveCameraAt( 0 , 19.142f , 8.123f , 1.691f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.360f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 6.011f , 0 )	// 基本仰角
	//RotateCamera( 0 , 118.740f , 0 )				// 角度
	//ChangeCameraPers( 0 , 34.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -6.4f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。


	Wait(80)

	GetItemMessageExPlus(-1 ,0 , ITEMMSG_SE_JINGLE, "ダーナは#2C『#40Iエーデルスフィア』#0Cを受け取った。", 0, 0)
	WaitPrompt()
	WaitCloseWindow()


	//　　武器を手に取っているダーナ。
	//　　何かに気づいたようにＰＡエモーション表示。

	Wait(40)

	FadeBGM(70,10)

	SetStopFlag(STOPFLAG_CINEMA)	//字幕背景表示
	Wait(10)

	LookChr("DANA" , "Sarai")
	TalkMes("DANA","#3135V#072e#000mこの半月刀は……",
		"ひょっとして陽色#2Rヒイロカネ#R金の？","")
	WaitPrompt()
	WaitCloseWindow()
	Wait(10)

	CrossFade(FADE_CROSS)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	ResetChrInfoFlag("Sarai",INFOFLAG_INVISIBLE)

	MoveCameraAt( 0 , 19.722f , 8.112f , 1.716f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.880f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -5.876f , 0 )	// 基本仰角
	RotateCamera( 0 , 245.475f , 0 )				// 角度
	ChangeCameraPers( 0 , 29.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -4.2f , 0 )				// ロール回転

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 19.722f , 8.112f , 1.716f , 1200 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE ,  3.250f,  1200 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , -1.710f ,  1200 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE ,219.163f ,  1200 )				// 角度
	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 3.3f , 1200 )				// ロール回転

	//MoveCameraAt( 0 , 19.722f , 8.112f , 1.716f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.250f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -1.710f , 0 )	// 基本仰角
	//RotateCamera( 0 , 219.163f , 0 )				// 角度
	//ChangeCameraPers( 0 , 29.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 3.3f , 0 )				// ロール回転

	Wait(FADE_CROSS)

	//	"Sarai"
	HeadYes("Sarai" , 1 , 25 )
	ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_CLOSE_S,1)
	Wait(15)

	TalkMes("Sarai","#5406V#012e#080mええ、大峡谷の近くに",
		"古い地層が隆起した場所がありまして……","")
	WaitPrompt()


	TalkMes("Sarai","#5407V#000e#080mそこで採れる陽色金は純度が高く、",
		"とても質がいいそうです。","")
	WaitPrompt()
	TalkMes("Sarai","#5408V#011e#080mそれを用いて作られた武器は",
		"竜種を圧倒できるほどの業物になるとか。","")
	WaitPrompt()
	WaitCloseWindow()

	//	"DANA"
	HeadNo("DANA" , 1 , 30 )
	TalkMes("DANA","#3136V#061e#000mそ、そんなすごい物、",
		"余計にもらえないよ。","")
	WaitPrompt()
	WaitCloseWindow()
	Wait(10)

	CrossFade(FADE_FAST)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_WAIT,1)

	MoveCameraAt( 0 , 20.614f , 8.040f , 2.021f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.790f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -6.225f , 0 )	// 基本仰角
	RotateCamera( 0 , 227.667f , 0 )				// 角度
	ChangeCameraPers( 0 , 29.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 3.2f , 0 )				// ロール回転

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 20.621f , 8.085f , 2.021f , 900 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE ,  1.680f ,  900 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , -6.225f  ,  900 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE  295.571f ,  900 )				// 角度
	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , -3.4f , 900 )				// ロール回転

	//MoveCameraAt( 0 , 20.621f , 8.085f , 2.021f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.680f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -6.225f , 0 )	// 基本仰角
	//RotateCamera( 0 , 295.571f , 0 )				// 角度
	//ChangeCameraPers( 0 , 29.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -4.2f , 0 )				// ロール回転

	Wait(FADE_FAST)

	Wait(10)

	SetStopFlag(STOPFLAG_CINEMA)	//字幕背景表示
	Wait(10)

	ChangeAnimation( "Sarai" , "ANI_EV_RYOTESIRI_E", -1 , 1 )

	TalkMes("Sarai","#5409V#011e#080mいいえ、ダーナさん。",
		"受け取って頂かないと困ります。","")
	WaitPrompt()

	ChangeAnimation( "Sarai" , "ANI_EV_YUBITATE_S", -1 , 1 )

	TalkMes("Sarai","#5410V#080m何せ特に小柄なダーナさんに合わせて",
		"打ってもらった特注品です。","")
	WaitPrompt()

	Wait(20)

	LookSpd("Sarai" , 0.10 , 0.10 , 0.10 )
	LookRoll("Sarai" , 5 )

	TalkMes("Sarai","#5411V#020e#080m今更返されても、誰も使えませんし",
		"私も困ってしまいます。","")
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)
	CrossFade(FADE_CROSS)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	ChangeAnimation( "Sarai" , "ANI_EV_YUBITATE_E", -1 , 1 )

//	ChangeAnimation( "DANA" , "ANI_EV_RYOTEKOSI_S", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SAD_CLOSE_E,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_SMILE_S,1)

	MoveCameraAt( 0 , 19.175f , 8.290f , 1.659f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.500f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 0.730f , 0 )	// 基本仰角
	RotateCamera( 0 , 60.995f , 0 )				// 角度
	ChangeCameraPers( 0 , 22.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -3.5f , 0 )				// ロール回転

	Wait(FADE_CROSS)

	Wait(10)
	//	"DANA"
	TalkMes("DANA","#3137V#080m#030lあー、ひどいなあ。","","")
	WaitPrompt()
	WaitCloseWindow()

	LookReset("DANA")
	ChangeAnimation( "DANA" , "ANI_EV_GETSWORD_E", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SMILE_CLOSE_S,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKT_E,1)

	WaitAnimation2( "Sarai" , -1, 1, "ANI_EV_YUBITATE_E",  0)
	ChangeAnimation( "Sarai" , "ANI_EV_RYOTESIRI_S", -1 , 1 )

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 19.973f , 8.111f , 1.759f , 240 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE ,  4.320f ,  240 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 0.730f  ,  240 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE  57.159f ,  240 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 1.4f , 240 )				// ロール回転

	//MoveCameraAt( 0 , 19.973f , 8.111f , 1.759f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 4.320f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 0.730f , 0 )	// 基本仰角
	//RotateCamera( 0 , 57.159f , 0 )				// 角度
	//ChangeCameraPers( 0 , 22.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -3.5f , 0 )				// ロール回転

	LookRoll("Sarai" , 0 )
	TalkMes("Sarai","#5412V#012e#080mふふ……冗談です。","","")
	WaitPrompt()

	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SMILE_CLOSE_E,1)

	TalkMes("Sarai","#5413V#000m本当は私の代わりに",
		"ダーナさんの側に置いてほしいのです。","")
	WaitPrompt()

	TalkMes("Sarai","#5414V#011e#000mダーナさんとのお別れが",
		"さみしいのは私も同じですから。","")
	WaitPrompt()
	WaitCloseWindow()
	ResetStopFlag(STOPFLAG_CINEMA)	//字幕背景非表示

	ChangeAnimation( "Sarai" , "ANI_EV_RYOTESIRI_E", -1 , 1 )
	WaitAnimation2( "Sarai" , -1, 1, "ANI_EV_RYOTESIRI_E",  0)

	ExecuteCmd( 1, MoveTo, "Sarai" ,19.76f,8.22f,0.30f, 0.1f , 0.18f )
	//SetChrPos("Sarai",19.70f,8.12f,0.30f)
	//Turn("Sarai",89.49f,360.0f)

	Wait(15)

	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	StopThread(1)
	LookReset("DANA")
	LookReset("Sarai")
	Wait(15)

	SetChrPos("Sarai",19.613f,8.10f,0.30f)
	Turn("Sarai",-270.00f,360.0f)

	SetChrPos("DANA",18.90f,8.10f,0.30f)
	Turn("DANA",-90.00f,360.0f)

	ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SUP,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_OPEN,1)

	MoveCameraAt( 0 , 19.341f , 8.103f , 1.749f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.650f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -9.533f , 0 )	// 基本仰角
	RotateCamera( 0 , 234.065f , 0 )				// 角度
	ChangeCameraPers( 0 , 26.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -0.4f , 0 )				// ロール回転

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 2.000, 10.000 ,1.000 ,0.700 ,0.500)


	ChangeAnimation( "Sarai" , "ANI_EV_TETORI_S", -1 , 1 )
	ChangeAnimation( "DANA" , "ANI_EV_TETORI_S", -1 , 1 )

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 19.341f , 8.103f , 1.897f , 800 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 1.950f ,  800 )				// 基本距離
	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 17.375f  ,  800 )				// 基本仰角
	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE , 130.910f,  800 )				// 角度
	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , 8.5f , 800 )				// ロール回転

	//MoveCameraAt( 0 , 19.341f , 8.103f , 1.897f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.950f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 17.375f , 0 )	// 基本仰角
	//RotateCamera( 0 , 130.910f , 0 )				// 角度
	//ChangeCameraPers( 0 , 26.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 8.5f , 0 )				// ロール回転

	FadeIn(FADE_BLACK,FADE_FAST)
	WaitFade()

	Wait(25)

	SetStopFlag(STOPFLAG_CINEMA)	//字幕背景表示
	Wait(10)

	//　　サライ、ダーナの両手を取る。
	TalkMes("DANA","#3138Vあ……","","")
	WaitPrompt()
	WaitCloseWindow()
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_OPEN_E,1)


	//	"Sarai"
	TalkMes("Sarai","#5415V#080mあの思い切りのよさや途方もなく",
		"強い意志はどこから溢れてくるのやら。","")
	WaitPrompt()

	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SAD_CLOSE_S,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_SMILE_S,1)

	HeadNo("Sarai" , 1 , 35 )
	TalkMes("Sarai","#5416V#011e#080mこうしていると、その話し方や行動は",
		"私が知る“問題児”のままなのに。","")
	WaitPrompt()
	WaitCloseWindow()

	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_NIGA,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_NIGA_S,1)

	TalkMes("DANA","#3139Vあ、あはは、話し方は直せって",
			"オルガちゃんに言われてるけど……","")
	WaitPrompt()
	TalkMes("DANA","#3140V#062e#080mそもそも無理してる気がしちゃって、",
			"なかなか難しいかな。","")
	WaitPrompt()
	WaitCloseWindow()
	ResetStopFlag(STOPFLAG_CINEMA)	//字幕背景非表示

	Wait(40)

	CrossFade(FADE_NORMAL)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)
	MoveCameraAt( 0 , 19.384f , 7.973f , 1.647f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.220f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -16.533f , 0 )	// 基本仰角
	RotateCamera( 0 , 228.146f , 0 )				// 角度
	ChangeCameraPers( 0 , 25.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , -4.3f , 0 )				// ロール回転

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE , 19.359f , 8.060f , 1.950f , 260 )	// 注視点
//	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 2.240f ,  300 )				// 基本距離
//	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 30.507f ,  300 )				// 基本仰角
//	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE , 118.080f ,  300 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , -0.4f , 300)				// ロール回転

	//MoveCameraAt( 0 , 19.384f , 7.973f , 1.919f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.220f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -16.533f , 0 )	// 基本仰角
	//RotateCamera( 0 , 228.146f , 0 )				// 角度
	//ChangeCameraPers( 0 , 25.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -4.3f , 0 )				// ロール回転

	Wait(FADE_NORMAL)

	Wait(45)

	SetStopFlag(STOPFLAG_CINEMA)	//字幕背景表示
	Wait(10)

	//	"Sarai"
	TalkMes("Sarai","#5417V#080mこれから先、何があったとしても",
		"あなたはあなたらしくいてください。","")
	WaitPrompt()
	TalkMes("Sarai","#5418V#080m変わらないでいるというのは",
		"なかなか難しいかもしれませんが……","")
	WaitPrompt()
	TalkMes("Sarai","#5419V#012e#000mそれでもダーナさんには",
		"ずっと“らしく”いてほしいのです。","")
	WaitPrompt()
	WaitCloseWindow()


	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)
	WaitThread(1004)

	Wait(10)

	ExecuteCmd( 1001,MoveCameraAt, INTERPOLATE_SPHERE ,  19.384f , 7.973f , 1.994f  , 200 )	// 注視点
	ExecuteCmd( 1002,ChangeCameraDistance, INTERPOLATE_SPHERE , 1.950f  ,  200 )				// 基本距離
//	ExecuteCmd( 1003,ChangeCameraElevation, INTERPOLATE_SPHERE , 30.507f ,  280 )				// 基本仰角
//	ExecuteCmd( 1004,RotateCamera, INTERPOLATE_SPHERE , 118.080f ,  280 )				// 角度
//	ExecuteCmd( 1005,RollCamera, INTERPOLATE_SPHERE , -0.4f , 280)				// ロール回転

	//MoveCameraAt( 0 , 19.384f , 7.973f , 1.994f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.950f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -16.533f , 0 )	// 基本仰角
	//RotateCamera( 0 , 228.146f , 0 )				// 角度
	//ChangeCameraPers( 0 , 25.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -4.3f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	//	"DANA"
	TalkMes("DANA","#3141V#000e#000mサライ……ちゃん……？","","")
	WaitPrompt()
	WaitCloseWindow()
	Wait(15)
	ResetStopFlag(STOPFLAG_CINEMA)	//字幕背景非表示

	WaitThread(1001)
	WaitThread(1002)
	Wait(10)

	StopBGM(120)
	SetEnvSEPlayState(-1, 0)	//環境SE全停止

//　　画面フェードアウト。
	FadeOut(FADE_BLACK,FADE_SLOW)
	WaitFade()

	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	Wait(15)

	
//終了処理ここから----------------------------------------------------
	CallFunc("mp6402m:EV_M03S111_ED")
}

function "EV_M03S111_ED"
{
	SetSkipScript("")
	RestoreEventState()

	//キャラクター初期化
	CallFunc("system:reset_chrmot_DANA")

	//SetChrWork("Sarai", CWK_DEFAULT_SKIPNODE_OFF, 0)
	//ResetChrInfoFlag( "Sarai" , INFOFLAG_NOCHRATARI )
	//ChangeAnimation( "Sarai" , "ANI_WAIT" -1 , 1 )
	//ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_WAIT,1)
	//ChangeSubAnimation("Sarai",SUBMOT_MOUTH,ANI_M_WAIT,1)
	//ChangeSubAnimation("Sarai",SUBMOT_EXT1,ANI_E_LOOKC,1)
	//LookReset( "Sarai" )

	//マップパラメーターリセット
	ResetMapParam(-1)

	SetFlag(SF_CHARANORECVSHADOW,0)	//キャラ影受ける

	// 通常
	if ( !FLAG[SF_GALLERY_EVENT] )
	{
		//フラグ処理
		SetFlag(SF_TOWNMODE,1)	//武器出し禁止
		SetFlag(SF_PAST_MODE,0)	//ダーナ紋章制御

		SetFlag( TF_LOADING_TIPS_OFF, 1 )	//NowLoading 時の Tips 表示をカット
		SetFlag( GF_GALL_EV_03_03, 1 )		// M03S111:ダーナ② サライとの別れ２

		StopBGM(60)
		SetFlag(SF_NOCHANGEBGM, 1)

		LoadArg("map/mp3105t3/mp3105t3.arg")
		EventCue("mp3105:EV_M03S120")

		SetEnvSEPlayState(-1, 0)	//環境SE全停止

		ResetStopFlag(STOPFLAG_EVENT)
	}
	// イベントギャラリー中
	else
	{
		FadeBGM(100,15)
		SoundEfx( SEFX_DEFAULT, 15 )
		SetEnvSEPlayState(-1, 0)	//環境SE全停止
		GalleryEvEnd(0)		// イベントギャラリー終了（スクリプトから強制的に抜けていろいろ処理してくれる）
		ResetStopFlag(STOPFLAG_EVENTIMPOSE)
	}

//終了処理ここまで----------------------------------------------------
}


function "Sarai_move"
{
	ExecuteCmd( 1, MoveTo, "Sarai" ,16.74f,14.08f,0.00f, 0.1f , 0.20f )
	//SetChrPos("Sarai",16.74f,14.08f,0.00f)
	//Turn("Sarai",80.50f,360.0f)

	WaitThread(1)
	ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_CLOSE_S,1)
	TurnToChr("Sarai" , "DANA" , 7.0f)
	ChangeSubAnimation("Sarai",SUBMOT_EYE,ANI_E_CLOSE_E,1)

}

function "EV_M04S130"		 //過去Ⅰ アドルの夢を見る
{
//開始処理ここから-----------------------------------------------
	SetStopFlag(STOPFLAG_EVENTIMPOSE)
	ResetStopFlag(STOPFLAG_CINEMA)	//字幕背景非表示

	FadeOut(FADE_BLACK,0)
	WaitFade()

	SaveEventState()
	SaveCamera()

	//環境初期化＆不要なものを隠す
	CallFunc("system:party_reset")
	CallFunc("system:party_remove")

	//過去Ⅰ　開始処理呼び出し
	CallFunc("system:BackTo_EPISODE_1")
	SetFlag(GF_PAST_EPISODE_1B_REARRIVE, 0)	//▽過去編ⅠＢ再訪時
	SetFlag(SF_PAST_AGAIN, 0)		//初回はメニューから帰還を禁止

	MapHide("dorape_bed" , 0 )	//通常布団OFF
	MapHide("dorape_sleep" , 0 )	//眠り布団OFF
	MapHide("dorape_wokeup" , 1 )	//起き上がり時布団ON
//	MapAnime("bed_set" , "dorape_wokeup")

	//キャラクター初期化
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "DANA" , INFOFLAG_NOATARI )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI )
	SetChrPos("DANA",13.94f,2.79f,0.99f)
	Turn("DANA",177.41f,360.0f)
	ChangeAnimation("DANA","ANI_EV_SLEEP_BED", -1 , 1 )	
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SUP,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_SUP,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT2,ANI_SIGN_HIDE,1)
	LookSpd("DANA" , 0.08 , 0.08 , 0.08 )

	SetChrWork("Olga", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "Olga" , INFOFLAG_NOCHRATARI )
	SetChrPos("Olga",20.67f,22.79f,0.00f)
	Turn("Olga",0.00f,360.0f)
	ChangeAnimation("Olga","ANI_WAIT", -1 , 1 )	
	//ChangeSubAnimation("Olga",SUBMOT_EYE,ANI_E_WAIT,1)
	//ChangeSubAnimation("Olga",SUBMOT_MOUTH,ANI_M_WAIT,1)
	//ChangeSubAnimation("Olga",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("Olga")

	Wait(30)
	
	//カメラ設定
	MoveCameraAt( 0 , 14.189f , 2.555f , 1.571f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.140f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 4.763f , 0 )	// 基本仰角
	RotateCamera( 0 , 219.710f , 0 )				// 角度
	ChangeCameraPers( 0 , 24.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転


	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 3.000, 90.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	StopBGM(30)
	SoundEfx( SEFX_EV_CAVE_S, 15 )

	//スキップ許可
	SetSkipScript("mp6402m:EV_M04S130_ED")

//開始処理ここまで-----------------------------------------------


	SetMotSpd("DANA" , -1 , 1.5)
	ChangeAnimation("DANA","ANI_EV_WAKEUP_BED_S", -1 , 1 )	

	Wait(10)

//	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE ,325.954f , -6.432f , 779.717f , 110 )		// 注視点
	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 1.960f , 20)		// 基本距離
//	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , -28.812f , 140 )		// 基本仰角
//	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE ,40.895f  ,  180 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 60 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	//MoveCameraAt( 0 , 14.189f , 2.555f , 1.571f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.960f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 4.763f , 0 )	// 基本仰角
	//RotateCamera( 0 , 219.710f , 0 )				// 角度
	//ChangeCameraPers( 0 , 24.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	PlaySE( SE_M04S130_03 , 50 , 0,  200, 0, 1.0f, 0)

	FadeIn(FADE_BLACK,FADE_CROSS)
	WaitFade()

	PlaySE( SE_M04S130_01 , 70 , 0,  200, 0, 1.0f, 0)		//ガバッ
	StopSE(SE_M04S130_03, 700)

	//　　画面フェードインして	
	//　　自室の寝台でガバッと飛び起きるダーナ。

	Wait(15)

	SetStopFlag(STOPFLAG_CINEMA)	//字幕背景
	Wait(10)

//	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_KOMA_S,1)
	TalkMes("DANA","#3153V#190eはあ……はあ……","","")
	WaitPrompt()
	WaitCloseWindow()

	Wait(30)

	HeadNo("DANA" , 1 , 35 )
	TalkMes("DANA","#3154V#000mい、今のは予知？",
		"それとも……ただの夢？","")
	WaitPrompt()

	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE ,14.126f , 2.510f , 1.745f , 200 )		// 注視点
	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.260f , 200 )		// 基本距離
	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , -9.292f , 200 )		// 基本仰角
	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE , 209.949f,  200)		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 60 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	//MoveCameraAt( 0 , 14.126f , 2.510f , 1.745f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.260f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -9.292f , 0 )	// 基本仰角
	//RotateCamera( 0 , 209.949f , 0 )				// 角度
	//ChangeCameraPers( 0 , 24.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	Look("DANA" , -20 , 0 )
	TalkMes("DANA","#3155V#062e#020l#000m燃えるような真っ赤な髪……",
		"あの人は誰だったんだろう……","")
	WaitPrompt()
	TalkMes("DANA","#3156V#061e#000mそれに……","","")
	WaitPrompt()
	TalkMes("DANA","#3157V#0L……………………………………","","")
	WaitPrompt()
	WaitCloseWindow()
	ResetStopFlag(STOPFLAG_CINEMA)	//字幕背景非表示

	//　　コンコンと扉を叩く音がする。
	//　　ダーナにPAエモーション。

	PlaySE( SE_M04S130_02 , 100 , 0,  0, 0, 1.0f, 0)		//ノック

	Wait(40)

	SetMotSpd("DANA" , -1 , 1.0)
	EmotionEx("DANA",0.025f,EMO_PA,0,5,1, 1, 0.7f)	//パッ
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_CLOSE_E,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKR_S,1)	
	Look("DANA" , 17 , 7 )


	Wait(50)

	CrossFade(FADE_FAST)
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)

	MoveCameraAt( 0 , 13.929f , 3.942f , 1.645f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.420f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -0.720f , 0 )	// 基本仰角
	RotateCamera( 0 , 325.241f , 0 )				// 角度
	ChangeCameraPers( 0 , 41.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 2.8f , 0 )				// ロール回転

	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE , 14.164f , 3.778f , 1.645f , 180 )		// 注視点
//	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 3.532f, 280 )		// 基本距離
//	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , 0.862f, 280 )		// 基本仰角
//	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE ,   55.828f ,  280 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE ,0.0f, 280 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,39.000f, 280 )		// 視野角	

	//MoveCameraAt( 0 , 14.164f , 3.778f , 1.645f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.420f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -0.720f , 0 )	// 基本仰角
	//RotateCamera( 0 , 325.241f , 0 )				// 角度
	//ChangeCameraPers( 0 , 41.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 2.8f , 0 )				// ロール回転

	Wait(FADE_FAST)

	SetStopFlag(STOPFLAG_CINEMA)	//字幕背景
	Wait(10)

	//	オルガの声
	TalkMes("Olga","#5346Vダーナ、起きているのか？","","")
	WaitPrompt()
	WaitCloseWindow()

	HeadYes("DANA" , 1 , 25 )
	TalkMes("DANA","#3158V#000l#000e#000mう、うん。",
		"入ってきて大丈夫だよ。","")
	WaitPrompt()
	WaitCloseWindow()
	ResetStopFlag(STOPFLAG_CINEMA)	//字幕背景非表示

	Wait(10)

	FadeOut(FADE_BLACK,FADE_FAST)
	WaitFade()

	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)

	//終了処理ここから----------------------------------------------------
	CallFunc("mp6402m:EV_M04S130_ED")
}

function "EV_M04S130_ED"
{
	SetSkipScript("")												//終了処理はスキップ禁止
	RestoreEventState()

	//キャラクター初期化
	CallFunc("system:reset_chrmot_DANA")
	CallFunc("system:reset_chrmot_Olga")

	//マップパラメーターリセット
	ResetMapParam( -1 )

	EventCue("mp6402m:EV_M04S131")
	ResetStopFlag(STOPFLAG_EVENTIMPOSE)

	//終了処理ここまで----------------------------------------------------
}

function "EV_M04S131"		 //過去Ⅰ アドルの夢を見る２
{
//開始処理ここから-----------------------------------------------
	SetStopFlag(STOPFLAG_EVENT)

	FadeOut(FADE_BLACK,0)
	WaitFade()

	SaveEventState()
	SaveCamera()

	//環境初期化＆不要なものを隠す
	CallFunc("system:party_reset")
	CallFunc("system:party_remove")

	MapHide("dorape_bed" , 1 )	//通常布団ON
	MapHide("dorape_sleep" , 0 )	//眠り布団OFF
	MapHide("dorape_wokeup" , 0 )	//起き上がり時布団OFF

	//MTDのSE鳴らさない
	//SetFlag( SF_NOUSE_MTDSE, 1 )
	DoorOpen(door_01 , 0, 1, 1)		//ドア瞬時に開けて固定

	//キャラクター初期化
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "DANA" , INFOFLAG_FLING )
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI )
	SetChrPos("DANA",15.88f,3.30f,0.30f)
	Turn("DANA",-98.88f,360.0f)
	ChangeAnimation("DANA","ANI_EV_SLEEP_BED", -1 , 1 )	
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_SUP,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_SUP,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT2,ANI_SIGN_HIDE,1)

	LookSpd("DANA" , 0.08 , 0.08 , 0.08 )

	SetChrWork("Olga", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag( "Olga" , INFOFLAG_NOCHRATARI )
	SetChrPos("Olga",19.87f,14.33f,0.00f)
	Turn("Olga",0.00f,360.0f)
	ChangeAnimation("Olga","ANI_WAIT", -1 , 1 )	
	ChangeSubAnimation("Olga",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("Olga",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("Olga",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookChr("Olga" , "DANA")

	Wait(30)
	//MTDのSE鳴らす
	//SetFlag( SF_NOUSE_MTDSE, 0 )
	
	//カメラ設定
	MoveCameraAt( 0 , 14.821f , 2.944f , 1.895f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.260f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 7.941f , 0 )	// 基本仰角
	RotateCamera( 0 , 303.295f , 0 )				// 角度
	ChangeCameraPers( 0 , 37.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 2.000, 25.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6402m:EV_M04S131_ED")

//開始処理ここまで-----------------------------------------------

	PlayBGM(BGM_6402_M, 0)

	ExecuteCmd( 3, MoveTo, "Olga" ,16.28f,5.20f,0.30f, 0.1f , 0.19f )
	//SetChrPos("Olga",16.28f,5.20f,0.30f)
	//Turn("Olga",12.28f,360.0f)

	ChangeAnimation( "DANA" , "ANI_EV_SIT_C_E", -1 , 1 )
	Wait(2)

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	Wait(15)
	LookChr("DANA" , "Olga" )

	ExecuteCmd(1001, MoveCameraAt, INTERPOLATE_SPHERE ,15.764f , 3.866f , 1.747f , 160 )		// 注視点
	ExecuteCmd(1002, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.260f, 160)		// 基本距離
	ExecuteCmd(1003, ChangeCameraElevation, INTERPOLATE_SPHERE , 0.063f , 160 )		// 基本仰角
	ExecuteCmd(1004, RotateCamera, INTERPOLATE_SPHERE , 320.344f   ,  160 )		// 角度
//	ExecuteCmd(1005, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 60 )		// ロール回転
//	ExecuteCmd(1006, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	//MoveCameraAt( 0 , 15.764f , 3.866f , 1.747f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.260f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 0.063f , 0 )	// 基本仰角
	//RotateCamera( 0 , 320.344f , 0 )				// 角度
	//ChangeCameraPers( 0 , 37.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	//　　扉が開いてオルガが入室してくる。
	//　　ダーナが寝台から降りると、
	//　　オルガが歩いてきてフレームイン。

	Wait(30)

	TalkPopup("Olga",0,2,0,0,0)
	{
		"#000m珍しく体調が悪そうではないか。"
	}
	WaitPrompt()
	WaitCloseWindow()

	DoorClose("door_01",0 ,0 )	//ドア閉じるのを見せる


	TalkPopup("Olga",0,2,0,0,0)
	{
		"#000m大丈夫なのか？"
		"顔色も優れないようだが……"
	}
	WaitPrompt()
	WaitCloseWindow()

	LookReset("DANA")
	Turn("DANA",-166.68f,7.0f)
	LookChr("DANA" , "Olga")

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#050e#080mあはは、ちょっとおかしな夢を見て。"
		"ただの夢ならいいんだけど……その……"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　オルガに「？」エモーション。
	EmotionEx("Olga",0.0f,EMO_Q,0,5,1,1,1.0f)	// ？

	Wait(35)

	WaitThread(3)

	ChangeAnimation( "Olga" , "ANI_EV_UDEGUMI_S", -1 , 1 )

	TalkPopup("Olga",0,2,0,0,0)
	{
		"#000e#000mもしかして予知か？"
	}
	WaitPrompt()
	WaitCloseWindow()

	CrossFade(FADE_FAST)
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	SetChrPos("Olga",16.26f,4.81f,0.30f)
	Turn("Olga",9.34f,360.0f)
	
	MoveCameraAt( 0 , 16.079f , 2.892f , 1.744f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 1.990f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 0.902f , 0 )	// 基本仰角
	RotateCamera( 0 , 203.839f , 0 )				// 角度
	ChangeCameraPers( 0 , 35.500f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE ,16.286f , 2.984f , 1.744f , 160 )		// 注視点
//	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.430f, 160)		// 基本距離
//	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 5.126f , 160 )		// 基本仰角
//	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 192.699f ,  160 )		// 角度
//	ExecuteCmd(1004, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 60 )		// ロール回転
//	ExecuteCmd(1005, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	//MoveCameraAt( 0 , 16.286f , 2.984f , 1.744f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 1.990f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 0.902f , 0 )	// 基本仰角
	//RotateCamera( 0 , 203.839f , 0 )				// 角度
	//ChangeCameraPers( 0 , 35.500f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , -3.2f , 0 )				// ロール回転

	Wait(FADE_FAST)
	Wait(10)

	HeadYes("DANA" , 1, 35 )

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#061e#000mうん、それが……\p"
		"#012e#010l夢のようで、予知のような……"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_S", -1 , 1 )


	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000l#000e#000m……私は見知らない"
		"赤毛の剣士として行動していたの。"
	}
	WaitPrompt()
	WaitCloseWindow()

	CrossFade(FADE_CROSS)
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	MoveCameraAt( 0 , 16.162f , 4.142f , 1.868f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.010f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 3.557f , 0 )	// 基本仰角
	RotateCamera( 0 , 205.523f , 0 )				// 角度
	ChangeCameraPers( 0 , 27.500f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE ,16.162f , 4.142f , 1.918f , 160 )		// 注視点
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 3.220f, 160)		// 基本距離
//	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 5.126f , 160 )		// 基本仰角
//	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 192.699f ,  160 )		// 角度
//	ExecuteCmd(1004, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 60 )		// ロール回転
//	ExecuteCmd(1005, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	//MoveCameraAt( 0 , 16.162f , 4.142f , 1.918f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.220f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 3.557f , 0 )	// 基本仰角
	//RotateCamera( 0 , 205.523f , 0 )				// 角度
	//ChangeCameraPers( 0 , 27.500f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	Wait(FADE_CROSS)

	Wait(15)

	//　　オルガに「…」エモーション表示。
	EmotionEx("Olga", -0.02f,24,0,5,1,1,0.75f)	// …

	Wait(50)

	//　　オルガに「…」エモーション表示。

	ChangeAnimation( "Olga" , "ANI_EV_UDEGUMI_E", -1 , 1 )

	HeadNo("Olga" , 1, 35 )
	TalkPopup("Olga",0,1,0,0,0)
	{
		"#061e#000m……何だって？"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	"DANA"
	//	"DANA"
	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_E", -1 , 1 )
	TalkPopup("DANA",0,2,0,0,0)
	{
		"#101e#100mあはは、やっぱり分かりにくいよね。"
	}
	WaitPrompt()
	WaitCloseWindow()

	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_TEMUNE_E",  0)
	ChangeAnimation( "DANA" , "ANI_EV_TEBURI", -1 , 1 )

	TalkPopup("DANA",0,2,0,0,0)
	{
		"#102e#000mとにかく剣士が仲間たちと旅をして、"
		"とある場所にたどり着く夢……"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "Olga" , "ANI_EV_SIAN_S", -1 , 1 )

	//	"Olga"
	TalkPopup("Olga",0,1,0,0,0)
	{
		"#012e#000mふむ……"
	}
	WaitPrompt()
	WaitCloseWindow()

	CrossFade(FADE_CROSS)
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)

	MoveCameraAt( 0 , 15.610f , 3.258f , 1.843f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.260f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -5.401f , 0 )	// 基本仰角
	RotateCamera( 0 , 128.722f , 0 )				// 角度
	ChangeCameraPers( 0 , 27.500f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE ,15.699f , 3.147f , 1.843f , 300 )		// 注視点
//	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.430f, 160)		// 基本距離
//	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 5.126f , 160 )		// 基本仰角
//	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 192.699f ,  160 )		// 角度
//	ExecuteCmd(1004, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 60 )		// ロール回転
//	ExecuteCmd(1005, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	//MoveCameraAt( 0 , 15.699f , 3.147f , 1.843f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 2.260f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -5.401f , 0 )	// 基本仰角
	//RotateCamera( 0 , 128.722f , 0 )				// 角度
	//ChangeCameraPers( 0 , 27.500f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	
	Wait(FADE_CROSS)

	Wait(10)

	ChangeAnimation( "DANA" , "ANI_EV_WAIT2_S", -1 , 1 )
	LookReset()

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#011e#000m最初、そこが何処なのか"
		"私にもまるで分からなかった……\p"
		"#020l#012e#000mでも、どことなく見覚えのある街並みや"
		"王家の紋章を刻んだ建物が見えてきて……"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_WAIT2_E", -1 , 1 )

	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000l#000mそこが……荒廃した廃墟が……"
		"王都アイギアスだって分かったの。"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(10)

	CrossFade(FADE_FAST)
	StopThread(1000)
	StopThread(1001)
	StopThread(1002)
	StopThread(1003)
	StopThread(1004)
	StopThread(1005)
	MoveCameraAt( 0 , 16.162f , 3.866f , 1.879f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.500f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -9.897f , 0 )	// 基本仰角
	RotateCamera( 0 , 18.463f , 0 )				// 角度
	ChangeCameraPers( 0 , 24.500f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE ,16.162f , 3.866f , 1.805f, 160 )		// 注視点
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE ,  3.160f , 180)		// 基本距離
//	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 5.126f , 160 )		// 基本仰角
//	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 192.699f ,  160 )		// 角度
//	ExecuteCmd(1004, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 60 )		// ロール回転
//	ExecuteCmd(1005, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	//MoveCameraAt( 0 , 16.162f , 3.866f , 1.805f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 3.160f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , -9.897f , 0 )	// 基本仰角
	//RotateCamera( 0 , 18.463f , 0 )				// 角度
	//ChangeCameraPers( 0 , 24.500f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転
	//// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	Wait(FADE_FAST)

	//　　オルガに「！」エモーション。

	EmotionEx("Olga", -0.015f,2,5,5,1,1,0.9f)	// ！
	ChangeSubAnimation("Olga",SUBMOT_EYE,ANI_E_ANGER,1)

	Wait(55)

	Look("DANA" , 0 , -10 )
	
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000e#000mあの光景は一体……"
		"赤毛の剣士は誰だったんだろう……"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	"Olga"
	TalkPopup("Olga",0,2,0,0,0)
	{
		"#041e#000mなるほど、ただの夢で済ますには"
		"確かに気になる内容のようだ。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000e#000m#0L………………………………"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	"Olga"
	TalkPopup("Olga",0,2,0,0,0)
	{
		"#000mそれで、今からその剣士が"
		"辿り着いた場所へ行ってみようと。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "Olga" , "ANI_EV_SIAN_E", -1 , 1 )

	TalkPopup("Olga",0,2,0,0,0)
	{
		"#042eそう考えているわけだな？"
	}
	WaitPrompt()
	WaitCloseWindow()

	LookChr("DANA" , "Olga" )
	Wait(10)

	//　　ダーナに冷や汗エモーション表示。
	EmotionEx("DANA", 0.09f,EMO_TARA,0,5,1,1,0.6f)	// 冷や汗

	Wait(45)

	ChangeAnimation( "DANA" , "ANI_EV_TEBURI", -1 , 1 )
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000e#000mよ、よく分かったね。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "Olga" , "ANI_EV_RYOTEKOSI_S", -1 , 1 )

	//	"Olga"
	TalkPopup("Olga",0,2,0,0,0)
	{
		"#011e#000m何故分からないと思う？"
		"話が早くて助かるであろう。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	"DANA"
	WaitAnimation2( "DANA" , -1, 1, "ANI_EV_TEBURI",  0)

	ChangeAnimation( "DANA" , "ANI_EV_HOHOKAKI", -1 , 1 )
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000e#000mあはは……"
	}
	WaitPrompt()
	WaitCloseWindow()

	Wait(20)

	CrossFade(FADE_CROSS)
//	MoveCameraAt( 0 , 16.764f , 4.555f , 1.582f , 0 )	// 注視点
//	ChangeCameraDistance( 0 , 3.400f , 0 )		// 基本距離
//	ChangeCameraElevation( 0 , 9.793f , 0 )	// 基本仰角
//	RotateCamera( 0 , 317.605f , 0 )				// 角度
//	ChangeCameraPers( 0 , 34.500f , 0 )			// 視野角
//	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
//	RollCamera( 0 , 0.0f , 0 )				// ロール回転
//	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。
//
//	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , 16.764f , 4.555f , 1.805f  , 180 )		// 注視点
//	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 3.400f, 180)		// 基本距離
//	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 7.197f  , 180 )		// 基本仰角
//	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 317.605f ,  180 )		// 角度
//	ExecuteCmd(1004, RollCamera, INTERPOLATE_SPHERE ,-7.5f , 180 )		// ロール回転
//	ExecuteCmd(1005, ChangeCameraPers, INTERPOLATE_SPHERE ,34.000f, 110)		// 視野角

	MoveCameraAt( 0 , 16.764f , 4.555f , 1.805f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 3.400f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 7.197f , 0 )	// 基本仰角
	RotateCamera( 0 , 317.605f , 0 )				// 角度
	ChangeCameraPers( 0 , 34.500f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	Wait(FADE_CROSS)
	Wait(15)

	ChangeAnimation( "Olga" , "ANI_EV_RYOTEKOSI_E", -1 , 1 )

	//	"Olga"
	TalkPopup("Olga",0,2,0,0,0)
	{
		"#012e#000mよいのではないか？"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　ダーナにＰＡエモーション。
	EmotionEx("DANA",0.02f,EMO_PA,0,5,1, 1, 0.8f)	//パッ

	Wait(35)

	ChangeAnimation( "Olga" , "ANI_EV_UDEGUMI_S", -1 , 1 )

	TalkPopup("Olga",0,2,0,0,0)
	{
		"#011e#000mサライ女王とともに"
		"この国に最大の繁栄と秩序をもたらす……\p"
		"そう誓ったお前は今や女王と共に、"
		"“最も幸福な時代”を実現しつつある。\p"
		"#012eその夢の話……"
		"内容が内容だけに放ってはおけまい。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_S", -1 , 1 )

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#011e#000mオルガちゃん……ありがとう。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//	"Olga"
	HeadNo("Olga" , 1 , 35 )

	TalkPopup("Olga",0,2,0,0,0)
	{
		"#011e#000m私が礼を言われることではない。\p"
		"必要な手配が終わり次第、"
		"私もお前の後を追うとしよう。"
	}
	WaitPrompt()
	WaitCloseWindow()

	HeadYes("DANA" , 1 , 25 )

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#000mうん、剣士は東街区を見渡していたから、"
		"#012e場所は王都東の郊外だと思う。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "Olga" , "ANI_EV_UDEGUMI_E", -1 , 1 )

	//	"Olga"
	TalkPopup("Olga",0,2,0,0,0)
	{
		"#000e#000mわかった、くれぐれも"
		"気を付けて行くのだぞ。"
	}
	WaitPrompt()
	WaitCloseWindow()

	ChangeAnimation( "DANA" , "ANI_EV_TEMUNE_E", -1 , 1 )

	//	"DANA"
	TalkPopup("DANA",0,1,0,0,0)
	{
		"#080e#080mうん、行ってくるね。"
	}
	WaitPrompt()
	WaitCloseWindow()


	Wait(20)

	//　　⇒ここで操作許可。
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	//　　アドルの現在地(王都手前の高台)へ向かうことになる。
	//　　地図を開くとアドルのいる場所にアイコンが表示される。

	//終了処理ここから----------------------------------------------------
	CallFunc("mp6402m:EV_M04S131_ED")
}

function "EV_M04S131_ED"
{
	SetSkipScript("")
	RestoreEventState()

	//キャラクター初期化
	CallFunc("system:reset_chrmot_DANA")
	CallFunc("system:reset_chrmot_Olga")
	SetChrPos("Olga",-1000000.00f,00.00f,0.00f)

	//フラグ
	SetFlag( SF_SETRAMSAVE , 1)
	SetFlag( GF_04MP6401M_GO_MP6101M , 1)	//過去Ⅰ アドルの夢を見る２	

	//マップマーカー
	CallFunc("system:SetMarkerDANA")
	SetMapMarker( SMI_DANA_SYMBOL ,PAGE_MF002, MARKER_EV_M04S132, -206.38f, 819.43f, 51.52f, -206.38f, 819.43f,MARKER_EV_M04S132,MN_F_MP6101M,0)		//メイン：過去Ⅰ 初めて水晶石前に植樹

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam( -1 )

	MapHide("dorape_bed" , 1 )	//通常布団ON
	MapHide("dorape_sleep" , 0 )	//眠り布団OFF
	MapHide("dorape_wokeup" , 0 )	//起き上がり時布団OFF

	//イベント後の再配置位置
	SetChrPos("PLAYER1",20.18f,10.72f,0.30f)
	Turn("PLAYER1",178.60f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	

	//カメラ位置復帰or初期位置設定
	MoveCameraAt( 0 , 20.180f , 10.722f , 2.155f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 7.000f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 7.413f , 0 )	// 基本仰角
	RotateCamera( 0 , 1.400f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	CallFunc("system:camera_reset")
	
	ResetStopFlag(STOPFLAG_EVENT)
	SoundEfx( SEFX_CAVE_S, 15 )

	VisualName("visual/portrait/ep_0110.itp",VN_NAMEMAP2,-1,-1,VN_MAPNAME_TIME)//過去編Ⅰ


	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade
	//終了処理ここまで----------------------------------------------------
}

////////////////////////////////////////////////////////////////////////////////

//■サブイベントセクション

////////////////////////////////////////////////////////////////////////////////
//──────────────────────────────
//	【サブイベント：ダーナの私室に入る】
//──────────────────────────────
function "SubEV_Past_D1_Room"
{

	//　　ダーナの私室に入るとサブイベント。

//開始処理ここから----------------------------------------------------

//	CallFunc("system:event_begin")

	SetStopFlag(STOPFLAG_EVENT)

	FadeOut(FADE_BLACK,0)
	WaitFade()

	//イベント開始前情報の保存
	SaveEventState()
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_reset")

	//環境の初期化・不要なものを隠す
	ClearDebris()
	//ResetChrPos((CHRTYPE_MONS | REMOVE_POS))
	//ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラ初期状態の設定
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrPos("DANA",20.03f, 16.38f, 0.00f)
	Turn("DANA",0.00f,360.0f)
	ChangeAnimation( "DANA" , "ANI_WAIT", -1 , 1 )
	ChangeSubAnimation("DANA",SUBMOT_EYE,ANI_E_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_MOUTH,ANI_M_WAIT,1)
	ChangeSubAnimation("DANA",SUBMOT_EXT1,ANI_E_LOOKC,1)
	LookReset("DANA")
	SetChrInfoFlag( "DANA" , INFOFLAG_NOCHRATARI)

	//BGM設定◆
	//PlayBGM( BGM_FIELD_101 , XX )

	//カメラ設定
	MoveCameraAt( 0 , 19.168f , 14.799f , 2.591f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.460f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 3.610f , 0 )	// 基本仰角
	RotateCamera( 0 , 124.832f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 2.000, 50.000 ,1.000 ,0.700 ,0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300 ,1.000 ,1.000 ,0.600 ,0.000 ,1.000)

	//スキップ許可
	SetSkipScript("mp6402m:SubEV_Past_D1_Room_ED")

//開始処理ここまで-----------------------------------------------

	// カメラ移動
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE , 20.023f , 13.544f , 1.911f , 115 )
	ExecuteCmd(1001, ChangeCameraDistance, INTERPOLATE_SPHERE , 2.460f , 115 )
	ExecuteCmd(1002, ChangeCameraElevation, INTERPOLATE_SPHERE , 2.464f , 115 )
	ExecuteCmd(1003, RotateCamera, INTERPOLATE_SPHERE , 159.782f , 115 )

	FadeIn(FADE_BLACK,FADE_NORMAL)
	WaitFade()

	//　　カメラを軽く動かし、部屋を見せた後
	//　　入り口に立っているダーナを見せる。

	// カメラ待ち
	WaitThread(1000)
	WaitThread(1001)
	WaitThread(1002)
	WaitThread(1003)

	CrossFade(FADE_NORMAL)

	MoveCameraAt( 0 , 20.055f , 15.863f , 1.491f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 0.780f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 0.746f , 0 )	// 基本仰角
	RotateCamera( 0 , 48.651f , 0 )				// 角度
	ChangeCameraPers( 0 , 60.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転
	// ResetCameraZPlane()	// イベント終了時に呼び出して下さい。マップ側の設定に戻します。

	Wait(FADE_NORMAL)

	TalkPopup("DANA",0,2,0,0,0)
	{
		"#011e#000mふう、結局部屋まで"
		"戻ってきちゃったね。\p"
		"#012e#000mまだ少し慣れない部屋だけど……"
		"ともかく一休みしようかな。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　イベント終了、操作許可
	FadeOut(FADE_BLACK,FADE_NORMAL)
	WaitFade()

//終了処理ここから----------------------------------------------------
	CallFunc("mp6402m:SubEV_Past_D1_Room_ED")
}
function "SubEV_Past_D1_Room_ED"
{
	//終了処理はスキップ禁止
	SetSkipScript("")

	//イベント前のキャラ情報を復帰
	RestoreEventState()

	//隠したものを復帰。
//	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化
	CallFunc("system:reset_chrmot_ALL")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	//フラグ立て
	SetFlag( GF_SUBEV_PAST_D1_ROOM, 1 )	// ダーナ編①：【サブイベント：ダーナの私室に入る】を見た

	CallFunc("mp6402m:init")

	//イベント後の再配置
	SetChrPos("LEADER",20.03f, 16.38f, 0.00f)
	Turn("LEADER",0.00f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	//カメラ位置復帰
	//MoveCameraAt( 0 , 0.0f , 0.0f , 0.0f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 0.0f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 0.0f , 0 )		// 基本仰角
	//RotateCamera( 0 , 0.0f , 0 )				// 角度
	//ChangeCameraPers( 0 , 0.0f , 0 )			// 視野角
	//SetCameraZPlane( 0 , 0.0f )					// ZPlane
	//RollCamera( 0 , 0.0f , 0 )					// ロール回転

	RestoreCamera(0, 0)		//※上記カメラ位置を指定する場合は不要
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()

//終了処理ここまで----------------------------------------------------
}


//===============================================================
//
// 【QS522】奮起の演奏会（オースティン）
// ▼楽譜探しイベント③（２）
//
function "QS_522_Event2"	
{
	//開始処理ここから-----------------------------------------------
	SetStopFlag(STOPFLAG_EVENT)
	FadeOut(FADE_BLACK, 0)
	WaitFade()

	//イベント開始前情報の保存										
	SaveEventState()												
	CallFunc("system:event_chrinfoflag_set")						
	SaveCamera()

	//パーティ状態のリセット
	CallFunc("system:party_remove")
	CallFunc("system:party_reset")									

	//環境の初期化・不要なものを隠す
	ClearDebris()
	ResetChrPos((CHRTYPE_MONS | REMOVE_POS))							
	ResetChrPos((CHRTYPE_NPC | REMOVE_POS))

	//キャラクター初期化
	SetChrWork("DANA", CWK_DEFAULT_SKIPNODE_OFF, 1)
	SetChrInfoFlag("DANA", INFOFLAG_FLING)
	SetChrInfoFlag("DANA", INFOFLAG_NOCHRATARI)
	SetChrPos("DANA",25.76f,10.61f,0.00f)
	Turn("DANA",-101.04f,360.0f)
	ChangeAnimation("DANA", "ANI_WAIT", -1, 1)
	ChangeSubAnimation("DANA", SUBMOT_EYE, ANI_E_SUP, 1)
	ChangeSubAnimation("DANA", SUBMOT_MOUTH, ANI_M_SUP, 1)
	ChangeSubAnimation("DANA", SUBMOT_EXT1, ANI_E_LOOKC, 1)
	ChangeSubAnimation("DANA", SUBMOT_EXT2, ANI_SIGN_HIDE, 1)

	Look("DANA", 0.00f, -7.00f)
		

	//エフェクトロード	
//	LoadEffect("efx_ev09.ite")

	//カメラ設定
	MoveCameraAt( 0 , 23.597f , 9.032f , 1.300f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 5.460f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , 5.527f , 0 )	// 基本仰角
	RotateCamera( 0 , 185.747f , 0 )				// 角度
	ChangeCameraPers( 0 , 56.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	// 被写界深度の設定
	SetDoF(0, LERP_LINEAR, 2.000, 50.000, 1.000, 0.700, 0.500)
	// グレアの設定
	SetGlare(0, LERP_LINEAR, 0.700, 1.300, 1.000, 1.000, 0.600, 0.000, 1.000)

	//スキップ許可
	SetSkipScript("mp6402m:QS_522_Event2_ED")

	//開始処理ここまで-----------------------------------------------
	ExecuteCmd(1000, MoveCameraAt, INTERPOLATE_SPHERE, 25.839f , 9.628f , 1.300f, 95)		// 注視点
	ExecuteCmd(1001, RotateCamera, INTERPOLATE_SPHERE, 224.475f , 95)		// 角度

	//MoveCameraAt( 0 , 25.839f , 9.628f , 1.300f , 0 )	// 注視点
	//ChangeCameraDistance( 0 , 5.460f , 0 )		// 基本距離
	//ChangeCameraElevation( 0 , 5.527f , 0 )	// 基本仰角
	//RotateCamera( 0 , 224.475f , 0 )				// 角度
	//ChangeCameraPers( 0 , 56.000f , 0 )			// 視野角
	//SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	//RollCamera( 0 , 0.0f , 0 )				// ロール回転

	FadeIn(FADE_BLACK, FADE_NORMAL)
	Wait(FADE_NORMAL)

	WaitThread(1000)
	WaitThread(1001)

	//部屋の東側にある壷が３つ固まっている場所。
	//角にある壷の前にダーナを立たせる。

	TalkPopup("DANA", 0, 0, 0, 0, 0)
	{
		"#000e#000m楽譜を壷に入れて……"
		"理力でおまじない、と。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//　　ダーナが手をかざして理力を注入するモーション＆エフェクト。
	ChangeAnimation("DANA", "ANI_EV_KAZASU_S", -1, 1)
	WaitAnimation2("DANA", -1, 1, "ANI_EV_KAZASU_S", 0)

	Effect2(3900530, 27.23f, 10.8f, 0.70f,  90.00f, 0, 0, IMPACT_NONE, KNOCK_EFXPOS, 0, 1.0f, 1.0f)
	PlaySE(SE_QS_522_01, 60, 0, 0, 0, 1.0f, 0)
	Wait(60)
	StopEffect(3900530, ALL, 1)
	Wait(35)
	ChangeAnimation("DANA", "ANI_EV_KAZASU_E", -1, 1)

	CrossFade(FADE_CROSS)

	MoveCameraAt( 0 , 25.762f , 10.245f , 1.474f , 0 )	// 注視点
	ChangeCameraDistance( 0 , 2.050f , 0 )		// 基本距離
	ChangeCameraElevation( 0 , -5.235f , 0 )	// 基本仰角
	RotateCamera( 0 , 140.470f , 0 )				// 角度
	ChangeCameraPers( 0 , 49.000f , 0 )			// 視野角
	SetCameraZPlane( 0.500f , 900.000f )			// ZPlane
	RollCamera( 0 , 0.0f , 0 )				// ロール回転

	Wait(FADE_CROSS)

	WaitAnimation2("DANA", -1, 1, "ANI_EV_KAZASU_E", 0)

	TalkPopup("DANA", 0, 0, 0, 0, 0)
	{
		"#091e#080mうん、いっちょあがり！\p"
		"#092eこれでアドルさんの時代に"
		"託すことができたんじゃないかな。"
	}
	WaitPrompt()
	WaitCloseWindow()

	if (FLAG[GF_PAST_EPISODE_3B_REARRIVE])		//▽過去編ⅢＢ再訪時
	{
		ChangeAnimation("DANA", "ANI_EV_UDEGUMI_S", -1, 1)

		TalkPopup("DANA", 0, 0, 0, 0, 0)
		{
			"#011e#000mさてと、これで用事も済んだし"
			"そろそろ行こうかな。"
		}
		WaitPrompt()
		WaitCloseWindow()

		SetEnvSEPlayState(-1, 0)	//環境SE全停止

	}
	//　　イベント終了、操作許可。

	FadeOut(FADE_BLACK, FADE_NORMAL)
	WaitFade()

	//終了処理ここから----------------------------------------------------
	CallFunc("mp6402m:QS_522_Event2_ED")
}

function "QS_522_Event2_ED"
{
	//スキップ禁止														
	SetSkipScript("")

	//イベント前のキャラ情報を復帰									
	RestoreEventState()

	//隠したものを復帰												
	ResetChrPos((CHRTYPE_MONS | RESET_POS | RESET_AISTATE))

	//キャラモーション初期化										
	CallFunc("system:reset_chrmot_DANA")

	//パーティキャラを解放
	ReleaseEventPartyChr()

	//マップパラメーターリセット
	ResetMapParam(-1)

	//フラグ処理
	SetFlag( GF_QS522_TALK_SERACH3, 1 )	//【QS522】▼楽譜探しイベント③ を見た
	DeleteItem(ICON3D_BLUE_SCORE, 1)			// 「『蒼き豊穣の楽譜』×１
	//マーカー消去と設置
//	DelMapMarker( SMI_QUEST, ---, MARKER_QS_522_LP3, 0, 0)	// 【QS522】奮起の演奏会（オースティン）「ラステル」の居場所用
	SetMapMarker( SMI_QUEST, PAGE_MP6401, MARKER_QS_522_LP4, 27.23f,10.8f,0.70f, 	27.23f,10.8f,	MARKER_QS_522_LP4, MN_D_MP6402,	1)	// 【QS522】奮起の演奏会（オースティン）「▼楽譜入手イベント」の場所用


	if (FLAG[GF_PAST_EPISODE_3B_REARRIVE])		//▽過去編ⅢＢ再訪時
	{
		SetFlag(TF_LOADING_TIPS_OFF, 1)	//NowLoading 時の Tips 表示をカット
		LoadArg("map/mp6201m/mp6201m.arg")
		EventCue("mp6201m:QS_522_Event2_Relocate")		// 過去編Ⅵ：【サブイベント：山門で修道女たちに見送られる】（続き）
	}
	else{

	//イベント後の再配置位置
	SetChrPos("LEADER", 20.18f, 10.72f, 0.30f)
	Turn("LEADER", 178.60f, 360.0f)
	ResetPartyPos()
	ResetFollowPoint()

	//カメラ位置復帰or初期位置設定
	MoveCameraAt(0, 20.180f, 10.722f, 2.155f, 0)	// 注視点
	ChangeCameraDistance(0, 7.000f, 0)		// 基本距離
	ChangeCameraElevation(0, 7.413f, 0)	// 基本仰角
	RotateCamera(0, 1.400f, 0)				// 角度
	ChangeCameraPers(0, 60.000f, 0)			// 視野角
	SetCameraZPlane(0.500f, 900.000f)			// ZPlane
	RollCamera(0, 0.0f, 0)				// ロール回転
	CallFunc("system:camera_reset")

	ResetStopFlag(STOPFLAG_EVENT)

	FadeIn(FADE_BLACK,FADE_FAST)
	//WaitFade()
	
	}
	//終了処理ここまで----------------------------------------------------
}


////////////////////////////////////////////////////////////////////////////////

//■ストッパー・ＬＰセクション

////////////////////////////////////////////////////////////////////////////////
////──────────────────────────────
////	【ＬＰ：ダーナの部屋の棚を調べる】
////──────────────────────────────
//function "LP_Past_D1_01"
//{
//	//　　ダーナの部屋の棚にＬＰを仕掛ける。
//
////開始処理ここから----------------------------------------------------
//	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
//	ResetStopFlag(STOPFLAG_NOCHARACLIP)
//	SaveCamera()
//
//	ResetMotion( "PARTYALL" , 0 )
//	StopEffect(-1,PARTYALL,1)
//	StopEmotion( "PARTYALL" )
//	ResetMoveVec("PARTYALL")
////開始処理ここまで-----------------------------------------------
//
//	TurnToChr( LEADER , this , 7.5f )
//	Wait(10)
//
//	//▼ダーナ編①Ａ寺院内を歩く
//	TalkPopup("DANA",0,0,0,0,0)
//	{
//		"#000e#000m（ふふ……ここには"
//		"  ちょっと仕掛けがあるんだよね。）\p"
//		"（でも今は使う必要はないかな。）"
//	}
//	WaitPrompt()
//	WaitCloseWindow()
//
////終了処理ここから----------------------------------------------------
//	CrossFade(FADE_CROSS)
//	SetStopFlag(STOPFLAG_NOCHARACLIP)
//
//	//イベント後の再配置
////	SetChrPos("LEADER",26.33f,2.00f,0.30f)
////	Turn("LEADER",-90.00f,360.0f)
//	ResetPartyPos()
//	ResetFollowPoint()
//	Wait(1)
//
//	RestoreCamera(0,0)
//	ResetCameraObserver(0)
//	ResetCameraZPlane()
//	WaitFade()
//	Wait(FADE_CROSS)
//
//	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
////終了処理ここまで----------------------------------------------------
//}

//──────────────────────────────
//	【ＬＰ：ダーナの部屋の祭壇】
//──────────────────────────────
function "LP_Past_D1_02"
{
	//　　※エピソードに関わらず、過去編では常時しかける。

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	TurnToChr( LEADER , this , 7.5f )
	Wait(10)

	//	ナレーション
	TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
	{
		"#7C祈りの祭壇が備えられている。"
	}
	WaitPrompt()
	WaitCloseWindow()

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
//	SetChrPos("LEADER",26.33f,2.00f,0.30f)
//	Turn("LEADER",-90.00f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ＬＰ：ダーナの部屋の書架】
//──────────────────────────────
function "LP_Past_Bookshelf"
{

	//　　※エピソードに関わらず、過去編では常時しかける。

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	TurnToChr( LEADER , this , 7.5f )
	Wait(10)

	//	ナレーション
	TalkPopup(UNDEF,0,3,SYSTEM_PPOSX,SYSTEM_PPOSY,0)
	{
		"#7C巫女のための書架がある。"
	}
	WaitPrompt()
	WaitCloseWindow()

	//────────────────────
	//	⇒▼過去編Ⅰアドルがいたポイントへ向かう　のタイミング　ＬＰで１回だけ
	if( FLAG[GF_PAST_EPISODE_1_GO_CAMP] &&			//▼過去編Ⅰアドルがいたポイントへ向かう
		!FLAG[GF_SUBEV_PAST_01_LP_1ST] )			// 過去編Ⅰ：【ＬＰ：ダーナの部屋の書架】初回
	{
		TalkPopup("LEADER",0,0,0,0,0)
		{
			"#000e#000mふふ、ここには"
			"ちょっとした仕掛けがあるんだよね。\p"
			"まあ今日はオルガちゃんに"
			"許可ももらったし……使う必要はないかな？"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		//フラグ立て
		SetFlag( GF_SUBEV_PAST_01_LP_1ST, 1 )		// 過去編Ⅰ：【ＬＰ：ダーナの部屋の書架】初回
	}
	//────────────────────

	//────────────────────
	//	⇒▼ダーナ編①Ａ寺院内を歩く　のタイミング　ＬＰで１回だけ
	if( FLAG[GF_PAST_EPISODE_D1A_TEM] &&			//▼ダーナ編①Ａ寺院内を歩く
		!FLAG[GF_SUBEV_PAST_D1_LP_1ST] )			// ダーナ編①：【ＬＰ：ダーナの部屋の書架】初回
	{
		TalkPopup("DANA",0,0,0,0,0)
		{
			"#000e#000mふう……これから先"
			"堅苦しい事が続きそうだなぁ。"
		}
		WaitPrompt()
		WaitCloseWindow()
		
		//フラグ立て
		SetFlag( GF_SUBEV_PAST_D1_LP_1ST, 1 )		// ダーナ編①：【ＬＰ：ダーナの部屋の書架】初回
	}
	//────────────────────

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
//	SetChrPos("LEADER",26.33f,2.00f,0.30f)
//	Turn("LEADER",-90.00f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}

//──────────────────────────────
//	【ＬＰ：ダーナの部屋のベッド】
//──────────────────────────────
function "LP_Past_Bed"
{

	//　　※エピソードに関わらず、過去編では常時しかける。

//開始処理ここから----------------------------------------------------
	SetStopFlag(STOPFLAG_SIMPLEEVENT2)
	ResetStopFlag(STOPFLAG_NOCHARACLIP)
	SaveCamera()

	ResetMotion( "PARTYALL" , 0 )
	StopEffect(-1,PARTYALL,1)
	StopEmotion( "PARTYALL" )
	ResetMoveVec("PARTYALL")
//開始処理ここまで-----------------------------------------------

	TurnToChr( LEADER , this , 7.5f )
	Wait(10)

	//────────────────────
	//	⇒▼ダーナ編①Ａ寺院内を歩く　のタイミング
	if( FLAG[GF_PAST_EPISODE_D1A_TEM] )				//▼ダーナ編①Ａ寺院内を歩く
	{
		TalkPopup("DANA",0,0,0,0,0)
		{
			"#000e#000m私の使っているベッドだね。\p"
			"……さすがに横になっている"
			"時間はないかな。"
		}
		WaitPrompt()
		WaitCloseWindow()
	}
	//	⇒それ以外
	else
	{
		TalkPopup("LEADER",0,0,0,0,0)
		{
			"#000e#000m私のベッドだね。"
			"今は休む必要はないかな。"
		}
		WaitPrompt()
		WaitCloseWindow()
	}
	//────────────────────

//終了処理ここから----------------------------------------------------
	CrossFade(FADE_CROSS)
	SetStopFlag(STOPFLAG_NOCHARACLIP)

	//イベント後の再配置
//	SetChrPos("LEADER",26.33f,2.00f,0.30f)
//	Turn("LEADER",-90.00f,360.0f)
	ResetPartyPos()
	ResetFollowPoint()
	//Wait(1) //処理待ち用

	RestoreCamera(0,0)
	ResetCameraObserver(0)
	ResetCameraZPlane()
	Wait(FADE_CROSS)

	ResetStopFlag(STOPFLAG_SIMPLEEVENT2)
//終了処理ここまで----------------------------------------------------
}
